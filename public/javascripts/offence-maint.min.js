"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t,n,s,o;const a=new Map,c=exports.accountNumberPattern;delete exports.accountNumberPattern;const l=new Map,i=document.querySelector("#offenceFilter--limitResults"),r=document.querySelector("#offenceResults"),d=document.querySelector("#offenceFilter--location"),u=document.querySelector("#offenceFilter--locationText");let m=!1,f="";const y=new Map,b=document.querySelector("#offenceFilter--bylaw"),p=document.querySelector("#offenceFilter--bylawText");let v=!1,w="";function h(e,t){return e+"::::"+t}function g(e){a.clear();for(const t of e){const e=h(t.bylawNumber,t.locationKey);a.set(e,t)}}function N(e){var t,n;e.preventDefault();const s=e.currentTarget,o=h(null!==(t=s.dataset.bylawNumber)&&void 0!==t?t:"",null!==(n=s.dataset.locationKey)&&void 0!==n?n:""),i=a.get(o),r=l.get(i.locationKey),d=y.get(i.bylawNumber);let u;function m(){cityssm.postJSON("/admin/doDeleteOffence",{bylawNumber:i.bylawNumber,locationKey:i.locationKey},e=>{const t=e;t.success&&(g(t.offences),u(),S())})}function f(e){e.preventDefault(),bulmaJS.confirm({title:"Remove Offence",message:"Are you sure you want to remove this offence?",contextualColorName:"warning",okButton:{text:"Yes, Remove Offence",callbackFunction:m}})}function b(e){e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffence",e.currentTarget,e=>{const t=e;t.success&&(g(t.offences),u(),S())})}cityssm.openHtmlModal("offence-edit",{onshow(){var e,t;document.querySelector("#offenceEdit--locationKey").value=i.locationKey,document.querySelector("#offenceEdit--bylawNumber").value=i.bylawNumber,document.querySelector("#offenceEdit--locationName").textContent=r.locationName,document.querySelector("#offenceEdit--locationClass").textContent=pts.getLocationClass(r.locationClassKey).locationClass,document.querySelector("#offenceEdit--bylawNumberSpan").textContent=null!==(e=null==d?void 0:d.bylawNumber)&&void 0!==e?e:"",document.querySelector("#offenceEdit--bylawDescription").textContent=null!==(t=null==d?void 0:d.bylawDescription)&&void 0!==t?t:"",document.querySelector("#offenceEdit--parkingOffence").value=i.parkingOffence,document.querySelector("#offenceEdit--offenceAmount").value=i.offenceAmount.toFixed(2),document.querySelector("#offenceEdit--discountOffenceAmount").value=i.discountOffenceAmount.toFixed(2),document.querySelector("#offenceEdit--discountDays").value=i.discountDays.toString();const n=document.querySelector("#offenceEdit--accountNumber");n.value=i.accountNumber,n.setAttribute("pattern",c)},onshown(e,t){var n,s;bulmaJS.toggleHtmlClipped(),u=t,null===(n=document.querySelector("#form--offenceEdit"))||void 0===n||n.addEventListener("submit",b),null===(s=e.querySelector(".is-delete-button"))||void 0===s||s.addEventListener("click",f)},onhidden(){bulmaJS.toggleHtmlClipped()}})}function L(e,t,n,s){cityssm.postJSON("/admin/doAddOffence",{bylawNumber:e,locationKey:t,returnOffences:n},e=>{const t=e;t.success&&n&&(g(t.offences),S()),void 0!==s&&s(t)})}function S(){var e,t;const n=document.createElement("tbody");let s=0;const o=i.checked?Number.parseInt(i.value,10):a.size;for(const t of a.values()){if(s>=o)continue;if(m&&f!==t.locationKey||v&&w!==t.bylawNumber)continue;const a=l.get(t.locationKey);if(!a)continue;const c=y.get(t.bylawNumber);if(!c)continue;if((s+=1)>o)continue;const i=document.createElement("tr");i.innerHTML=`<td class="has-border-right-width-2">\n          ${cityssm.escapeHTML(a.locationName)}<br />\n          <span class="is-size-7">\n            ${cityssm.escapeHTML(pts.getLocationClass(a.locationClassKey).locationClass)}\n          </span>\n        </td>\n        <td class="has-border-right-width-2">\n          <strong>${cityssm.escapeHTML(c.bylawNumber)}</strong><br />\n          <span class="is-size-7">\n            ${cityssm.escapeHTML(c.bylawDescription)}\n          </span>\n        </td>\n        <td class="has-text-right has-tooltip-bottom" data-tooltip="Set Rate">\n          $${t.offenceAmount.toFixed(2)}<br />\n          <span class="is-size-7">\n            ${t.accountNumber}\n          </span>\n        </td>\n      <td class="has-text-right has-tooltip-bottom" data-tooltip="Discount Rate">\n        $${t.discountOffenceAmount.toFixed(2)}<br />\n        <span class="is-size-7">\n        ${t.discountDays.toString()} day${1===t.discountDays?"":"s"}\n        </span>\n      </td>\n      <td class="has-border-right-width-2">\n        <div class="is-size-7">\n          ${cityssm.escapeHTML(t.parkingOffence)}\n        </div>\n      </td>\n      <td class="has-text-right">\n        <button class="button is-small"\n          data-bylaw-number="${t.bylawNumber}"\n          data-location-key="${t.locationKey}" type="button">\n          <span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span>\n          <span>Edit</span>\n        </button>\n      </td>`,null===(e=i.querySelector("button"))||void 0===e||e.addEventListener("click",N),n.append(i)}cityssm.clearElement(r),0!==s?(r.innerHTML='<table class="table is-striped is-hoverable is-fullwidth">\n      <thead><tr>\n        <th class="has-border-right-width-2">Location</th>\n        <th class="has-border-right-width-2">By-Law</th>\n        <th class="has-border-right-width-2" colspan="3">Offence</th>\n        <th class="has-width-50"></th>\n      </tr></thead>\n      </table>',null===(t=r.querySelector("table"))||void 0===t||t.append(n),s>o&&r.insertAdjacentHTML("afterbegin",'<div class="message is-warning">\n          <div class="message-body has-text-centered">Limit Reached</div>\n          </div>')):r.innerHTML='<div class="message is-info">\n        <div class="message-body">\n        <p>There are no offences that match the given criteria.</p>\n        </div>\n        </div>'}function E(){d.value="",cityssm.clearElement(u),f="",m=!1}function T(){let e;function t(t){var n;t.preventDefault();const s=l.get(null!==(n=t.currentTarget.dataset.locationKey)&&void 0!==n?n:"");m=!0,f=s.locationKey,d.value=s.locationName,e(),S()}cityssm.openHtmlModal("location-select",{onshow(){const e=document.createElement("div");e.className="panel mb-4";for(const n of l.values()){const s=document.createElement("a");s.className="panel-block is-block",s.dataset.locationKey=n.locationKey,s.setAttribute("href","#"),s.innerHTML=`<div class="level">\n            <div class="level-left">\n              ${cityssm.escapeHTML(n.locationName)}\n            </div>\n            <div class="level-right">\n              ${cityssm.escapeHTML(pts.getLocationClass(n.locationClassKey).locationClass)}\n            </div>\n            </div>`,s.addEventListener("click",t),e.append(s)}const n=document.querySelector("#container--parkingLocations");cityssm.clearElement(n),n.append(e)},onshown(t,n){e=n}})}function H(){b.value="",cityssm.clearElement(p),w="",v=!1}function M(){let e;function t(t){var n;t.preventDefault();const s=y.get(null!==(n=t.currentTarget.dataset.bylawNumber)&&void 0!==n?n:"");v=!0,w=s.bylawNumber,b.value=s.bylawNumber,p.textContent=s.bylawDescription,e(),S()}cityssm.openHtmlModal("bylaw-select",{onshow(){const e=document.createElement("div");e.className="panel mb-4";for(const n of y.values()){const s=document.createElement("a");s.className="panel-block is-block",s.dataset.bylawNumber=n.bylawNumber,s.setAttribute("href","#"),s.innerHTML=`${cityssm.escapeHTML(n.bylawNumber)}<br />\n            <span class="is-size-7">\n            ${cityssm.escapeHTML(n.bylawDescription)}\n            </span>`,s.addEventListener("click",t),e.append(s)}const n=document.querySelector("#container--parkingBylaws");cityssm.clearElement(n),n.append(e)},onshown(t,n){e=n}})}null===(e=document.querySelector("#is-add-offence-button"))||void 0===e||e.addEventListener("click",e=>{if(e.preventDefault(),m&&v){const e=y.get(w),t=l.get(f);bulmaJS.confirm({title:"Create Offence?",message:`<p class="has-text-centered">Are you sure you want to create the offence record below?</p>\n            <div class="columns my-4">\n            <div class="column has-text-centered">\n              ${cityssm.escapeHTML(t.locationName)}<br />\n              <span class="is-size-7">\n              ${cityssm.escapeHTML(pts.getLocationClass(t.locationClassKey).locationClass)}\n              </span>\n            </div>\n            <div class="column has-text-centered">\n              ${cityssm.escapeHTML(e.bylawNumber)}<br />\n              <span class="is-size-7">\n                ${cityssm.escapeHTML(e.bylawDescription)}\n              </span>\n            </div>\n            </div>`,messageIsHtml:!0,contextualColorName:"info",okButton:{text:"Yes, Create Offence",callbackFunction:()=>{L(w,f,!0,e=>{var t,n,s;e.success?""!==(null!==(n=e.message)&&void 0!==n?n:"")&&bulmaJS.alert({title:"Offence Added Successfully",message:null!==(s=e.message)&&void 0!==s?s:"",contextualColorName:"warning"}):bulmaJS.alert({title:"Offence Not Added",message:null!==(t=e.message)&&void 0!==t?t:"",contextualColorName:"danger"})})}}})}else m||v?function(){let e=!1;function t(t){var n,s;t.preventDefault();const o=t.currentTarget;L(null!==(n=o.dataset.bylawNumber)&&void 0!==n?n:"",null!==(s=o.dataset.locationKey)&&void 0!==s?s:"",!1,t=>{t.success&&(o.remove(),e=!0)})}cityssm.openHtmlModal("offence-addFromList",{onshow(e){let t="",n="";if(m){t="Select By-Laws";const e=l.get(f),s=pts.getLocationClass(e.locationClassKey);n=`${cityssm.escapeHTML(e.locationName)}<br />\n            <span class="is-size-7">\n            ${cityssm.escapeHTML(s.locationClass)}\n            </span>`}else{t="Select Locations";const e=y.get(w);n=`${cityssm.escapeHTML(e.bylawNumber)}<br />\n            <span class="is-size-7">\n            ${e.bylawDescription}\n            </span>`}e.querySelector(".modal-card-title").innerHTML=t,document.querySelector("#addContainer--selected").innerHTML=n},onshown(){const e=document.createElement("div");e.className="panel";let n=0;if(m)for(const s of y.values()){const o=h(s.bylawNumber,f);if(a.has(o))continue;n+=1;const c=document.createElement("a");c.className="panel-block is-block",c.dataset.bylawNumber=s.bylawNumber,c.dataset.locationKey=f,c.innerHTML=`${cityssm.escapeHTML(s.bylawNumber)}<br />\n              <span class="is-size-7">\n              ${cityssm.escapeHTML(s.bylawDescription)}\n              </span>`,c.addEventListener("click",t),e.append(c)}else for(const s of l.values()){const o=h(w,s.locationKey);if(a.has(o))continue;n+=1;const c=document.createElement("a");c.className="panel-block is-block",c.dataset.bylawNumber=w,c.dataset.locationKey=s.locationKey,c.innerHTML=`${cityssm.escapeHTML(s.locationName)}<br />\n              <span class="is-size-7">\n              ${cityssm.escapeHTML(pts.getLocationClass(s.locationClassKey).locationClass)}\n              </span>`,c.addEventListener("click",t),e.append(c)}const s=document.querySelector("#addContainer--results");cityssm.clearElement(s),0===n?s.innerHTML='<div class="message is-info">\n            <div class="message-body">There are no offence records available for creation.</div>\n            </div>':s.append(e)},onremoved(){e&&cityssm.postJSON("/offences/doGetAllOffences",{},e=>{g(e),S()})}})}():bulmaJS.alert({title:"How to Create a New Offence",message:"To add an offence, use the main filters to select either a location, a by-law, or both.",contextualColorName:"warning"})}),d.addEventListener("dblclick",T),null===(t=document.querySelector("#is-select-location-filter-button"))||void 0===t||t.addEventListener("click",T),null===(n=document.querySelector("#is-clear-location-filter-button"))||void 0===n||n.addEventListener("click",()=>{E(),S()}),m||E(),b.addEventListener("dblclick",M),null===(s=document.querySelector("#is-select-bylaw-filter-button"))||void 0===s||s.addEventListener("click",M),null===(o=document.querySelector("#is-clear-bylaw-filter-button"))||void 0===o||o.addEventListener("click",()=>{H(),S()}),v||H(),i.addEventListener("change",S);for(const e of exports.locations)l.set(e.locationKey,e);delete exports.locations;for(const e of exports.bylaws)y.set(e.bylawNumber,e);delete exports.bylaws,g(exports.offences),delete exports.offences,pts.getDefaultConfigProperty("locationClasses",S)})();