"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("#bylawFilter--bylaw"),t=document.querySelector("#bylawResults");let s=exports.bylaws;delete exports.bylaws;const a=e=>{e.preventDefault();const t=Number.parseInt(e.currentTarget.dataset.index,10),a=s[t];let n;const r=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffencesByBylaw",e.currentTarget,e=>{e.success&&(n(),s=e.bylaws,o())})};cityssm.openHtmlModal("bylaw-updateOffences",{onshow(){document.querySelector("#updateOffences--bylawNumber").value=a.bylawNumber,document.querySelector("#updateOffences--bylawDescription").value=a.bylawDescription,document.querySelector("#updateOffences--offenceAmount").value=a.offenceAmountMin.toFixed(2),document.querySelector("#updateOffences--discountDays").value=a.discountDaysMin.toString(),document.querySelector("#updateOffences--discountOffenceAmount").value=a.discountOffenceAmountMin.toFixed(2)},onshown(e,t){n=t,e.querySelector("form").addEventListener("submit",r)}})},n=e=>{e.preventDefault();const t=Number.parseInt(e.currentTarget.getAttribute("data-index"),10),a=s[t];let n;const r=()=>{cityssm.postJSON("/admin/doDeleteBylaw",{bylawNumber:a.bylawNumber},e=>{e.success&&(n(),s=e.bylaws,o())})},l=e=>{e.preventDefault(),cityssm.confirmModal("Delete By-Law",'Are you sure you want to remove by-law "'+a.bylawNumber+'" from the list of available options?',"Yes, Remove By-Law","danger",r)},c=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateBylaw",e.currentTarget,e=>{e.success&&(n(),s=e.bylaws,o())})};cityssm.openHtmlModal("bylaw-edit",{onshow(){document.querySelector("#editBylaw--bylawNumber").value=a.bylawNumber,document.querySelector("#editBylaw--bylawDescription").value=a.bylawDescription},onshown(e,t){n=t,e.querySelector("form").addEventListener("submit",c),e.querySelector(".is-delete-button").addEventListener("click",l)}})},o=()=>{let o=0;const r=e.value.trim().toLowerCase().split(" "),l=document.createElement("tbody");for(const[e,t]of s.entries()){let s=!0;const c=t.bylawNumber.toLowerCase(),i=t.bylawDescription.toLowerCase();for(const e of r)if(!c.includes(e)&&!i.includes(e)){s=!1;break}if(!s)continue;o+=1;const d=document.createElement("tr");let u="",y=!1;t.offenceAmountMin?(y=!0,u="$"+t.offenceAmountMin.toFixed(2),t.offenceAmountMin!==t.offenceAmountMax&&(u+=" to $"+t.offenceAmountMax.toFixed(2)),u='<a class="has-tooltip-left" data-tooltip="Update Offence Amounts" data-index="'+e.toString()+'" href="#">'+u+"</a>"):u="(No Offences)",d.innerHTML='<td><a data-index="'+e.toString()+'" href="#">'+cityssm.escapeHTML(t.bylawNumber)+'</a></td><td class="has-border-right-width-2">'+cityssm.escapeHTML(t.bylawDescription)+'</td><td class="has-text-right">'+t.offenceCount.toString()+'</td><td class="has-text-right">'+u+"</td>",d.querySelectorAll("a")[0].addEventListener("click",n),y&&d.querySelectorAll("a")[1].addEventListener("click",a),l.append(d)}cityssm.clearElement(t),0!==o?(t.innerHTML='<table class="table is-striped is-hoverable is-fullwidth"><thead><tr><th>By-Law Number</th><th class="has-border-right-width-2">Description</th><th class="has-text-right">Total Offences</th><th class="has-text-right">Offence Amount Range</th></tr></thead></table>',t.querySelector("table").append(l)):t.innerHTML='<div class="message is-info"><div class="message-body">There are no by-laws that meet your search criteria.</div></div>'};e.addEventListener("keyup",o),o(),document.querySelector("#is-add-bylaw-button").addEventListener("click",e=>{let t;e.preventDefault();const a=e=>{e.preventDefault(),cityssm.postJSON("/admin/doAddBylaw",e.currentTarget,e=>{e.success?(t(),e.message&&cityssm.alertModal("By-Law Added",e.message,"OK","warning"),s=e.bylaws,o()):cityssm.alertModal("By-Law Not Added",e.message,"OK","danger")})};cityssm.openHtmlModal("bylaw-add",{onshown(e,s){t=s,e.querySelector("form").addEventListener("submit",a)}})})})();