"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementById("ticket--ticketID").value,t=document.getElementById("is-remark-panel");let a=exports.ticketRemarks;delete exports.ticketRemarks;const s=()=>{const e=t.getElementsByClassName("panel-block");for(;e.length>0;)e[0].remove()},r=t=>{const a=t.currentTarget.getAttribute("data-remark-index");cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this remark?","Yes, Delete","warning",()=>{cityssm.postJSON("/tickets/doDeleteRemark",{ticketID:e,remarkIndex:a},e=>{e.success&&d()})})},n=t=>{let s;t.preventDefault();const r=parseInt(t.currentTarget.getAttribute("data-index"),10),n=a[r],i=e=>{e.preventDefault(),cityssm.postJSON("/tickets/doUpdateRemark",e.currentTarget,e=>{e.success&&(s(),d())})};cityssm.openHtmlModal("ticket-editRemark",{onshow(t){document.getElementById("editRemark--ticketID").value=e,document.getElementById("editRemark--remarkIndex").value=n.remarkIndex.toString(),document.getElementById("editRemark--remark").value=n.remark,document.getElementById("editRemark--remarkDateString").value=n.remarkDateString,document.getElementById("editRemark--remarkTimeString").value=n.remarkTimeString,t.getElementsByTagName("form")[0].addEventListener("submit",i)},onshown(e,t){s=t}})},i=()=>{s(),0!==a.length?a.forEach((e,a)=>{const s=document.createElement("div");s.className="panel-block is-block",s.innerHTML='<div class="columns"><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(e.remark)+'</p><p class="is-size-7">'+(e.recordCreate_timeMillis===e.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+e.recordUpdate_userName+" - "+e.remarkDateString+" "+e.remarkTimeString+"</p></div>"+(e.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-tooltip="Edit Remark" data-index="'+a+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-tooltip="Delete Remark" data-remark-index="'+e.remarkIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div>",e.canUpdate&&(s.getElementsByClassName("is-edit-remark-button")[0].addEventListener("click",n),s.getElementsByClassName("is-delete-remark-button")[0].addEventListener("click",r)),t.appendChild(s)}):t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this ticket.</p></div></div>')},d=()=>{s(),t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading remarks...</p></div>'),cityssm.postJSON("/tickets/doGetRemarks",{ticketID:e},e=>{a=e,i()})};document.getElementById("is-add-remark-button").addEventListener("click",t=>{let a;t.preventDefault();const s=e=>{e.preventDefault(),cityssm.postJSON("/tickets/doAddRemark",e.currentTarget,e=>{e.success&&(a(),d())})};cityssm.openHtmlModal("ticket-addRemark",{onshow(t){document.getElementById("addRemark--ticketID").value=e,t.getElementsByTagName("form")[0].addEventListener("submit",s)},onshown(e,t){a=t}})}),i()})();