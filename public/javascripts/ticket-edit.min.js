"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t,n,o,c;const i=document.querySelector("#ticket--ticketID").value,l=""===i,s=document.querySelector("#container--form-message");function r(){cityssm.enableNavBlocker(),s.innerHTML='<span class="tag is-light is-info is-medium">\n      <span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span>\n      <span>Unsaved Changes</span>\n      </span>'}const a=document.querySelectorAll(".input, .select, .textarea");for(const e of a)e.addEventListener("change",r);function u(){cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:i},e=>{e.success&&(window.location.href="/tickets")})}let d;null===(e=document.querySelector("#form--ticket"))||void 0===e||e.addEventListener("submit",e=>{e.preventDefault();const t=document.querySelector("#ticket--ticketNumber").value;s.innerHTML='<span class="tag is-light is-info is-medium">\n        <span>Saving ticket... </span>\n        <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span>\n        </span>',cityssm.postJSON(l?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",e.currentTarget,e=>{const n=e;n.success?(cityssm.disableNavBlocker(),s.innerHTML='<span class="tag is-light is-success is-medium">\n              <span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span>\n              <span>Saved Successfully</span>\n              </span>'):(r(),cityssm.alertModal("Ticket Not Saved",n.message,"OK","danger")),n.success&&l&&cityssm.openHtmlModal("ticket-createSuccess",{onshow(){var e,o;document.querySelector("#createSuccess--ticketNumber").textContent=t,null===(e=document.querySelector("#createSuccess--editTicketButton"))||void 0===e||e.setAttribute("href",`/tickets/${n.ticketID.toString()}/edit`),null===(o=document.querySelector("#createSuccess--newTicketButton"))||void 0===o||o.setAttribute("href",`/tickets/new/${n.nextTicketNumber}`)}})})}),null===(t=document.querySelector("#is-delete-ticket-button"))||void 0===t||t.addEventListener("click",e=>{e.preventDefault(),bulmaJS.confirm({title:"Delete Ticket",message:"Are you sure you want to delete this ticket record?",contextualColorName:"danger",okButton:{text:"Yes, Delete Ticket",callbackFunction:u}})}),pts.getDefaultConfigProperty("locationClasses",()=>{var e,t;let n,o=[];function c(e){e.preventDefault(),document.querySelector("#ticket--locationKey").value="",document.querySelector("#ticket--locationName").value="",n(),o=[]}function i(e){var t;e.preventDefault();const c=o[Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10)];document.querySelector("#ticket--locationKey").value=c.locationKey,document.querySelector("#ticket--locationName").value=c.locationName,n(),o=[]}function l(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setLocation",{onshown(e,t){var l;n=t,cityssm.postJSON("/offences/doGetAllLocations",{},e=>{o=e;const t=document.createElement("div");t.className="panel mb-4";for(const[e,n]of o.entries()){const o=pts.getLocationClass(n.locationClassKey),c=document.createElement("a");c.className="panel-block is-block",c.dataset.index=e.toString(),c.setAttribute("href","#"),c.addEventListener("click",i),c.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(n.locationName)+"</div>"+((null==o?void 0:o.locationClass)?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(o.locationClass)+"</span></div>":"")+"</div>",t.append(c)}const n=document.querySelector("#container--parkingLocations");cityssm.clearElement(n),n.append(t)}),null===(l=document.querySelector("#is-clear-location-button"))||void 0===l||l.addEventListener("click",c)},onremoved(){document.querySelector("#is-location-lookup-button").focus()}})}null===(e=document.querySelector("#is-location-lookup-button"))||void 0===e||e.addEventListener("click",l),null===(t=document.querySelector("#ticket--locationName"))||void 0===t||t.addEventListener("dblclick",l)});let m=[],v=[];function y(e){var t,n,o,c,i,l;e.preventDefault(),document.querySelector("#ticket--bylawNumber").value="";const s=document.querySelector("#ticket--offenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),null===(n=null===(t=s.closest(".field"))||void 0===t?void 0:t.querySelector(".is-unlock-field-button"))||void 0===n||n.removeAttribute("disabled"),s.value="";const r=document.querySelector("#ticket--discountOffenceAmount");r.classList.add("is-readonly"),r.setAttribute("readonly","readonly"),null===(c=null===(o=r.closest(".field"))||void 0===o?void 0:o.querySelector(".is-unlock-field-button"))||void 0===c||c.removeAttribute("disabled"),r.value="";const a=document.querySelector("#ticket--discountDays");a.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),null===(l=null===(i=a.closest(".field"))||void 0===i?void 0:i.querySelector(".is-unlock-field-button"))||void 0===l||l.removeAttribute("disabled"),a.value="",document.querySelector("#ticket--parkingOffence").value="",d(),m=[]}function f(e){var t,n,o,c,i,l,s;e.preventDefault();const r=m[Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10)];document.querySelector("#ticket--bylawNumber").value=r.bylawNumber;const a=document.querySelector("#ticket--offenceAmount");a.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),null===(o=null===(n=a.closest(".field"))||void 0===n?void 0:n.querySelector(".is-unlock-field-button"))||void 0===o||o.removeAttribute("disabled"),a.value=r.offenceAmount.toFixed(2);const u=document.querySelector("#ticket--discountOffenceAmount");u.classList.add("is-readonly"),u.setAttribute("readonly","readonly"),null===(i=null===(c=u.closest(".field"))||void 0===c?void 0:c.querySelector(".is-unlock-field-button"))||void 0===i||i.removeAttribute("disabled"),u.value=r.discountOffenceAmount.toFixed(2);const v=document.querySelector("#ticket--discountDays");v.classList.add("is-readonly"),v.setAttribute("readonly","readonly"),null===(s=null===(l=v.closest(".field"))||void 0===l?void 0:l.querySelector(".is-unlock-field-button"))||void 0===s||s.removeAttribute("disabled"),v.value=r.discountDays.toString(),document.querySelector("#ticket--parkingOffence").value=r.bylawDescription,d(),m=[]}function b(e){const t=e.currentTarget.value.trim().toLowerCase().split(" ");for(const[e,n]of m.entries()){let o=!0;for(const e of t)if(!n.bylawNumber.toLowerCase().includes(e)&&!n.bylawDescription.toLowerCase().includes(e)){o=!1;break}o?v[e].classList.remove("is-hidden"):v[e].classList.add("is-hidden")}}function k(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown(e,t){var n;d=t,function(){const e=document.querySelector("#ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:e},e=>{m=e,v=[];const t=document.createElement("div");t.className="panel mb-4";for(const[e,n]of m.entries()){const o=document.createElement("a");o.className="panel-block is-block",o.dataset.index=e.toString(),o.setAttribute("href","#"),o.addEventListener("click",f),o.innerHTML=`<div class="columns">\n            <div class="column">\n              <span class="has-text-weight-semibold">\n                ${cityssm.escapeHTML(n.bylawNumber)}\n              </span><br />\n              <small>\n                ${cityssm.escapeHTML(n.bylawDescription)}\n              </small>\n            </div>\n            <div class="column is-narrow has-text-weight-semibold">\n              $${n.offenceAmount.toFixed(2)}\n            </div></div>`,t.append(o),v.push(o)}const n=document.querySelector("#container--bylawNumbers");cityssm.clearElement(n),n.append(t)})}();const o=document.querySelector("#bylawLookup--searchStr");o.focus(),o.addEventListener("keyup",b),null===(n=document.querySelector("#is-clear-bylaw-button"))||void 0===n||n.addEventListener("click",y)},onremoved(){document.querySelector("#is-bylaw-lookup-button").focus()}})}null===(n=document.querySelector("#is-bylaw-lookup-button"))||void 0===n||n.addEventListener("click",k),null===(o=document.querySelector("#ticket--bylawNumber"))||void 0===o||o.addEventListener("dblclick",k);{const e=document.querySelector("#ticket--licencePlateIsMissing");e.addEventListener("change",()=>{var t,n,o,c,i,l;e.checked?(null===(t=document.querySelector("#ticket--licencePlateCountry"))||void 0===t||t.removeAttribute("required"),null===(n=document.querySelector("#ticket--licencePlateProvince"))||void 0===n||n.removeAttribute("required"),null===(o=document.querySelector("#ticket--licencePlateNumber"))||void 0===o||o.removeAttribute("required")):(null===(c=document.querySelector("#ticket--licencePlateCountry"))||void 0===c||c.setAttribute("required","required"),null===(i=document.querySelector("#ticket--licencePlateProvince"))||void 0===i||i.setAttribute("required","required"),null===(l=document.querySelector("#ticket--licencePlateNumber"))||void 0===l||l.setAttribute("required","required"))})}function p(){const e=document.querySelector("#datalist--licencePlateProvince");cityssm.clearElement(e);const t=document.querySelector("#ticket--licencePlateCountry").value,n=pts.getLicencePlateCountryProperties(t);if(null==n?void 0:n.provinces){const t=Object.values(n.provinces);for(const n of t){const t=document.createElement("option");t.setAttribute("value",n.provinceShortName),e.append(t)}}}function S(e){var t,n;e.preventDefault();const o=e.currentTarget,c=null!==(t=o.dataset.unlock)&&void 0!==t?t:"",i=null===(n=o.closest(".field"))||void 0===n?void 0:n.querySelector(c);i.removeAttribute("readonly"),i.classList.remove("is-readonly"),i.focus(),o.setAttribute("disabled","disabled")}null===(c=document.querySelector("#ticket--licencePlateCountry"))||void 0===c||c.addEventListener("change",p),pts.loadDefaultConfigProperties(p);const q=document.querySelectorAll(".is-unlock-field-button");for(const e of q)e.addEventListener("click",S)})();