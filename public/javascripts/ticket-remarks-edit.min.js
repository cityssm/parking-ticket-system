"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=document.querySelector("#ticket--ticketId").value,a=document.querySelector("#is-remark-panel");let r=exports.ticketRemarks;function n(){const e=a.querySelectorAll(".panel-block");for(const t of e)t.remove()}function s(e){const a=e.currentTarget.dataset.remarkIndex;bulmaJS.confirm({title:"Delete Remark",message:"Are you sure you want to delete this remark?",contextualColorName:"warning",okButton:{text:"Yes, Delete",callbackFunction:function(){cityssm.postJSON("/tickets/doDeleteRemark",{ticketId:t,remarkIndex:a},e=>{e.success&&c()})}}})}function i(e){var a;let n;e.preventDefault();const s=Number.parseInt(null!==(a=e.currentTarget.dataset.index)&&void 0!==a?a:"-1",10),i=r[s];function o(e){e.preventDefault(),cityssm.postJSON("/tickets/doUpdateRemark",e.currentTarget,e=>{e.success&&(n(),c())})}cityssm.openHtmlModal("ticket-editRemark",{onshow(e){var a;document.querySelector("#editRemark--ticketId").value=t,document.querySelector("#editRemark--remarkIndex").value=i.remarkIndex.toString(),document.querySelector("#editRemark--remark").value=i.remark,document.querySelector("#editRemark--remarkDateString").value=i.remarkDateString,document.querySelector("#editRemark--remarkTimeString").value=i.remarkTimeString,null===(a=e.querySelector("form"))||void 0===a||a.addEventListener("submit",o)},onshown(e,t){n=t}})}function o(){var e,t,o,c;if(n(),0!==r.length)for(const[n,l]of r.entries()){const r=document.createElement("div");r.className="panel-block is-block",r.innerHTML=`<div class="columns">\n          <div class="column">\n            <p class="has-newline-chars">\n              ${cityssm.escapeHTML(l.remark)}\n            </p>\n            <p class="is-size-7">\n            ${l.recordCreate_timeMillis===l.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> '}\n            ${l.recordUpdate_userName}\n            - ${l.remarkDateString} ${l.remarkTimeString}\n            </p>\n          </div>\n          ${null!==(e=l.canUpdate)&&void 0!==e&&e?`<div class="column is-narrow">\n                  <div class="buttons is-right has-addons">\n                    <button class="button is-small is-edit-remark-button" data-cy="edit-remark" data-tooltip="Edit Remark" data-index="${n.toString()}" type="button">\n                      <span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span>\n                      <span>Edit</span>\n                    </button>\n                    <button class="button is-small has-text-danger is-delete-remark-button" data-cy="delete-remark" data-tooltip="Delete Remark" data-remark-index="${l.remarkIndex.toString()}" type="button">\n                      <i class="fas fa-trash" aria-hidden="true"></i>\n                      <span class="sr-only">Delete</span>\n                    </button>\n                  </div>\n                  </div>`:""}\n        </div>`,null!==(t=l.canUpdate)&&void 0!==t&&t&&(null===(o=r.querySelector(".is-edit-remark-button"))||void 0===o||o.addEventListener("click",i),null===(c=r.querySelector(".is-delete-remark-button"))||void 0===c||c.addEventListener("click",s)),a.append(r)}else a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block">\n          <div class="message is-info"><p class="message-body">There are no remarks associated with this ticket.</p></div>\n          </div>')}function c(){n(),a.insertAdjacentHTML("beforeend",'<div class="panel-block is-block">\n        <p class="has-text-centered has-text-grey-lighter">\n        <i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br />\n        <em>Loading remarks...</em>\n        </p>\n        </div>'),cityssm.postJSON("/tickets/doGetRemarks",{ticketId:t},e=>{r=e,o()})}delete exports.ticketRemarks,null===(e=document.querySelector("#is-add-remark-button"))||void 0===e||e.addEventListener("click",e=>{let a;function r(e){e.preventDefault(),cityssm.postJSON("/tickets/doAddRemark",e.currentTarget,e=>{e.success&&(a(),c())})}e.preventDefault(),cityssm.openHtmlModal("ticket-addRemark",{onshow(e){var a;document.querySelector("#addRemark--ticketId").value=t,null===(a=e.querySelector("form"))||void 0===a||a.addEventListener("submit",r)},onshown(e,t){a=t}})}),o()})();