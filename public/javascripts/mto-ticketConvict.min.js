"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var t="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-update"),e=document.getElementById("filter--parkingTicket"),a=document.getElementById("is-convictable-tickets-container"),s=exports.currentBatch;delete exports.currentBatch;var i=exports.convictableTickets;delete exports.convictableTickets;var n=[];function c(t){t.preventDefault();var e=t.currentTarget.getAttribute("data-ticket-id");cityssm.postJSON("/tickets/doAddTicketToConvictionBatch",{batchID:s.batchID,ticketID:e},function(t){})}function r(t){t.preventDefault(),cityssm.postJSON("/tickets/doAddAllTicketsToConvictionBatch",{batchID:s.batchID,ticketIDs:n},function(t){})}function l(){if(cityssm.clearElement(a),n=[],null!==s)if(0!==i.length){for(var t=e.value.trim().toLowerCase(),l=document.createElement("tbody"),o=0;o<i.length;o+=1){var d=i[o];if(-1!==d.ticketNumber.toLowerCase().indexOf(t)||-1!==d.licencePlateNumber.toLowerCase().indexOf(t)){n.push(d.ticketID);var u=document.createElement("tr");u.innerHTML='<td><a data-tooltip="View Ticket (Opens in New Window)" href="/tickets/'+d.ticketID+'" target="_blank">'+cityssm.escapeHTML(d.ticketNumber)+'</a></td><td><span class="licence-plate-number is-size-6">'+cityssm.escapeHTML(d.licencePlateNumber)+'</span><br /><span class="has-tooltip-right is-size-7" data-tooltip="Primary Owner">'+cityssm.escapeHTML(d.licencePlateOwner_ownerName1)+"</span></td><td>"+d.issueDateString+'</td><td class="has-text-right"><button class="button is-small" data-ticket-id="'+d.ticketID+'" type="button"><span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add</span></button></td>',u.getElementsByTagName("button")[0].addEventListener("click",c),l.appendChild(u)}}if(0!==n.length){var m=document.createElement("button");m.className="button is-fullwidth has-margin-bottom-10",m.innerHTML='<span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add '+n.length+" Parking Ticket"+(1===n.length?"":"s")+"</span>",m.addEventListener("click",r),a.appendChild(m);var h=document.createElement("table");h.className="table is-striped is-hoverable is-fullwidth",h.innerHTML="<thead><tr><th>Ticket Number</th><th>Licence Plate</th><th>Issue Date</th><th></th></tr></thead>",h.appendChild(l),a.appendChild(h)}else a.innerHTML='<div class="message is-info"><div class="message-body">There are no parking tickets that meet the search criteria.</div></div>'}else a.innerHTML='<div class="message is-info"><div class="message-body">There are no parking tickets currently eligible for conviction.</div></div>';else a.innerHTML='<div class="message is-warning"><div class="message-body">Select a target batch to get started.</div></div>'}function o(){document.getElementById("batchSelector--batchID").innerText="Batch #"+s.batchID}l(),e.addEventListener("keyup",l),document.getElementById("is-select-batch-button").addEventListener("click",function(e){var a;e.preventDefault();var i=function(t){t.preventDefault();var e=t.currentTarget.getAttribute("data-batch-id");cityssm.postJSON("/tickets/doGetConvictionBatch",{batchID:e},function(t){s=t,o()}),a()};cityssm.openHtmlModal("mto-selectBatch",{onshow:function(e){if(t){var n=e.getElementsByClassName("is-create-batch-button")[0];n.classList.remove("is-hidden"),n.addEventListener("click",function(t){t.preventDefault(),a(),cityssm.confirmModal("Create a New Batch","Are you sure you want to create a new conviction batch?","Yes, Create Batch","info",function(){cityssm.postJSON("/tickets/doCreateConvictionBatch",{},function(t){t.success&&(s=t.batch,o())})})})}cityssm.postJSON("/tickets/doGetRecentConvictionBatches",[],function(t){var a=e.getElementsByClassName("is-results-container")[0];if(cityssm.clearElement(a),0===t.length)return a.className="message is-info",void(a.innerHTML='<div class="message-body">There are no recent conviction batches.</div>');a.className="list is-hoverable";for(var s=0;s<t.length;s+=1){var n=t[s],c=document.createElement("a");c.className="list-item",c.setAttribute("data-batch-id",n.batchID.toString()),c.href="#",c.innerHTML='<div class="columns"><div class="column is-narrow">#'+n.batchID+'</div><div class="column has-text-right">'+n.batchDateString+(n.lockDate?'<br /><div class="tags justify-flex-end"><span class="tag"><span class="icon is-small"><i class="fas fa-lock" aria-hidden="true"></i></span><span>Locked</span></span>':"")+"</div></div>",c.addEventListener("click",i),a.appendChild(c)}})},onshown:function(t,e){a=e}})}),s&&o()}();