"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("#ticket--ticketID").value,t=document.querySelector("#is-remark-panel");let r=exports.ticketRemarks;delete exports.ticketRemarks;const a=()=>{const e=t.querySelectorAll(".panel-block");for(const t of e)t.remove()},s=t=>{const r=t.currentTarget.dataset.remarkIndex;cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this remark?","Yes, Delete","warning",()=>{cityssm.postJSON("/tickets/doDeleteRemark",{ticketID:e,remarkIndex:r},e=>{e.success&&c()})})},i=t=>{let a;t.preventDefault();const s=Number.parseInt(t.currentTarget.dataset.index,10),i=r[s],n=e=>{e.preventDefault(),cityssm.postJSON("/tickets/doUpdateRemark",e.currentTarget,e=>{e.success&&(a(),c())})};cityssm.openHtmlModal("ticket-editRemark",{onshow(t){document.querySelector("#editRemark--ticketID").value=e,document.querySelector("#editRemark--remarkIndex").value=i.remarkIndex.toString(),document.querySelector("#editRemark--remark").value=i.remark,document.querySelector("#editRemark--remarkDateString").value=i.remarkDateString,document.querySelector("#editRemark--remarkTimeString").value=i.remarkTimeString,t.querySelector("form").addEventListener("submit",n)},onshown(e,t){a=t}})},n=()=>{if(a(),0!==r.length)for(const[e,a]of r.entries()){const r=document.createElement("div");r.className="panel-block is-block",r.innerHTML='<div class="columns"><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(a.remark)+'</p><p class="is-size-7">'+(a.recordCreate_timeMillis===a.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+a.recordUpdate_userName+" - "+a.remarkDateString+" "+a.remarkTimeString+"</p></div>"+(a.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-cy="edit-remark" data-tooltip="Edit Remark" data-index="'+e.toString()+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-cy="delete-remark" data-tooltip="Delete Remark" data-remark-index="'+a.remarkIndex.toString()+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div>",a.canUpdate&&(r.querySelector(".is-edit-remark-button").addEventListener("click",i),r.querySelector(".is-delete-remark-button").addEventListener("click",s)),t.append(r)}else t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this ticket.</p></div></div>')},c=()=>{a(),t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading remarks...</p></div>'),cityssm.postJSON("/tickets/doGetRemarks",{ticketID:e},e=>{r=e,n()})};document.querySelector("#is-add-remark-button").addEventListener("click",t=>{let r;t.preventDefault();const a=e=>{e.preventDefault(),cityssm.postJSON("/tickets/doAddRemark",e.currentTarget,e=>{e.success&&(r(),c())})};cityssm.openHtmlModal("ticket-addRemark",{onshow(t){document.querySelector("#addRemark--ticketID").value=e,t.querySelector("form").addEventListener("submit",a)},onshown(e,t){r=t}})}),n()})();