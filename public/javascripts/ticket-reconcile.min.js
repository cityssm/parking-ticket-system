"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){function t(t){t.preventDefault();var e=t.currentTarget;e.setAttribute("disabled","disabled");var s=e.getAttribute("data-batch-id"),a=e.getAttribute("data-log-index");cityssm.postJSON("/tickets/doAcknowledgeLookupError",{batchID:s,logIndex:a},function(t){if(t.success){var s=e.closest("td");cityssm.clearElement(s),s.innerHTML='<span class="tag is-light is-warning"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Acknowledged</span></span>'}else e.removeAttribute("disabled")})}pts.initializeToggleHiddenLinks(document.getElementsByTagName("main")[0]);for(var e=document.getElementsByClassName("is-acknowledge-error-button"),s=0;s<e.length;s+=1)e[s].addEventListener("click",t);function a(t){t.preventDefault();var e=t.currentTarget,s=e.closest("td"),a=s.closest("tr");cityssm.confirmModal("Clear Status","Are you sure you want to undo this status?","Yes, Remove the Status","warning",function(){cityssm.postJSON("/tickets/doDeleteStatus",{ticketID:a.getAttribute("data-ticket-id"),statusIndex:e.getAttribute("data-status-index")},function(t){t.success&&(cityssm.clearElement(s),s.classList.remove("has-width-200"),s.innerHTML='<button class="button is-success is-ownership-match-button" type="button"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></button> <button class="button is-danger is-ownership-error-button" type="button"><i class="fas fa-times" aria-hidden="true"></i><span class="sr-only">Error</span></button>',s.getElementsByClassName("is-ownership-match-button")[0].addEventListener("click",i),s.getElementsByClassName("is-ownership-error-button")[0].addEventListener("click",c))})})}function i(t){t.preventDefault();var e=t.currentTarget,s=e.closest("td"),i=s.closest("tr"),c=function(){e.setAttribute("disabled","disabled");var t=i.getAttribute("data-licence-plate-country"),c=i.getAttribute("data-licence-plate-province"),n=i.getAttribute("data-licence-plate-number"),r=i.getAttribute("data-ticket-id"),l=i.getAttribute("data-record-date");cityssm.postJSON("/tickets/doReconcileAsMatch",{licencePlateCountry:t,licencePlateProvince:c,licencePlateNumber:n,ticketID:r,recordDate:l},function(t){t.success?(cityssm.clearElement(s),s.innerHTML='<div class="tags has-addons"><span class="tag is-light is-success"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+t.statusIndex+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',s.getElementsByTagName("a")[0].addEventListener("click",a)):(e.removeAttribute("disabled"),cityssm.alertModal("Record Not Updated",t.message,"OK","danger"))})};if(i.hasAttribute("data-is-vehicle-make-match")&&i.hasAttribute("data-is-licence-plate-expiry-date-match"))c();else{var n=i.getAttribute("data-ticket-vehicle"),r=i.getAttribute("data-ticket-expiry-date"),l=i.getAttribute("data-owner-vehicle"),o=i.getAttribute("data-owner-expiry-date");cityssm.confirmModal("Confirm Match",'<p class="has-text-centered">Are you sure the details on the parking ticket match the details on the ownership record?</p><div class="columns has-margin-top-5"><div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(n)+'</span><br /><span class="is-size-5">'+(""===r?"(Not Set)":cityssm.escapeHTML(r))+'</span></div><div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(l)+'</span><br /><span class="is-size-5">'+cityssm.escapeHTML(o)+"</span></div></div>","Yes, Confirm Match","warning",c)}}function c(t){t.preventDefault();var e=t.currentTarget,s=e.closest("td"),i=s.closest("tr"),c=function(){e.setAttribute("disabled","disabled");var t=i.getAttribute("data-licence-plate-country"),c=i.getAttribute("data-licence-plate-province"),n=i.getAttribute("data-licence-plate-number"),r=i.getAttribute("data-ticket-id"),l=i.getAttribute("data-record-date");cityssm.postJSON("/tickets/doReconcileAsError",{licencePlateCountry:t,licencePlateProvince:c,licencePlateNumber:n,ticketID:r,recordDate:l},function(t){t.success?(cityssm.clearElement(s),s.innerHTML='<div class="tags has-addons"><span class="tag is-light is-danger"><span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span><span>Match Error</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+t.statusIndex+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',s.getElementsByTagName("a")[0].addEventListener("click",a)):(e.removeAttribute("disabled"),cityssm.alertModal("Record Not Updated",t.message,"OK","danger"))})};if(i.hasAttribute("data-is-vehicle-make-match")||i.hasAttribute("data-is-licence-plate-expiry-date-match")){var n=i.getAttribute("data-ticket-vehicle"),r=i.getAttribute("data-ticket-expiry-date"),l=i.getAttribute("data-owner-vehicle"),o=i.getAttribute("data-owner-expiry-date");cityssm.confirmModal("Confirm Error",'<p class="has-text-centered">Are you sure you want to mark an error between the details on the parking ticket and the details on the ownership record?</p><div class="columns has-margin-top-5"><div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(n)+'</span><br /><span class="is-size-5">'+(""===r?"(Not Set)":cityssm.escapeHTML(r))+'</span></div><div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(l)+'</span><br /><span class="is-size-5">'+cityssm.escapeHTML(o)+"</span></div></div>","Yes, Confirm Error","warning",c)}else c()}var n=document.getElementsByClassName("is-ownership-match-button");for(s=0;s<n.length;s+=1)n[s].addEventListener("click",i);var r=document.getElementsByClassName("is-ownership-error-button");for(s=0;s<r.length;s+=1)r[s].addEventListener("click",c);var l=document.getElementById("is-quick-reconcile-matches-button");l&&l.addEventListener("click",function(t){var e;t.preventDefault();cityssm.confirmModal("Quick Reconcile Matches","Are you sure you want to mark all parking tickets with matching vehicle makes and plate expiry dates as matched?","Yes, Mark All Matches as Matched","info",function(){cityssm.openHtmlModal("loading",{onshown:function(t,s){document.getElementById("is-loading-modal-message").innerText="Reconciling matches...",e=s,cityssm.postJSON("/tickets/doQuickReconcileMatches",{},function(t){if(e(),t.success){cityssm.alertModal("Quick Reconcile Complete",1===t.statusRecords.length?"One record was successfully reconciled as a match.":t.statusRecords.length+" records were successfully reconciled as matches.","OK","success");for(var s=0;s<t.statusRecords.length;s+=1){var i=t.statusRecords[s],c=document.getElementById("is-options-cell--"+i.ticketID);c&&(cityssm.clearElement(c),c.innerHTML='<div class="tags has-addons"><span class="tag is-light is-success"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+i.statusIndex+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',c.getElementsByTagName("a")[0].addEventListener("click",a))}}})}})})})}();