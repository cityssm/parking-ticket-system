"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const t=document.getElementById("ticket--ticketID").value,e=document.getElementById("is-status-panel");let s=exports.ticketStatusLog;delete exports.ticketStatusLog;const a=()=>{const t=e.getElementsByClassName("panel-block");for(;t.length>0;)t[0].remove()},i=e=>{e.preventDefault(),cityssm.confirmModal("Mark Ticket as Resolved?","Once resolved, you will no longer be able to make changes to the ticket.","Yes, Resolve Ticket","info",()=>{cityssm.postJSON("/tickets/doResolveTicket",{ticketID:t},e=>{e.success&&(window.location.href="/tickets/"+t)})})},n=e=>{const s=e.currentTarget.getAttribute("data-status-index");cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this status?","Yes, Delete","warning",()=>{cityssm.postJSON("/tickets/doDeleteStatus",{ticketID:t,statusIndex:s},t=>{t.success&&c()})})},d=e=>{let a;e.preventDefault();const i=parseInt(e.currentTarget.getAttribute("data-index"),10),n=s[i],d=t=>{t.preventDefault(),cityssm.postJSON("/tickets/doUpdateStatus",t.currentTarget,t=>{t.success&&(a(),c())})},l=t=>{const e=pts.getTicketStatus(t.currentTarget.value),s=document.getElementById("editStatus--statusField");if(s.value="",e&&e.statusField){const t=s.closest(".field");t.getElementsByTagName("label")[0].innerText=e.statusField.fieldLabel,t.classList.remove("is-hidden")}else s.closest(".field").classList.add("is-hidden");const a=document.getElementById("editStatus--statusField2");if(a.value="",e&&e.statusField2){const t=a.closest(".field");t.getElementsByTagName("label")[0].innerText=e.statusField2.fieldLabel,t.classList.remove("is-hidden")}else s.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-editStatus",{onshow(e){document.getElementById("editStatus--ticketID").value=t,document.getElementById("editStatus--statusIndex").value=n.statusIndex,document.getElementById("editStatus--statusField").value=n.statusField,document.getElementById("editStatus--statusField2").value=n.statusField2,document.getElementById("editStatus--statusNote").value=n.statusNote;const s=document.getElementById("editStatus--statusDateString");s.value=n.statusDateString,s.setAttribute("max",cityssm.dateToString(new Date)),document.getElementById("editStatus--statusTimeString").value=n.statusTimeString,pts.getDefaultConfigProperty("parkingTicketStatuses",t=>{let e=!1;const s=document.getElementById("editStatus--statusKey");for(const a of t)if((a.isUserSettable||a.statusKey===n.statusKey)&&(s.insertAdjacentHTML("beforeend",'<option value="'+a.statusKey+'">'+a.status+"</option>"),a.statusKey===n.statusKey)){if(e=!0,a.statusField){const t=document.getElementById("editStatus--statusField").closest(".field");t.getElementsByTagName("label")[0].innerText=a.statusField.fieldLabel,t.classList.remove("is-hidden")}if(a.statusField2){const t=document.getElementById("editStatus--statusField2").closest(".field");t.getElementsByTagName("label")[0].innerText=a.statusField2.fieldLabel,t.classList.remove("is-hidden")}}e||s.insertAdjacentHTML("beforeend",'<option value="'+n.statusKey+'">'+n.statusKey+"</option>"),s.value=n.statusKey,s.addEventListener("change",l)}),e.getElementsByTagName("form")[0].addEventListener("submit",d)},onshown(t,e){a=e}})},l=()=>{if(a(),0===s.length)return void e.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no statuses associated with this ticket.</p></div></div>');for(const t of s){const s=pts.getTicketStatus(t.statusKey),a=document.createElement("div");a.className="panel-block is-block",a.innerHTML='<div class="columns"><div class="column"><div class="level mb-1"><div class="level-left"><strong>'+(s?s.status:t.statusKey)+'</strong></div><div class="level-right">'+t.statusDateString+"</div></div>"+(t.statusField&&""!==t.statusField?'<p class="is-size-7"><strong>'+(s&&s.statusField?s.statusField.fieldLabel:"")+":</strong> "+t.statusField+"</p>":"")+(t.statusField2&&""!==t.statusField2?'<p class="is-size-7"><strong>'+(s&&s.statusField2?s.statusField2.fieldLabel:"")+":</strong> "+t.statusField2+"</p>":"")+'<p class="has-newline-chars is-size-7">'+t.statusNote+"</p></div></div>",e.appendChild(a)}const t=s[0];if(t.canUpdate){const s=e.getElementsByClassName("panel-block")[0].getElementsByClassName("columns")[0];s.insertAdjacentHTML("beforeend",'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-status-button" data-tooltip="Edit Status" data-index="0" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-status-button" data-tooltip="Delete Status" data-status-index="'+t.statusIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>'),s.getElementsByClassName("is-edit-status-button")[0].addEventListener("click",d),s.getElementsByClassName("is-delete-status-button")[0].addEventListener("click",n)}const l=pts.getTicketStatus(t.statusKey);if(l&&l.isFinalStatus){const t=document.createElement("div");t.className="panel-block is-block",t.innerHTML='<div class="message is-info is-clearfix"><div class="message-body"><div class="columns"><div class="column"><strong>This ticket is able to be marked as resolved.</strong></div><div class="column is-narrow has-text-right align-self-flex-end"><button class="button is-info" type="button"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Resolve Ticket</span></button></div></div></div></div>',t.getElementsByTagName("button")[0].addEventListener("click",i),e.insertAdjacentElement("afterbegin",t)}},c=()=>{a(),e.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading statuses...</p></div>'),cityssm.postJSON("/tickets/doGetStatuses",{ticketID:t},t=>{s=t,l()})};document.getElementById("is-add-status-button").addEventListener("click",e=>{let s;e.preventDefault();const a=e=>{e.preventDefault();const a=document.getElementById("addStatus--resolveTicket").checked;cityssm.postJSON("/tickets/doAddStatus",e.currentTarget,e=>{e.success&&(s(),a?window.location.href="/tickets/"+t:c())})},i=t=>{const e=pts.getTicketStatus(t.currentTarget.value),s=document.getElementById("addStatus--statusField");if(s.value="",e&&e.statusField){const t=s.closest(".field");t.getElementsByTagName("label")[0].innerText=e.statusField.fieldLabel,t.classList.remove("is-hidden")}else s.closest(".field").classList.add("is-hidden");const a=document.getElementById("addStatus--statusField2");if(a.value="",e&&e.statusField2){const t=a.closest(".field");t.getElementsByTagName("label")[0].innerText=e.statusField2.fieldLabel,t.classList.remove("is-hidden")}else a.closest(".field").classList.add("is-hidden");const i=document.getElementById("addStatus--resolveTicket");i.checked=!1,e&&e.isFinalStatus?i.closest(".field").classList.remove("is-hidden"):i.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-addStatus",{onshow(e){document.getElementById("addStatus--ticketID").value=t,pts.getDefaultConfigProperty("parkingTicketStatuses",t=>{const e=document.getElementById("addStatus--statusKey");for(const s of t)s.isUserSettable&&e.insertAdjacentHTML("beforeend",'<option value="'+s.statusKey+'">'+s.status+"</option>");e.addEventListener("change",i)}),e.getElementsByTagName("form")[0].addEventListener("submit",a)},onshown(t,e){s=e}})}),document.getElementById("is-add-paid-status-button").addEventListener("click",e=>{let s;e.preventDefault();const a=e=>{e.preventDefault();const a=document.getElementById("addPaidStatus--resolveTicket").checked;cityssm.postJSON("/tickets/doAddStatus",e.currentTarget,e=>{e.success&&(s(),a?window.location.href="/tickets/"+t:c())})};cityssm.openHtmlModal("ticket-addStatusPaid",{onshow(e){document.getElementById("addPaidStatus--ticketID").value=t;const s=document.getElementById("addPaidStatus--statusField"),i=document.getElementById("ticket--offenceAmount").value;let n=document.getElementById("ticket--issueDateString").value,d=document.getElementById("ticket--discountDays").value;if(""===n||""===d)s.value=i;else{const t=cityssm.dateToString(new Date);cityssm.dateStringDifferenceInDays(n,t)<=parseInt(d,10)?s.value=document.getElementById("ticket--discountOffenceAmount").value:s.value=i}e.getElementsByTagName("form")[0].addEventListener("submit",a)},onshown(t,e){s=e}})}),pts.loadDefaultConfigProperties(l)})();