"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementById("bylawFilter--bylaw"),t=document.getElementById("bylawResults");let a=exports.bylaws;delete exports.bylaws;const s=e=>{e.preventDefault();const t=parseInt(e.currentTarget.getAttribute("data-index"),10),s=a[t];let n;const l=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffencesByBylaw",e.currentTarget,e=>{e.success&&(n(),a=e.bylaws,o())})};cityssm.openHtmlModal("bylaw-updateOffences",{onshow(){document.getElementById("updateOffences--bylawNumber").value=s.bylawNumber,document.getElementById("updateOffences--bylawDescription").value=s.bylawDescription,document.getElementById("updateOffences--offenceAmount").value=s.offenceAmountMin.toFixed(2),document.getElementById("updateOffences--discountDays").value=s.discountDaysMin.toString(),document.getElementById("updateOffences--discountOffenceAmount").value=s.discountOffenceAmountMin.toFixed(2)},onshown(e,t){n=t,e.getElementsByTagName("form")[0].addEventListener("submit",l)}})},n=e=>{e.preventDefault();const t=parseInt(e.currentTarget.getAttribute("data-index"),10),s=a[t];let n;const l=()=>{cityssm.postJSON("/admin/doDeleteBylaw",{bylawNumber:s.bylawNumber},e=>{e.success&&(n(),a=e.bylaws,o())})},d=e=>{e.preventDefault(),cityssm.confirmModal("Delete By-Law",'Are you sure you want to remove by-law "'+s.bylawNumber+'" from the list of available options?',"Yes, Remove By-Law","danger",l)},i=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateBylaw",e.currentTarget,e=>{e.success&&(n(),a=e.bylaws,o())})};cityssm.openHtmlModal("bylaw-edit",{onshow(){document.getElementById("editBylaw--bylawNumber").value=s.bylawNumber,document.getElementById("editBylaw--bylawDescription").value=s.bylawDescription},onshown(e,t){n=t,e.getElementsByTagName("form")[0].addEventListener("submit",i),e.getElementsByClassName("is-delete-button")[0].addEventListener("click",d)}})},o=()=>{let o=0;const l=e.value.trim().toLowerCase().split(" "),d=document.createElement("tbody");a.forEach((e,t)=>{let a=!0;const i=e.bylawNumber.toLowerCase(),r=e.bylawDescription.toLowerCase();for(const e of l)if(!i.includes(e)&&!r.includes(e)){a=!1;break}if(!a)return;o+=1;const c=document.createElement("tr");let m="",u=!1;e.offenceAmountMin?(u=!0,m="$"+e.offenceAmountMin.toFixed(2),e.offenceAmountMin!==e.offenceAmountMax&&(m+=" to $"+e.offenceAmountMax.toFixed(2)),m='<a class="has-tooltip-left" data-tooltip="Update Offence Amounts" data-index="'+t.toString()+'" href="#">'+m+"</a>"):m="(No Offences)",c.innerHTML='<td><a data-index="'+t.toString()+'" href="#">'+cityssm.escapeHTML(e.bylawNumber)+'</a></td><td class="has-border-right-width-2">'+cityssm.escapeHTML(e.bylawDescription)+'</td><td class="has-text-right">'+e.offenceCount.toString()+'</td><td class="has-text-right">'+m+"</td>",c.getElementsByTagName("a")[0].addEventListener("click",n),u&&c.getElementsByTagName("a")[1].addEventListener("click",s),d.appendChild(c)}),cityssm.clearElement(t),0!==o?(t.innerHTML='<table class="table is-striped is-hoverable is-fullwidth"><thead><tr><th>By-Law Number</th><th class="has-border-right-width-2">Description</th><th class="has-text-right">Total Offences</th><th class="has-text-right">Offence Amount Range</th></tr></thead></table>',t.getElementsByTagName("table")[0].appendChild(d)):t.innerHTML='<div class="message is-info"><div class="message-body">There are no by-laws that meet your search criteria.</div></div>'};e.addEventListener("keyup",o),o(),document.getElementById("is-add-bylaw-button").addEventListener("click",e=>{let t;e.preventDefault();const s=e=>{e.preventDefault(),cityssm.postJSON("/admin/doAddBylaw",e.currentTarget,e=>{e.success?(t(),e.message&&cityssm.alertModal("By-Law Added",e.message,"OK","warning"),a=e.bylaws,o()):cityssm.alertModal("By-Law Not Added",e.message,"OK","danger")})};cityssm.openHtmlModal("bylaw-add",{onshown(e,a){t=a,e.getElementsByTagName("form")[0].addEventListener("submit",s)}})})})();