"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var t=document.getElementById("ticket--ticketID").value,e=document.getElementById("is-status-panel"),s=exports.ticketStatusLog;delete exports.ticketStatusLog;var a=function(){for(var t=e.getElementsByClassName("panel-block");t.length>0;)t[0].remove()},i=function(e){e.preventDefault(),cityssm.confirmModal("Mark Ticket as Resolved?","Once resolved, you will no longer be able to make changes to the ticket.","Yes, Resolve Ticket","info",function(){cityssm.postJSON("/tickets/doResolveTicket",{ticketID:t},function(e){e.success&&(window.location.href="/tickets/"+t)})})},n=function(e){var s=e.currentTarget.getAttribute("data-status-index");cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this status?","Yes, Delete","warning",function(){cityssm.postJSON("/tickets/doDeleteStatus",{ticketID:t,statusIndex:s},function(t){t.success&&u()})})},d=function(e){var a;e.preventDefault();var i=parseInt(e.currentTarget.getAttribute("data-index"),10),n=s[i],d=function(t){t.preventDefault(),cityssm.postJSON("/tickets/doUpdateStatus",t.currentTarget,function(t){t.success&&(a(),u())})},l=function(t){var e=pts.getTicketStatus(t.currentTarget.value),s=document.getElementById("editStatus--statusField");(s.value="",e&&e.statusField)?((a=s.closest(".field")).getElementsByTagName("label")[0].innerText=e.statusField.fieldLabel,a.classList.remove("is-hidden")):s.closest(".field").classList.add("is-hidden");var a,i=document.getElementById("editStatus--statusField2");(i.value="",e&&e.statusField2)?((a=i.closest(".field")).getElementsByTagName("label")[0].innerText=e.statusField2.fieldLabel,a.classList.remove("is-hidden")):s.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-editStatus",{onshow:function(e){document.getElementById("editStatus--ticketID").value=t,document.getElementById("editStatus--statusIndex").value=n.statusIndex,document.getElementById("editStatus--statusField").value=n.statusField,document.getElementById("editStatus--statusField2").value=n.statusField2,document.getElementById("editStatus--statusNote").value=n.statusNote;var s=document.getElementById("editStatus--statusDateString");s.value=n.statusDateString,s.setAttribute("max",cityssm.dateToString(new Date)),document.getElementById("editStatus--statusTimeString").value=n.statusTimeString,pts.getDefaultConfigProperty("parkingTicketStatuses",function(t){for(var e=!1,s=document.getElementById("editStatus--statusKey"),a=0;a<t.length;a+=1){var i=t[a];if((i.isUserSettable||i.statusKey===n.statusKey)&&(s.insertAdjacentHTML("beforeend",'<option value="'+i.statusKey+'">'+i.status+"</option>"),i.statusKey===n.statusKey)){var d;if(e=!0,i.statusField)(d=document.getElementById("editStatus--statusField").closest(".field")).getElementsByTagName("label")[0].innerText=i.statusField.fieldLabel,d.classList.remove("is-hidden");if(i.statusField2)(d=document.getElementById("editStatus--statusField2").closest(".field")).getElementsByTagName("label")[0].innerText=i.statusField2.fieldLabel,d.classList.remove("is-hidden")}}e||s.insertAdjacentHTML("beforeend",'<option value="'+n.statusKey+'">'+n.statusKey+"</option>"),s.value=n.statusKey,s.addEventListener("change",l)}),e.getElementsByTagName("form")[0].addEventListener("submit",d)},onshown:function(t,e){a=e}})},l=function(){if(a(),0!==s.length)for(var t=0;t<s.length;t+=1){var l=s[t],u=pts.getTicketStatus(l.statusKey);if(0===t&&u&&u.isFinalStatus){var c=document.createElement("div");c.className="panel-block is-block",c.innerHTML='<div class="message is-info is-clearfix"><div class="message-body"><div class="columns"><div class="column"><strong>This ticket is able to be marked as resolved.</strong></div><div class="column is-narrow has-text-right align-self-flex-end"><button class="button is-info" type="button"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Resolve Ticket</span></button></div></div></div></div>',c.getElementsByTagName("button")[0].addEventListener("click",i),e.appendChild(c)}var o=document.createElement("div");o.className="panel-block is-block",o.innerHTML='<div class="columns"><div class="column"><div class="level mb-1"><div class="level-left"><strong>'+(u?u.status:l.statusKey)+'</strong></div><div class="level-right">'+l.statusDateString+"</div></div>"+(l.statusField&&""!==l.statusField?'<p class="is-size-7"><strong>'+(u&&u.statusField?u.statusField.fieldLabel:"")+":</strong> "+l.statusField+"</p>":"")+(l.statusField2&&""!==l.statusField2?'<p class="is-size-7"><strong>'+(u&&u.statusField2?u.statusField2.fieldLabel:"")+":</strong> "+l.statusField2+"</p>":"")+'<p class="has-newline-chars is-size-7">'+l.statusNote+"</p></div>"+(l.canUpdate&&0===t?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-status-button" data-tooltip="Edit Status" data-index="'+t+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-status-button" data-tooltip="Delete Status" data-status-index="'+l.statusIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div>",l.canUpdate&&0===t&&(o.getElementsByClassName("is-edit-status-button")[0].addEventListener("click",d),o.getElementsByClassName("is-delete-status-button")[0].addEventListener("click",n)),e.appendChild(o)}else e.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no statuses associated with this ticket.</p></div></div>')},u=function(){a(),e.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading statuses...</p></div>'),cityssm.postJSON("/tickets/doGetStatuses",{ticketID:t},function(t){s=t,l()})};document.getElementById("is-add-status-button").addEventListener("click",function(e){var s;e.preventDefault();var a=function(e){e.preventDefault();var a=document.getElementById("addStatus--resolveTicket").checked;cityssm.postJSON("/tickets/doAddStatus",e.currentTarget,function(e){e.success&&(s(),a?window.location.href="/tickets/"+t:u())})},i=function(t){var e=pts.getTicketStatus(t.currentTarget.value),s=document.getElementById("addStatus--statusField");(s.value="",e&&e.statusField)?((a=s.closest(".field")).getElementsByTagName("label")[0].innerText=e.statusField.fieldLabel,a.classList.remove("is-hidden")):s.closest(".field").classList.add("is-hidden");var a,i=document.getElementById("addStatus--statusField2");(i.value="",e&&e.statusField2)?((a=i.closest(".field")).getElementsByTagName("label")[0].innerText=e.statusField2.fieldLabel,a.classList.remove("is-hidden")):i.closest(".field").classList.add("is-hidden");var n=document.getElementById("addStatus--resolveTicket");n.checked=!1,e&&e.isFinalStatus?n.closest(".field").classList.remove("is-hidden"):n.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-addStatus",{onshow:function(e){document.getElementById("addStatus--ticketID").value=t,pts.getDefaultConfigProperty("parkingTicketStatuses",function(t){for(var e=document.getElementById("addStatus--statusKey"),s=0;s<t.length;s+=1){var a=t[s];a.isUserSettable&&e.insertAdjacentHTML("beforeend",'<option value="'+a.statusKey+'">'+a.status+"</option>")}e.addEventListener("change",i)}),e.getElementsByTagName("form")[0].addEventListener("submit",a)},onshown:function(t,e){s=e}})}),document.getElementById("is-add-paid-status-button").addEventListener("click",function(e){var s;e.preventDefault();var a=function(e){e.preventDefault();var a=document.getElementById("addPaidStatus--resolveTicket").checked;cityssm.postJSON("/tickets/doAddStatus",e.currentTarget,function(e){e.success&&(s(),a?window.location.href="/tickets/"+t:u())})};cityssm.openHtmlModal("ticket-addStatusPaid",{onshow:function(e){document.getElementById("addPaidStatus--ticketID").value=t;var s=document.getElementById("addPaidStatus--statusField"),i=document.getElementById("ticket--offenceAmount").value,n=document.getElementById("ticket--issueDateString").value,d=document.getElementById("ticket--discountDays").value;if(""===n||""===d)s.value=i;else{var l=cityssm.dateToString(new Date);cityssm.dateStringDifferenceInDays(n,l)<=parseInt(d,10)?s.value=document.getElementById("ticket--discountOffenceAmount").value:s.value=i}e.getElementsByTagName("form")[0].addEventListener("submit",a)},onshown:function(t,e){s=e}})}),pts.loadDefaultConfigProperties(l)}();