"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=new Map,t=new Map,s=exports.accountNumberPattern;delete exports.accountNumberPattern;const a=new Map,n=document.getElementById("offenceFilter--limitResults"),c=document.getElementById("offenceResults"),o=document.getElementById("offenceFilter--location"),l=document.getElementById("offenceFilter--locationText");let i=!1,r="";const d=new Map,m=document.getElementById("offenceFilter--bylaw"),u=document.getElementById("offenceFilter--bylawText");let y=!1,f="";const b=(e,t)=>e+"::::"+t,p=e=>{t.clear();for(const s of e){const e=b(s.bylawNumber,s.locationKey);t.set(e,s)}},g=n=>{n.preventDefault();const c=n.currentTarget,o=b(c.getAttribute("data-bylaw-number"),c.getAttribute("data-location-key")),l=t.get(o),i=a.get(l.locationKey),r=d.get(l.bylawNumber);let m;const u=()=>{cityssm.postJSON("/admin/doDeleteOffence",{bylawNumber:l.bylawNumber,locationKey:l.locationKey},e=>{e.success&&(p(e.offences),m(),E())})},y=e=>{e.preventDefault(),cityssm.confirmModal("Remove Offence?","Are you sure you want to remove this offence?","Yes, Remove Offence","warning",u)},f=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffence",e.currentTarget,e=>{e.success&&(p(e.offences),m(),E())})};cityssm.openHtmlModal("offence-edit",{onshow(){document.getElementById("offenceEdit--locationKey").value=l.locationKey,document.getElementById("offenceEdit--bylawNumber").value=l.bylawNumber,document.getElementById("offenceEdit--locationName").innerText=i.locationName,document.getElementById("offenceEdit--locationClass").innerText=e.has(i.locationClassKey)?e.get(i.locationClassKey).locationClass:i.locationClassKey,document.getElementById("offenceEdit--bylawNumberSpan").innerText=r.bylawNumber,document.getElementById("offenceEdit--bylawDescription").innerText=r.bylawDescription,document.getElementById("offenceEdit--parkingOffence").value=l.parkingOffence,document.getElementById("offenceEdit--offenceAmount").value=l.offenceAmount.toFixed(2),document.getElementById("offenceEdit--discountOffenceAmount").value=l.discountOffenceAmount.toFixed(2),document.getElementById("offenceEdit--discountDays").value=l.discountDays.toString();const t=document.getElementById("offenceEdit--accountNumber");t.value=l.accountNumber,t.setAttribute("pattern",s)},onshown(e,t){m=t,document.getElementById("form--offenceEdit").addEventListener("submit",f),e.getElementsByClassName("is-delete-button")[0].addEventListener("click",y)}})},h=(e,t,s,a)=>{cityssm.postJSON("/admin/doAddOffence",{bylawNumber:e,locationKey:t,returnOffences:s},e=>{e.success&&e.offences&&s&&(p(e.offences),E()),a&&a(e)})},E=()=>{const s=document.createElement("tbody");let o=0;const l=n.checked?parseInt(n.value,10):t.size;t.forEach(t=>{if(o>=l)return;if(i&&r!==t.locationKey||y&&f!==t.bylawNumber)return;const n=a.get(t.locationKey);if(!n)return;const c=d.get(t.bylawNumber);if(!c)return;if((o+=1)>l)return;const m=document.createElement("tr");m.innerHTML='<td class="has-border-right-width-2">'+cityssm.escapeHTML(n.locationName)+'<br /><span class="is-size-7">'+(e.has(n.locationClassKey)?e.get(n.locationClassKey).locationClass:n.locationClassKey)+'</span></td><td class="has-border-right-width-2"><strong>'+cityssm.escapeHTML(c.bylawNumber)+'</strong><br /><span class="is-size-7">'+cityssm.escapeHTML(c.bylawDescription)+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Set Rate">$'+t.offenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+t.accountNumber+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Discount Rate">$'+t.discountOffenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+t.discountDays+" day"+(1===t.discountDays?"":"s")+'</span></td><td class="has-border-right-width-2"><div class="is-size-7">'+cityssm.escapeHTML(t.parkingOffence)+'</div></td><td class="has-text-right"><button class="button is-small" data-bylaw-number="'+t.bylawNumber+'" data-location-key="'+t.locationKey+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button></td>',m.getElementsByTagName("button")[0].addEventListener("click",g),s.appendChild(m)}),cityssm.clearElement(c),0!==o?(c.innerHTML='<table class="table is-striped is-hoverable is-fullwidth"><thead><tr><th class="has-border-right-width-2">Location</th><th class="has-border-right-width-2">By-Law</th><th class="has-border-right-width-2" colspan="3">Offence</th><th class="has-width-50"></th></tr></thead></table>',c.getElementsByTagName("table")[0].appendChild(s),o>l&&c.insertAdjacentHTML("afterbegin",'<div class="message is-warning"><div class="message-body has-text-centered">Limit Reached</div></div>')):c.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no offences that match the given criteria.</p></div></div>'};document.getElementById("is-add-offence-button").addEventListener("click",s=>{if(s.preventDefault(),i&&y){const t=d.get(f),s=a.get(r);cityssm.confirmModal("Create Offence?",'<p class="has-text-centered">Are you sure you want to create the offence record below?</p><div class="columns my-4"><div class="column has-text-centered">'+cityssm.escapeHTML(s.locationName)+'<br /><span class="is-size-7">'+(e.has(s.locationClassKey)?e.get(s.locationClassKey).locationClass:s.locationClassKey)+'</span></div><div class="column has-text-centered">'+cityssm.escapeHTML(t.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(t.bylawDescription)+"</span></div></div>","Yes, Create Offence","info",()=>{h(f,r,!0,e=>{e.success?e.message&&cityssm.alertModal("Offence Added Successfully",e.message,"OK","warning"):cityssm.alertModal("Offence Not Added",e.message,"OK","danger")})})}else i||y?(()=>{let s=!1;const n=e=>{e.preventDefault();const t=e.currentTarget,a=t.getAttribute("data-bylaw-number"),n=t.getAttribute("data-location-key");h(a,n,!1,e=>{e.success&&(t.remove(),s=!0)})};cityssm.openHtmlModal("offence-addFromList",{onshow(t){let s="",n="";if(i){s="Select By-Laws";const t=a.get(r),c=e.get(t.locationClassKey);n=cityssm.escapeHTML(t.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(c?c.locationClass:t.locationClassKey)+"</span>"}else{s="Select Locations";const e=d.get(f);n=cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+e.bylawDescription+"</span>"}t.getElementsByClassName("modal-card-title")[0].innerHTML=s,document.getElementById("addContainer--selected").innerHTML=n},onshown(){const s=document.createElement("div");s.className="panel";let c=0;i?d.forEach(e=>{const a=b(e.bylawNumber,r);if(t.has(a))return;c+=1;const o=document.createElement("a");o.className="panel-block",o.setAttribute("data-bylaw-number",e.bylawNumber),o.setAttribute("data-location-key",r),o.innerHTML=cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(e.bylawDescription)+"</span>",o.addEventListener("click",n),s.appendChild(o)}):a.forEach(a=>{const o=b(f,a.locationKey);if(t.has(o))return;c+=1;const l=document.createElement("a");l.className="panel-block",l.setAttribute("data-bylaw-number",f),l.setAttribute("data-location-key",a.locationKey),l.innerHTML=cityssm.escapeHTML(a.locationName)+'<br /><span class="is-size-7">'+(e.has(a.locationClassKey)?cityssm.escapeHTML(e.get(a.locationClassKey).locationClass):a.locationClassKey)+"</span>",l.addEventListener("click",n),s.appendChild(l)});const o=document.getElementById("addContainer--results");cityssm.clearElement(o),0===c?o.innerHTML='<div class="message is-info"><div class="message-body">There are no offence records available for creation.</div></div>':o.appendChild(s)},onremoved(){s&&cityssm.postJSON("/offences/doGetAllOffences",{},e=>{p(e),E()})}})})():cityssm.alertModal("How to Create a New Offence","To add an offence, use the main filters to select either a location, a by-law, or both.","OK","info")});const w=()=>{o.value="",cityssm.clearElement(l),r="",i=!1},v=()=>{let t;const s=e=>{e.preventDefault();const s=a.get(e.currentTarget.getAttribute("data-location-key"));i=!0,r=s.locationKey,o.value=s.locationName,t(),E()};cityssm.openHtmlModal("location-select",{onshow(){const t=document.createElement("div");t.className="panel mb-4",a.forEach(a=>{const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-location-key",a.locationKey),n.setAttribute("href","#"),n.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(a.locationName)+'</div><div class="level-right">'+cityssm.escapeHTML(e.has(a.locationClassKey)?e.get(a.locationClassKey).locationClass:a.locationClassKey)+"</div></div>",n.addEventListener("click",s),t.appendChild(n)});const n=document.getElementById("container--parkingLocations");cityssm.clearElement(n),n.appendChild(t)},onshown(e,s){t=s}})};o.addEventListener("dblclick",v),document.getElementById("is-select-location-filter-button").addEventListener("click",v),document.getElementById("is-clear-location-filter-button").addEventListener("click",()=>{w(),E()}),i||w();const N=()=>{m.value="",cityssm.clearElement(u),f="",y=!1},L=()=>{let e;const t=t=>{t.preventDefault();const s=d.get(t.currentTarget.getAttribute("data-bylaw-number"));y=!0,f=s.bylawNumber,m.value=s.bylawNumber,u.innerText=s.bylawDescription,e(),E()};cityssm.openHtmlModal("bylaw-select",{onshow(){const e=document.createElement("div");e.className="panel mb-4",d.forEach(s=>{const a=document.createElement("a");a.className="panel-block is-block",a.setAttribute("data-bylaw-number",s.bylawNumber),a.setAttribute("href","#"),a.innerHTML=cityssm.escapeHTML(s.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(s.bylawDescription)+"</span>",a.addEventListener("click",t),e.appendChild(a)});const s=document.getElementById("container--parkingBylaws");cityssm.clearElement(s),s.appendChild(e)},onshown(t,s){e=s}})};m.addEventListener("dblclick",L),document.getElementById("is-select-bylaw-filter-button").addEventListener("click",L),document.getElementById("is-clear-bylaw-filter-button").addEventListener("click",()=>{N(),E()}),y||N(),n.addEventListener("change",E);for(const e of exports.locations)a.set(e.locationKey,e);delete exports.locations;for(const e of exports.bylaws)d.set(e.bylawNumber,e);delete exports.bylaws,p(exports.offences),delete exports.offences,pts.getDefaultConfigProperty("locationClasses",t=>{for(const s of t)e.set(s.locationClassKey,s);E()})})();