"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var t="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-update"),e=exports.currentBatch;delete exports.currentBatch;var a=exports.convictableTickets;delete exports.convictableTickets;var s=document.getElementById("filter--parkingTicket"),n=document.getElementById("convictable-tickets-container"),i=[];function c(t){t.preventDefault();var s=t.currentTarget;s.setAttribute("disabled","disabled");var n=parseInt(s.getAttribute("data-index")),i=a[n].ticketID;cityssm.postJSON("/tickets/doAddTicketToConvictionBatch",{batchID:e.batchID,ticketID:i},function(t){t.success?(e=t.batch,p(),a.splice(n,1),l()):s.removeAttribute("disabled")})}function o(t){var s;t.preventDefault();cityssm.openHtmlModal("loading",{onshow:function(){document.getElementById("is-loading-modal-message").innerText="Adding "+i.length+" ticket"+(1===i.length?"":"s")+"..."},onshown:function(t,n){s=n,cityssm.postJSON("/tickets-ontario/doAddAllTicketsToConvictionBatch",{batchID:e.batchID,ticketIDs:i},function(t){s(),t.batch&&(e=t.batch,p()),t.tickets&&(a=t.tickets,l()),0===t.successCount&&cityssm.alertModal("Results",t.message?t.message:"No tickets were added to the batch.","OK","warning")})}})}function l(){if(cityssm.clearElement(n),i=[],e)if(t)if(e.lockDate)n.innerHTML='<div class="message is-warning"><div class="message-body">The target batch is locked and cannot accept additional tickets.</div></div>';else if(0!==a.length){for(var l=s.value.trim().toLowerCase(),r=document.createElement("tbody"),d=0;d<a.length;d+=1){var h=a[d];if(-1!==h.ticketNumber.toLowerCase().indexOf(l)||-1!==h.licencePlateNumber.toLowerCase().indexOf(l)){i.push(h.ticketID);var u=document.createElement("tr");u.innerHTML='<td><a data-tooltip="View Ticket (Opens in New Window)" href="/tickets/'+h.ticketID+'" target="_blank">'+cityssm.escapeHTML(h.ticketNumber)+"</a></td><td>"+h.issueDateString+'</td><td><span class="licence-plate-number is-size-6">'+cityssm.escapeHTML(h.licencePlateNumber)+'</span><br /><span class="has-tooltip-right is-size-7" data-tooltip="Primary Owner">'+cityssm.escapeHTML(h.licencePlateOwner_ownerName1)+'</span></td><td class="has-text-right"><button class="button is-small" data-index="'+d+'" type="button"><span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add</span></button></td>',u.getElementsByTagName("button")[0].addEventListener("click",c),r.appendChild(u)}}if(0!==i.length){var m=document.createElement("button");m.className="button is-fullwidth mb-3",m.innerHTML='<span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add '+i.length+" Parking Ticket"+(1===i.length?"":"s")+"</span>",m.addEventListener("click",o),n.appendChild(m);var b=document.createElement("table");b.className="table is-striped is-hoverable is-fullwidth",b.innerHTML="<thead><tr><th>Ticket Number</th><th>Issue Date</th><th>Licence Plate</th><th></th></tr></thead>",b.appendChild(r),n.appendChild(b)}else n.innerHTML='<div class="message is-info"><div class="message-body">There are no parking tickets that meet the search criteria.</div></div>'}else n.innerHTML='<div class="message is-info"><div class="message-body">There are no parking tickets currently eligible for conviction.</div></div>';else n.innerHTML='<div class="message is-warning"><div class="message-body">Parking tickets can only be added by users with update permissions.</div></div>';else n.innerHTML='<div class="message is-warning"><div class="message-body">Select a target batch to get started.</div></div>'}s.addEventListener("keyup",l);var r=document.getElementById("batch-entries-container");function d(t){t.preventDefault();var s=t.currentTarget;s.setAttribute("disabled","disabled");var n=parseInt(s.getAttribute("data-index")),i=e.batchEntries[n].ticketID;cityssm.postJSON("/tickets-ontario/doRemoveTicketFromConvictionBatch",{batchID:e.batchID,ticketID:i},function(t){t.success?(e.batchEntries.splice(n,1),p(),a=t.tickets,l()):s.removeAttribute("disabled")})}function h(t){t.preventDefault();cityssm.confirmModal("Clear Batch","Are you sure you want to remove all the parking tickets from the batch?","Yes, Clear the Batch","warning",function(){cityssm.postJSON("/tickets-ontario/doClearConvictionBatch",{batchID:e.batchID},function(t){t.success||cityssm.alertModal("Batch Not Cleared",t.message,"OK","danger"),t.batch&&(e=t.batch,p()),t.tickets&&(a=t.tickets,l())})})}function u(t){t.preventDefault();cityssm.confirmModal("Lock Batch?","<strong>Are you sure you want to lock this batch?</strong><br />Once locked, no further changes to the batch will be allowed.  The option to download the batch will become available.","Yes, Lock the Batch","warning",function(){cityssm.postJSON("/tickets/doLockConvictionBatch",{batchID:e.batchID},function(t){t.success&&(e.lockDate=t.lockDate,e.lockDateString=t.lockDateString,p(),l())})})}function m(t){t.preventDefault();cityssm.confirmModal("Lock Batch?","<strong>Are you sure you want to unlock this batch?</strong><br />Once unlocked, changes to the batch will be allowed.","Yes, Unlock the Batch","warning",function(){cityssm.postJSON("/tickets/doUnlockConvictionBatch",{batchID:e.batchID},function(t){t.success&&(e.lockDate=null,e.lockDateString=null,p(),l())})})}function b(t){t.preventDefault();var a=function(){window.open("/tickets-ontario/convict/"+e.batchID)};e.sentDate?a():cityssm.confirmModal("Download Batch","<strong>You are about to download the batch for the first time.</strong><br />Once downloaded, the date will be tracked, and the batch will no longer be able to be unlocked.","Yes, Download the Batch","warning",function(){a();var t=new Date;e.sentDateString=cityssm.dateToString(t),e.sentDate=parseInt(e.sentDateString.replace(/-/g,"")),p()})}function p(){if(document.getElementById("batchSelector--batchID").innerText="Batch #"+e.batchID,document.getElementById("batchSelector--batchDetails").innerHTML='<span class="has-tooltip-left" data-tooltip="Batch Date"><span class="icon"><i class="fas fa-star" aria-hidden="true"></i></span> '+e.batchDateString+"</span>"+(e.lockDate?'<br /><span class="has-tooltip-left" data-tooltip="Lock Date"><span class="icon"><i class="fas fa-lock" aria-hidden="true"></i></span> '+e.lockDateString+"</span>":""),cityssm.clearElement(r),0!==e.batchEntries.length){for(var a=document.createElement("tbody"),s=t&&!e.lockDate,n=0;n<e.batchEntries.length;n+=1){var i=e.batchEntries[n],c=document.createElement("tr");c.innerHTML='<td><a href="/tickets/'+i.ticketID+'" target="_blank">'+i.ticketNumber+"</a></td><td>"+i.issueDateString+'</td><td><span class="licence-plate-number is-size-6">'+cityssm.escapeHTML(i.licencePlateNumber)+"</span></td>"+(s?'<td class="has-text-right"><button class="button is-small" data-index="'+n+'" type="button"><span class="icon is-small"><i class="fas fa-minus" aria-hidden="true"></i></span><span>Remove</span></button></td>':""),s&&c.getElementsByTagName("button")[0].addEventListener("click",d),a.appendChild(c)}var o=document.createElement("table");if(o.className="table is-fullwidth is-striped is-hoverable",o.innerHTML="<thead><tr><th>Ticket Number</th><th>Issue Date</th><th>Licence Plate</th>"+(s?"<th></th>":"")+"</tr></thead>",o.appendChild(a),r.appendChild(o),t&&!e.lockDate){var l=document.createElement("button");l.className="button is-fullwidth mb-3",l.innerHTML='<span class="icon is-small"><i class="fas fa-lock" aria-hidden="true"></i></span><span>Lock Batch</span>',l.addEventListener("click",u),r.insertAdjacentElement("afterbegin",l);var p=document.createElement("button");p.className="button is-fullwidth mb-3",p.innerHTML='<span class="icon is-small"><i class="fas fa-broom" aria-hidden="true"></i></span><span>Clear Batch</span>',p.addEventListener("click",h),o.insertAdjacentElement("beforebegin",p)}if(t&&e.lockDate&&!e.sentDate){var f=document.createElement("button");f.className="button is-fullwidth mb-3",f.innerHTML='<span class="icon is-small"><i class="fas fa-unlock" aria-hidden="true"></i></span><span>Unlock Batch</span>',f.addEventListener("click",m),r.insertAdjacentElement("afterbegin",f)}if(e.lockDate){var g=document.createElement("button");g.className="button is-fullwidth mb-3",g.innerHTML='<span class="icon is-small"><i class="fas fa-download" aria-hidden="true"></i></span><span>Download File for MTO</span>',g.addEventListener("click",b),o.insertAdjacentElement("beforebegin",g),o.insertAdjacentHTML("beforebegin",'<a class="button is-fullwidth mb-3" href="https://www.apps.rus.mto.gov.on.ca/edtW/login/login.jsp" target="_blank" rel="noreferrer"><span class="icon is-small"><i class="fas fa-building" aria-hidden="true"></i></span><span>MTO ARIS Login</span></a>')}}else r.innerHTML='<div class="message is-info"><div class="message-body">There are no parking tickets in this batch.</div></div>'}document.getElementById("is-select-batch-button").addEventListener("click",function(a){var s;a.preventDefault();var n=function(t){t.preventDefault();var a=t.currentTarget.getAttribute("data-batch-id");cityssm.postJSON("/tickets/doGetConvictionBatch",{batchID:a},function(t){e=t,p(),l()}),s()};cityssm.openHtmlModal("mto-selectBatch",{onshow:function(a){if(t){var i=a.getElementsByClassName("is-create-batch-button")[0];i.classList.remove("is-hidden"),i.addEventListener("click",function(t){t.preventDefault(),s(),cityssm.confirmModal("Create a New Batch","Are you sure you want to create a new conviction batch?","Yes, Create Batch","info",function(){cityssm.postJSON("/tickets/doCreateConvictionBatch",{},function(t){t.success&&(e=t.batch,p(),l())})})})}cityssm.postJSON("/tickets/doGetRecentConvictionBatches",[],function(t){var e=a.getElementsByClassName("is-results-container")[0];if(cityssm.clearElement(e),0===t.length)return e.className="message is-info",void(e.innerHTML='<div class="message-body">There are no recent conviction batches.</div>');e.className="list is-hoverable";for(var s=0;s<t.length;s+=1){var i=t[s],c=document.createElement("a");c.className="list-item",c.setAttribute("data-batch-id",i.batchID.toString()),c.href="#",c.innerHTML='<div class="columns"><div class="column is-narrow">#'+i.batchID+'</div><div class="column has-text-right">'+i.batchDateString+(i.lockDate?'<br /><div class="tags justify-flex-end"><span class="tag"><span class="icon is-small"><i class="fas fa-lock" aria-hidden="true"></i></span><span>Locked</span></span>':"")+"</div></div>",c.addEventListener("click",n),e.appendChild(c)}})},onshown:function(t,e){s=e}})}),e&&p(),l()}();