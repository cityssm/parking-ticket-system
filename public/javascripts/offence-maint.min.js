"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=new Map,t=new Map,a=exports.accountNumberPattern;delete exports.accountNumberPattern;var n=new Map,s=document.getElementById("offenceFilter--limitResults"),c=document.getElementById("offenceResults"),o=document.getElementById("offenceFilter--location"),i=document.getElementById("offenceFilter--locationText"),l=!1,r="",d=new Map,m=document.getElementById("offenceFilter--bylaw"),u=document.getElementById("offenceFilter--bylawText"),f=!1,y="";function b(e,t){return e+"::::"+t}function p(e){t.clear();for(var a=0;a<e.length;a+=1){var n=e[a],s=b(n.bylawNumber,n.locationKey);t.set(s,n)}}function v(s){s.preventDefault();var c,o=s.currentTarget,i=b(o.getAttribute("data-bylaw-number"),o.getAttribute("data-location-key")),l=t.get(i),r=n.get(l.locationKey),m=d.get(l.bylawNumber),u=function(){cityssm.postJSON("/admin/doDeleteOffence",{bylawNumber:l.bylawNumber,locationKey:l.locationKey},function(e){e.success&&(p(e.offences),c(),h())})},f=function(e){e.preventDefault(),cityssm.confirmModal("Remove Offence?","Are you sure you want to remove this offence?","Yes, Remove Offence","warning",u)},y=function(e){e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffence",e.currentTarget,function(e){e.success&&(p(e.offences),c(),h())})};cityssm.openHtmlModal("offence-edit",{onshow:function(){document.getElementById("offenceEdit--locationKey").value=l.locationKey,document.getElementById("offenceEdit--bylawNumber").value=l.bylawNumber,document.getElementById("offenceEdit--locationName").innerText=r.locationName,document.getElementById("offenceEdit--locationClass").innerText=e.has(r.locationClassKey)?e.get(r.locationClassKey).locationClass:r.locationClassKey,document.getElementById("offenceEdit--bylawNumberSpan").innerText=m.bylawNumber,document.getElementById("offenceEdit--bylawDescription").innerText=m.bylawDescription,document.getElementById("offenceEdit--parkingOffence").value=l.parkingOffence,document.getElementById("offenceEdit--offenceAmount").value=l.offenceAmount,document.getElementById("offenceEdit--discountOffenceAmount").value=l.discountOffenceAmount,document.getElementById("offenceEdit--discountDays").value=l.discountDays;var t=document.getElementById("offenceEdit--accountNumber");t.value=l.accountNumber,t.setAttribute("pattern",a)},onshown:function(e,t){c=t,document.getElementById("form--offenceEdit").addEventListener("submit",y),e.getElementsByClassName("is-delete-button")[0].addEventListener("click",f)}})}function g(e,t,a,n){cityssm.postJSON("/admin/doAddOffence",{bylawNumber:e,locationKey:t,returnOffences:a},function(e){e.success&&e.offences&&a&&(p(e.offences),h()),n&&n(e)})}function h(){var a=document.createElement("tbody"),o=0,i=s.checked?parseInt(s.value):t.size;t.forEach(function(t){if(!(o>=i||l&&r!==t.locationKey||f&&y!==t.bylawNumber)){var s=n.get(t.locationKey);if(s){var c=d.get(t.bylawNumber);if(c&&!((o+=1)>i)){var m=document.createElement("tr");m.innerHTML='<td class="has-border-right-width-2">'+cityssm.escapeHTML(s.locationName)+'<br /><span class="is-size-7">'+(e.has(s.locationClassKey)?e.get(s.locationClassKey).locationClass:s.locationClassKey)+'</span></td><td class="has-border-right-width-2"><strong>'+cityssm.escapeHTML(c.bylawNumber)+'</strong><br /><span class="is-size-7">'+cityssm.escapeHTML(c.bylawDescription)+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Set Rate">$'+t.offenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+t.accountNumber+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Discount Rate">$'+t.discountOffenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+t.discountDays+" day"+(1===t.discountDays?"":"s")+'</span></td><td class="has-border-right-width-2"><div class="is-size-7">'+cityssm.escapeHTML(t.parkingOffence)+'</div></td><td class="has-text-right"><button class="button is-small" data-bylaw-number="'+t.bylawNumber+'" data-location-key="'+t.locationKey+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button></td>',m.getElementsByTagName("button")[0].addEventListener("click",v),a.appendChild(m)}}}}),cityssm.clearElement(c),0!==o?(c.innerHTML='<table class="table is-striped is-hoverable is-fullwidth"><thead><tr><th class="has-border-right-width-2">Location</th><th class="has-border-right-width-2">By-Law</th><th class="has-border-right-width-2" colspan="3">Offence</th><th class="has-width-50"></th></tr></thead></table>',c.getElementsByTagName("table")[0].appendChild(a),o>i&&c.insertAdjacentHTML("afterbegin",'<div class="message is-warning"><div class="message-body has-text-centered">Limit Reached</div></div>')):c.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no offences that match the given criteria.</p></div></div>'}function E(){o.value="",cityssm.clearElement(i),r="",l=!1}function w(){var t,a=function(e){e.preventDefault();var a=n.get(e.currentTarget.getAttribute("data-location-key"));l=!0,r=a.locationKey,o.value=a.locationName,t(),h()};cityssm.openHtmlModal("location-select",{onshow:function(){var t=document.createElement("div");t.className="panel mb-4",n.forEach(function(n){var s=document.createElement("a");s.className="panel-block is-block",s.setAttribute("data-location-key",n.locationKey),s.setAttribute("href","#"),s.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(n.locationName)+'</div><div class="level-right">'+cityssm.escapeHTML(e.has(n.locationClassKey)?e.get(n.locationClassKey).locationClass:n.locationClassKey)+"</div></div>",s.addEventListener("click",a),t.appendChild(s)});var s=document.getElementById("container--parkingLocations");cityssm.clearElement(s),s.appendChild(t)},onshown:function(e,a){t=a}})}function N(){m.value="",cityssm.clearElement(u),y="",f=!1}function L(){var e,t=function(t){t.preventDefault();var a=d.get(t.currentTarget.getAttribute("data-bylaw-number"));f=!0,y=a.bylawNumber,m.value=a.bylawNumber,u.innerText=a.bylawDescription,e(),h()};cityssm.openHtmlModal("bylaw-select",{onshow:function(){var e=document.createElement("div");e.className="panel mb-4",d.forEach(function(a){var n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-bylaw-number",a.bylawNumber),n.setAttribute("href","#"),n.innerHTML=cityssm.escapeHTML(a.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(a.bylawDescription)+"</span>",n.addEventListener("click",t),e.appendChild(n)});var a=document.getElementById("container--parkingBylaws");cityssm.clearElement(a),a.appendChild(e)},onshown:function(t,a){e=a}})}document.getElementById("is-add-offence-button").addEventListener("click",function(a){if(a.preventDefault(),l&&f){var s=d.get(y),c=n.get(r);cityssm.confirmModal("Create Offence?",'<p class="has-text-centered">Are you sure you want to create the offence record below?</p><div class="columns my-4"><div class="column has-text-centered">'+cityssm.escapeHTML(c.locationName)+'<br /><span class="is-size-7">'+(e.has(c.locationClassKey)?e.get(c.locationClassKey).locationClass:c.locationClassKey)+'</span></div><div class="column has-text-centered">'+cityssm.escapeHTML(s.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(s.bylawDescription)+"</span></div></div>","Yes, Create Offence","info",function(){g(y,r,!0,function(e){e.success?e.message&&cityssm.alertModal("Offence Added Successfully",e.message,"OK","warning"):cityssm.alertModal("Offence Not Added",e.message,"OK","danger")})})}else l||f?(o=!1,i=function(e){e.preventDefault();var t=e.currentTarget;g(t.getAttribute("data-bylaw-number"),t.getAttribute("data-location-key"),!1,function(e){e.success&&(t.remove(),o=!0)})},cityssm.openHtmlModal("offence-addFromList",{onshow:function(t){var a="",s="";if(l){a="Select By-Laws";var c=n.get(r),o=e.get(c.locationClassKey);s=cityssm.escapeHTML(c.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(o?o.locationClass:c.locationClassKey)+"</span>"}else{a="Select Locations";var i=d.get(y);s=cityssm.escapeHTML(i.bylawNumber)+'<br /><span class="is-size-7">'+i.bylawDescription+"</span>"}t.getElementsByClassName("modal-card-title")[0].innerHTML=a,document.getElementById("addContainer--selected").innerHTML=s},onshown:function(){var a=document.createElement("div");a.className="panel";var s=0;l?d.forEach(function(e){var n=b(e.bylawNumber,r);if(!t.has(n)){s+=1;var c=document.createElement("a");c.className="panel-block",c.setAttribute("data-bylaw-number",e.bylawNumber),c.setAttribute("data-location-key",r),c.innerHTML=cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(e.bylawDescription)+"</span>",c.addEventListener("click",i),a.appendChild(c)}}):n.forEach(function(n){var c=b(y,n.locationKey);if(!t.has(c)){s+=1;var o=document.createElement("a");o.className="panel-block",o.setAttribute("data-bylaw-number",y),o.setAttribute("data-location-key",n.locationKey),o.innerHTML=cityssm.escapeHTML(n.locationName)+'<br /><span class="is-size-7">'+(e.has(n.locationClassKey)?cityssm.escapeHTML(e.get(n.locationClassKey).locationClass):n.locationClassKey)+"</span>",o.addEventListener("click",i),a.appendChild(o)}});var c=document.getElementById("addContainer--results");cityssm.clearElement(c),0===s?c.innerHTML='<div class="message is-info"><div class="message-body">There are no offence records available for creation.</div></div>':c.appendChild(a)},onremoved:function(){o&&cityssm.postJSON("/offences/doGetAllOffences",{},function(e){p(e),h()})}})):cityssm.alertModal("How to Create a New Offence","To add an offence, use the main filters to select either a location, a by-law, or both.","OK","info");var o,i}),o.addEventListener("dblclick",w),document.getElementById("is-select-location-filter-button").addEventListener("click",w),document.getElementById("is-clear-location-filter-button").addEventListener("click",function(){E(),h()}),l||E(),m.addEventListener("dblclick",L),document.getElementById("is-select-bylaw-filter-button").addEventListener("click",L),document.getElementById("is-clear-bylaw-filter-button").addEventListener("click",function(){N(),h()}),f||N(),s.addEventListener("change",h);for(var T=0;T<exports.locations.length;T+=1){var C=exports.locations[T];n.set(C.locationKey,C)}delete exports.locations;for(T=0;T<exports.bylaws.length;T+=1){var M=exports.bylaws[T];d.set(M.bylawNumber,M)}delete exports.bylaws,p(exports.offences),delete exports.offences,pts.getDefaultConfigProperty("locationClasses",function(t){for(var a=0;a<t.length;a+=1){var n=t[a];e.set(n.locationClassKey,n)}h()})}();