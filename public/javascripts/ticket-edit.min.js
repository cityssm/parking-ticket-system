"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){for(var e=document.getElementById("ticket--ticketID").value,t=""===e,n=document.getElementById("container--form-message"),i=function(){cityssm.enableNavBlocker(),!0,n.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},c=document.querySelectorAll(".input, .select, .textarea"),a=0;a<c.length;a+=1)c[a].addEventListener("change",i);document.getElementById("form--ticket").addEventListener("submit",function(e){e.preventDefault();var c=document.getElementById("ticket--ticketNumber").value;n.innerHTML='<span class="tag is-light is-info is-medium"><span>Saving ticket... </span> <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span></div>',cityssm.postJSON(t?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",e.currentTarget,function(e){e.success?(cityssm.disableNavBlocker(),!1,n.innerHTML='<span class="tag is-light is-success is-medium"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span> <span>Saved Successfully</span></div>'):(i(),cityssm.alertModal("Ticket Not Saved",e.message,"OK","danger")),e.success&&t&&cityssm.openHtmlModal("ticket-createSuccess",{onshow:function(){document.getElementById("createSuccess--ticketNumber").innerText=c,document.getElementById("createSuccess--editTicketButton").setAttribute("href","/tickets/"+e.ticketID+"/edit"),document.getElementById("createSuccess--newTicketButton").setAttribute("href","/tickets/new/"+e.nextTicketNumber)}})})}),t||document.getElementById("is-delete-ticket-button").addEventListener("click",function(t){t.preventDefault(),cityssm.confirmModal("Delete Ticket?","Are you sure you want to delete this ticket record?","Yes, Delete Ticket","danger",function(){cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:e},function(e){e.success&&(window.location.href="/tickets")})})}),pts.getDefaultConfigProperty("locationClasses",function(e){for(var t,n={},i=[],c=0;c<e.length;c+=1){var a=e[c];n[a.locationClassKey]=a}var s=function(e){e.preventDefault(),document.getElementById("ticket--locationKey").value="",document.getElementById("ticket--locationName").value="",t(),i=[]},l=function(e){e.preventDefault();var n=i[parseInt(e.currentTarget.getAttribute("data-index"),10)];document.getElementById("ticket--locationKey").value=n.locationKey,document.getElementById("ticket--locationName").value=n.locationName,t(),i=[]},o=function(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setLocation",{onshown:function(e,c){t=c,cityssm.postJSON("/offences/doGetAllLocations",{},function(e){i=e;var t=document.createElement("div");t.className="panel mb-4";for(var c=0;c<i.length;c+=1){var a=i[c],s=n[a.locationClassKey],o=document.createElement("a");o.className="panel-block is-block",o.setAttribute("data-index",c.toString()),o.setAttribute("href","#"),o.addEventListener("click",l),o.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(a.locationName)+"</div>"+(s?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(s.locationClass)+"</span></div>":"")+"</div>",t.insertAdjacentElement("beforeend",o)}var d=document.getElementById("container--parkingLocations");cityssm.clearElement(d),d.insertAdjacentElement("beforeend",t)}),document.getElementById("is-clear-location-button").addEventListener("click",s)},onremoved:function(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",o),document.getElementById("ticket--locationName").addEventListener("dblclick",o)});var s,l=[],o=[],d=function(e){e.preventDefault(),document.getElementById("ticket--bylawNumber").value="";var t=document.getElementById("ticket--offenceAmount");t.classList.add("is-readonly"),t.setAttribute("readonly","readonly"),t.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),t.value="";var n=document.getElementById("ticket--discountOffenceAmount");n.classList.add("is-readonly"),n.setAttribute("readonly","readonly"),n.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),n.value="";var i=document.getElementById("ticket--discountDays");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),i.value="",document.getElementById("ticket--parkingOffence").value="",s(),l=[]},r=function(e){e.preventDefault();var t=l[parseInt(e.currentTarget.getAttribute("data-index"),10)];document.getElementById("ticket--bylawNumber").value=t.bylawNumber;var n=document.getElementById("ticket--offenceAmount");n.classList.add("is-readonly"),n.setAttribute("readonly","readonly"),n.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),n.value=t.offenceAmount.toFixed(2);var i=document.getElementById("ticket--discountOffenceAmount");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),i.value=t.discountOffenceAmount.toFixed(2);var c=document.getElementById("ticket--discountDays");c.classList.add("is-readonly"),c.setAttribute("readonly","readonly"),c.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),c.value=t.discountDays.toString(),document.getElementById("ticket--parkingOffence").value=t.bylawDescription,s(),l=[]},u=function(e){for(var t=e.currentTarget.value.trim().toLowerCase().split(" "),n=0;n<l.length;n+=1){for(var i=!0,c=l[n],a=0;a<t.length;a+=1){var s=t[a];if(-1===c.bylawNumber.toLowerCase().indexOf(s)&&-1===c.bylawDescription.toLowerCase().indexOf(s)){i=!1;break}}i?o[n].classList.remove("is-hidden"):o[n].classList.add("is-hidden")}},m=function(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown:function(e,t){var n;s=t,n=document.getElementById("ticket--locationKey").value,cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:n},function(e){l=e;var t=document.createElement("div");t.className="panel mb-4";for(var n=0;n<l.length;n+=1){var i=l[n],c=document.createElement("a");c.className="panel-block is-block",c.setAttribute("data-index",n.toString()),c.setAttribute("href","#"),c.addEventListener("click",r),c.innerHTML='<div class="columns"><div class="column"><span class="has-text-weight-semibold">'+cityssm.escapeHTML(i.bylawNumber)+"</span><br /><small>"+cityssm.escapeHTML(i.bylawDescription)+'</small></div><div class="column is-narrow has-text-weight-semibold">$'+i.offenceAmount.toFixed(2)+"</div></div>",t.insertAdjacentElement("beforeend",c),o.push(c)}var a=document.getElementById("container--bylawNumbers");cityssm.clearElement(a),a.appendChild(t)});var i=document.getElementById("bylawLookup--searchStr");i.focus(),i.addEventListener("keyup",u),document.getElementById("is-clear-bylaw-button").addEventListener("click",d)},onremoved:function(){document.getElementById("is-bylaw-lookup-button").focus()}})};document.getElementById("is-bylaw-lookup-button").addEventListener("click",m),document.getElementById("ticket--bylawNumber").addEventListener("dblclick",m);var y=document.getElementById("ticket--licencePlateIsMissing");y.addEventListener("change",function(){y.checked?(document.getElementById("ticket--licencePlateCountry").removeAttribute("required"),document.getElementById("ticket--licencePlateProvince").removeAttribute("required"),document.getElementById("ticket--licencePlateNumber").removeAttribute("required")):(document.getElementById("ticket--licencePlateCountry").setAttribute("required","required"),document.getElementById("ticket--licencePlateProvince").setAttribute("required","required"),document.getElementById("ticket--licencePlateNumber").setAttribute("required","required"))});var v=function(){var e=document.getElementById("datalist--licencePlateProvince");cityssm.clearElement(e);var t=pts.getLicencePlateCountryProperties(document.getElementById("ticket--licencePlateCountry").value);if(t&&t.provinces)for(var n=Object.values(t.provinces),i=0;i<n.length;i+=1){var c=document.createElement("option");c.setAttribute("value",n[i].provinceShortName),e.appendChild(c)}};document.getElementById("ticket--licencePlateCountry").addEventListener("change",v),pts.loadDefaultConfigProperties(v);for(var f=function(e){e.preventDefault();var t=e.currentTarget,n=t.getAttribute("data-unlock"),i=t.closest(".field").getElementsByTagName(n)[0];i.removeAttribute("readonly"),i.classList.remove("is-readonly"),i.focus(),t.setAttribute("disabled","disabled")},g=document.getElementsByClassName("is-unlock-field-button"),b=0;b<g.length;b+=1)g[b].addEventListener("click",f)}();