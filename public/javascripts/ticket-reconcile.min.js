"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;function t(e){e.preventDefault();const t=e.currentTarget;t.setAttribute("disabled","disabled");const s=t.dataset.batchId,a=t.dataset.logIndex;cityssm.postJSON("/tickets/doAcknowledgeLookupError",{batchId:s,logIndex:a},e=>{if(e.success){const e=t.closest("td");cityssm.clearElement(e),e.innerHTML='<span class="tag is-light is-warning">\n            <span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span>\n            <span>Acknowledged</span>\n            </span>'}else t.removeAttribute("disabled")})}pts.initializeToggleHiddenLinks(document.querySelector("main"));const s=document.querySelectorAll(".is-acknowledge-error-button");for(const e of s)e.addEventListener("click",t);function a(e){e.preventDefault();const t=e.currentTarget,s=t.closest("td"),a=s.closest("tr");bulmaJS.confirm({title:"Clear Status",message:"Are you sure you want to undo this status?",contextualColorName:"warning",okButton:{text:"Yes, Remove the Status",callbackFunction:function(){cityssm.postJSON("/tickets/doDeleteStatus",{ticketId:a.dataset.ticketId,statusIndex:t.dataset.statusIndex},e=>{var t,a;e.success&&(cityssm.clearElement(s),s.classList.remove("has-width-200"),s.innerHTML='<button class="button is-success is-ownership-match-button" type="button">\n                <span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span>\n                <span>Match</span>\n              </button>\n              <button class="button is-danger is-ownership-error-button" type="button">\n                <i class="fas fa-times" aria-hidden="true"></i>\n                <span class="sr-only">Error</span>\n              </button>',null===(t=s.querySelector(".is-ownership-match-button"))||void 0===t||t.addEventListener("click",n),null===(a=s.querySelector(".is-ownership-error-button"))||void 0===a||a.addEventListener("click",c))})}}})}function n(e){var t,s,n,c,i,o;e.preventDefault();const l=e.currentTarget,r=l.closest("td"),d=r.closest("tr");function u(){l.setAttribute("disabled","disabled");const e=d.dataset.licencePlateCountry,t=d.dataset.licencePlateProvince,s=d.dataset.licencePlateNumber,n=d.dataset.ticketId,c=d.dataset.recordDate;cityssm.postJSON("/tickets/doReconcileAsMatch",{licencePlateCountry:e,licencePlateProvince:t,licencePlateNumber:s,ticketId:n,recordDate:c},e=>{var t,s;const n=e;n.success?(cityssm.clearElement(r),r.innerHTML=`<div class="tags has-addons">\n              <span class="tag is-light is-success">\n                <span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span>\n                <span>Match</span>\n              </span>\n              <a class="tag" data-tooltip="Remove Match" data-status-index="${n.statusIndex.toString()}" data-tooltip="Remove Match" href="#">\n                <i class="far fa-trash-alt" aria-hidden="true"></i>\n                <span class="sr-only">Remove Match</span>\n              </a>\n              </div>`,null===(t=r.querySelector("a"))||void 0===t||t.addEventListener("click",a)):(l.removeAttribute("disabled"),bulmaJS.alert({title:"Record Not Updated",message:null!==(s=n.message)&&void 0!==s?s:"",contextualColorName:"danger"}))})}if(""!==(null!==(t=d.dataset.isVehicleMakeMatch)&&void 0!==t?t:"")&&""!==(null!==(s=d.dataset.isLicencePlateExpiryDateMatch)&&void 0!==s?s:""))u();else{const e=null!==(n=d.dataset.ticketVehicle)&&void 0!==n?n:"",t=null!==(c=d.dataset.ticketExpiryDate)&&void 0!==c?c:"",s=null!==(i=d.dataset.ownerVehicle)&&void 0!==i?i:"",a=null!==(o=d.dataset.ownerExpiryDate)&&void 0!==o?o:"",l=`<p class="has-text-centered">\n        Are you sure the details on the parking ticket match the details on the ownership record?\n        </p>\n        <div class="columns mt-1">\n        <div class="column has-text-centered">\n          <strong>Parking Ticket</strong><br />\n          <span class="is-size-4">\n          ${cityssm.escapeHTML(e)}\n          </span><br />\n          <span class="is-size-5">\n          ${""===t?"(Not Set)":cityssm.escapeHTML(t)}\n          </span>\n        </div>\n        <div class="column has-text-centered">\n          <strong>Ownership Record</strong><br />\n          <span class="is-size-4">\n            ${cityssm.escapeHTML(s)}\n          </span><br />\n          <span class="is-size-5">\n            ${cityssm.escapeHTML(a)}\n          </span>\n        </div>\n        </div>`;bulmaJS.confirm({title:"Confirm Match",message:l,messageIsHtml:!0,contextualColorName:"warning",okButton:{text:"Yes, Confirm Match",callbackFunction:u}})}}function c(e){var t,s,n,c,i,o;e.preventDefault();const l=e.currentTarget,r=l.closest("td"),d=r.closest("tr");function u(){l.setAttribute("disabled","disabled");const e=d.dataset.licencePlateCountry,t=d.dataset.licencePlateProvince,s=d.dataset.licencePlateNumber,n=d.dataset.ticketId,c=d.dataset.recordDate;cityssm.postJSON("/tickets/doReconcileAsError",{licencePlateCountry:e,licencePlateProvince:t,licencePlateNumber:s,ticketId:n,recordDate:c},e=>{var t,s;const n=e;n.success?(cityssm.clearElement(r),r.innerHTML=`<div class="tags has-addons">\n              <span class="tag is-light is-danger">\n                <span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span>\n                <span>Match Error</span>\n              </span>\n              <a class="tag" data-tooltip="Remove Match" data-status-index="${n.statusIndex.toString()}" data-tooltip="Remove Match" href="#">\n                <i class="far fa-trash-alt" aria-hidden="true"></i>\n                <span class="sr-only">Remove Match</span>\n              </a>\n              </div>`,null===(t=r.querySelector("a"))||void 0===t||t.addEventListener("click",a)):(l.removeAttribute("disabled"),bulmaJS.alert({title:"Record Not Updated",message:null!==(s=n.message)&&void 0!==s?s:"",contextualColorName:"danger"}))})}if(""!==(null!==(t=d.dataset.isVehicleMakeMatch)&&void 0!==t?t:"")||""!==(null!==(s=d.dataset.isLicencePlateExpiryDateMatch)&&void 0!==s?s:"")){const e=null!==(n=d.dataset.ticketVehicle)&&void 0!==n?n:"",t=null!==(c=d.dataset.ticketExpiryDate)&&void 0!==c?c:"",s=null!==(i=d.dataset.ownerVehicle)&&void 0!==i?i:"",a=null!==(o=d.dataset.ownerExpiryDate)&&void 0!==o?o:"",l=`<p class="has-text-centered">\n        Are you sure you want to mark an error between the details on the parking ticket and the details on the ownership record?\n        </p>\n        <div class="columns mt-1">\n          <div class="column has-text-centered">\n            <strong>Parking Ticket</strong><br />\n            <span class="is-size-4">\n            ${cityssm.escapeHTML(e)}\n            </span><br />\n            <span class="is-size-5">\n            ${""===t?"(Not Set)":cityssm.escapeHTML(t)}\n            </span>\n          </div>\n          <div class="column has-text-centered">\n            <strong>Ownership Record</strong><br />\n            <span class="is-size-4">\n              ${cityssm.escapeHTML(s)}\n            </span><br />\n            <span class="is-size-5">\n              ${cityssm.escapeHTML(a)}\n            </span>\n          </div>\n        </div>`;bulmaJS.confirm({title:"Confirm Error",message:l,messageIsHtml:!0,contextualColorName:"warning",okButton:{text:"Yes, Confirm Error",callbackFunction:u}})}else u()}const i=document.querySelectorAll(".is-ownership-match-button");for(const e of i)e.addEventListener("click",n);const o=document.querySelectorAll(".is-ownership-error-button");for(const e of o)e.addEventListener("click",c);null===(e=document.querySelector("#is-quick-reconcile-matches-button"))||void 0===e||e.addEventListener("click",e=>{let t;e.preventDefault(),bulmaJS.confirm({title:"Quick Reconcile Matches",message:"Are you sure you want to mark all parking tickets with matching vehicle makes and plate expiry dates as matched?",contextualColorName:"info",okButton:{text:"Yes, Mark All Matches as Matched",callbackFunction:function(){cityssm.openHtmlModal("loading",{onshown(e,s){document.querySelector("#is-loading-modal-message").textContent="Reconciling matches...",t=s,cityssm.postJSON("/tickets/doQuickReconcileMatches",{},e=>{var s;const n=e;if(t(),n.success){bulmaJS.alert({title:"Quick Reconcile Complete",message:1===n.statusRecords.length?"One record was successfully reconciled as a match.":`${n.statusRecords.length.toString()} records were successfully reconciled as matches.`,contextualColorName:"success"});for(const e of n.statusRecords){const t=document.querySelector(`#is-options-cell--${e.ticketId.toString()}`);null!==t&&(cityssm.clearElement(t),t.innerHTML=`<div class="tags has-addons">\n                    <span class="tag is-light is-success">\n                      <span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span>\n                      <span>Match</span>\n                    </span>\n                    <a class="tag" data-tooltip="Remove Match" data-status-index="${e.statusIndex.toString()}" data-tooltip="Remove Match" href="#">\n                      <i class="far fa-trash-alt" aria-hidden="true"></i>\n                      <span class="sr-only">Remove Match</span>\n                    </a>\n                    </div>`,null===(s=t.querySelector("a"))||void 0===s||s.addEventListener("click",a))}}})}})}}})})})();