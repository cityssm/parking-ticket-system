"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=document.querySelector("#bylawFilter--bylaw"),n=document.querySelector("#bylawResults");let o=exports.bylaws;function a(e){var t;e.preventDefault();const n=Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10),a=o[n];let l;function r(e){e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffencesByBylaw",e.currentTarget,e=>{const t=e;t.success&&(l(),o=t.bylaws,s())})}cityssm.openHtmlModal("bylaw-updateOffences",{onshow(){var e,t,n;document.querySelector("#updateOffences--bylawNumber").value=a.bylawNumber,document.querySelector("#updateOffences--bylawDescription").value=a.bylawDescription,document.querySelector("#updateOffences--offenceAmount").value=(null!==(e=a.offenceAmountMin)&&void 0!==e?e:0).toFixed(2),document.querySelector("#updateOffences--discountDays").value=(null!==(t=a.discountDaysMin)&&void 0!==t?t:0).toString(),document.querySelector("#updateOffences--discountOffenceAmount").value=(null!==(n=a.discountOffenceAmountMin)&&void 0!==n?n:0).toFixed(2)},onshown(e,t){var n;bulmaJS.toggleHtmlClipped(),l=t,null===(n=e.querySelector("form"))||void 0===n||n.addEventListener("submit",r)},onhidden(){bulmaJS.toggleHtmlClipped()}})}function l(e){var t;e.preventDefault();const n=Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10),a=o[n];let l;function r(){cityssm.postJSON("/admin/doDeleteBylaw",{bylawNumber:a.bylawNumber},e=>{const t=e;t.success&&(l(),o=t.bylaws,s())})}function i(e){e.preventDefault(),cityssm.confirmModal("Delete By-Law",`Are you sure you want to remove by-law "${a.bylawNumber}" from the list of available options?`,"Yes, Remove By-Law","danger",r)}function c(e){e.preventDefault(),cityssm.postJSON("/admin/doUpdateBylaw",e.currentTarget,e=>{const t=e;t.success&&(l(),o=t.bylaws,s())})}cityssm.openHtmlModal("bylaw-edit",{onshow(){document.querySelector("#editBylaw--bylawNumber").value=a.bylawNumber,document.querySelector("#editBylaw--bylawDescription").value=a.bylawDescription},onshown(e,t){var n,o;bulmaJS.toggleHtmlClipped(),l=t,null===(n=e.querySelector("form"))||void 0===n||n.addEventListener("submit",c),null===(o=e.querySelector(".is-delete-button"))||void 0===o||o.addEventListener("click",i)},onhidden(){bulmaJS.toggleHtmlClipped()}})}function s(){var e,s;let r=0;const i=t.value.trim().toLowerCase().split(" "),c=document.createElement("tbody");for(const[t,n]of o.entries()){let o=!0;const d=n.bylawNumber.toLowerCase(),u=n.bylawDescription.toLowerCase();for(const e of i)if(!d.includes(e)&&!u.includes(e)){o=!1;break}if(!o)continue;r+=1;const m=document.createElement("tr");let y="",f=!1;n.offenceAmountMin?(f=!0,y="$"+n.offenceAmountMin.toFixed(2),n.offenceAmountMin!==n.offenceAmountMax&&(y+=` to $${(null!==(e=n.offenceAmountMax)&&void 0!==e?e:0).toFixed(2)}`),y=`<a class="has-tooltip-left" data-tooltip="Update Offence Amounts" data-index="${t.toString()}" href="#">\n          ${y}\n          </a>`):y="(No Offences)",m.innerHTML=`<td>\n          <a data-index="${t.toString()}" href="#">\n            ${cityssm.escapeHTML(n.bylawNumber)}\n          </a>\n          </td>\n          <td class="has-border-right-width-2">\n            ${cityssm.escapeHTML(n.bylawDescription)}\n          </td>\n          <td class="has-text-right">\n            ${(null!==(s=n.offenceCount)&&void 0!==s?s:0).toString()}\n          </td>\n          <td class="has-text-right">\n            ${y}\n          </td>`,m.querySelectorAll("a")[0].addEventListener("click",l),f&&m.querySelectorAll("a")[1].addEventListener("click",a),c.append(m)}cityssm.clearElement(n),0!==r?(n.innerHTML='<table class="table is-striped is-hoverable is-fullwidth">\n        <thead><tr>\n        <th>By-Law Number</th>\n        <th class="has-border-right-width-2">Description</th>\n        <th class="has-text-right">Total Offences</th>\n        <th class="has-text-right">Offence Amount Range</th>\n        </tr></thead>\n      </table>',n.querySelector("table").append(c)):n.innerHTML='<div class="message is-info">\n        <div class="message-body">There are no by-laws that meet your search criteria.</div>\n        </div>'}delete exports.bylaws,t.addEventListener("keyup",s),s(),null===(e=document.querySelector("#is-add-bylaw-button"))||void 0===e||e.addEventListener("click",e=>{let t;function n(e){e.preventDefault(),cityssm.postJSON("/admin/doAddBylaw",e.currentTarget,e=>{var n;const a=e;a.success?(t(),void 0!==a.message&&cityssm.alertModal("By-Law Added",a.message,"OK","warning"),o=a.bylaws,s()):cityssm.alertModal("By-Law Not Added",null!==(n=a.message)&&void 0!==n?n:"","OK","danger")})}e.preventDefault(),cityssm.openHtmlModal("bylaw-add",{onshown(e,o){var a;t=o,null===(a=e.querySelector("form"))||void 0===a||a.addEventListener("submit",n)}})})})();