"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=new Map,t=exports.accountNumberPattern;delete exports.accountNumberPattern;const s=new Map,n=document.getElementById("offenceFilter--limitResults"),a=document.getElementById("offenceResults"),c=document.getElementById("offenceFilter--location"),o=document.getElementById("offenceFilter--locationText");let l=!1,i="";const r=new Map,d=document.getElementById("offenceFilter--bylaw"),m=document.getElementById("offenceFilter--bylawText");let u=!1,y="";const f=(e,t)=>e+"::::"+t,b=t=>{e.clear();for(const s of t){const t=f(s.bylawNumber,s.locationKey);e.set(t,s)}},p=n=>{n.preventDefault();const a=n.currentTarget,c=f(a.getAttribute("data-bylaw-number"),a.getAttribute("data-location-key")),o=e.get(c),l=s.get(o.locationKey),i=r.get(o.bylawNumber);let d;const m=()=>{cityssm.postJSON("/admin/doDeleteOffence",{bylawNumber:o.bylawNumber,locationKey:o.locationKey},e=>{e.success&&(b(e.offences),d(),h())})},u=e=>{e.preventDefault(),cityssm.confirmModal("Remove Offence?","Are you sure you want to remove this offence?","Yes, Remove Offence","warning",m)},y=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffence",e.currentTarget,e=>{e.success&&(b(e.offences),d(),h())})};cityssm.openHtmlModal("offence-edit",{onshow(){document.getElementById("offenceEdit--locationKey").value=o.locationKey,document.getElementById("offenceEdit--bylawNumber").value=o.bylawNumber,document.getElementById("offenceEdit--locationName").innerText=l.locationName,document.getElementById("offenceEdit--locationClass").innerText=pts.getLocationClass(l.locationClassKey).locationClass,document.getElementById("offenceEdit--bylawNumberSpan").innerText=i.bylawNumber,document.getElementById("offenceEdit--bylawDescription").innerText=i.bylawDescription,document.getElementById("offenceEdit--parkingOffence").value=o.parkingOffence,document.getElementById("offenceEdit--offenceAmount").value=o.offenceAmount.toFixed(2),document.getElementById("offenceEdit--discountOffenceAmount").value=o.discountOffenceAmount.toFixed(2),document.getElementById("offenceEdit--discountDays").value=o.discountDays.toString();const e=document.getElementById("offenceEdit--accountNumber");e.value=o.accountNumber,e.setAttribute("pattern",t)},onshown(e,t){d=t,document.getElementById("form--offenceEdit").addEventListener("submit",y),e.getElementsByClassName("is-delete-button")[0].addEventListener("click",u)}})},g=(e,t,s,n)=>{cityssm.postJSON("/admin/doAddOffence",{bylawNumber:e,locationKey:t,returnOffences:s},e=>{e.success&&e.offences&&s&&(b(e.offences),h()),n&&n(e)})},h=()=>{const t=document.createElement("tbody");let c=0;const o=n.checked?parseInt(n.value,10):e.size;e.forEach(e=>{if(c>=o)return;if(l&&i!==e.locationKey||u&&y!==e.bylawNumber)return;const n=s.get(e.locationKey);if(!n)return;const a=r.get(e.bylawNumber);if(!a)return;if((c+=1)>o)return;const d=document.createElement("tr");d.innerHTML='<td class="has-border-right-width-2">'+cityssm.escapeHTML(n.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(pts.getLocationClass(n.locationClassKey).locationClass)+'</span></td><td class="has-border-right-width-2"><strong>'+cityssm.escapeHTML(a.bylawNumber)+'</strong><br /><span class="is-size-7">'+cityssm.escapeHTML(a.bylawDescription)+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Set Rate">$'+e.offenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+e.accountNumber+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Discount Rate">$'+e.discountOffenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+e.discountDays.toString()+" day"+(1===e.discountDays?"":"s")+'</span></td><td class="has-border-right-width-2"><div class="is-size-7">'+cityssm.escapeHTML(e.parkingOffence)+'</div></td><td class="has-text-right"><button class="button is-small" data-bylaw-number="'+e.bylawNumber+'" data-location-key="'+e.locationKey+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button></td>',d.getElementsByTagName("button")[0].addEventListener("click",p),t.appendChild(d)}),cityssm.clearElement(a),0!==c?(a.innerHTML='<table class="table is-striped is-hoverable is-fullwidth"><thead><tr><th class="has-border-right-width-2">Location</th><th class="has-border-right-width-2">By-Law</th><th class="has-border-right-width-2" colspan="3">Offence</th><th class="has-width-50"></th></tr></thead></table>',a.getElementsByTagName("table")[0].appendChild(t),c>o&&a.insertAdjacentHTML("afterbegin",'<div class="message is-warning"><div class="message-body has-text-centered">Limit Reached</div></div>')):a.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no offences that match the given criteria.</p></div></div>'};document.getElementById("is-add-offence-button").addEventListener("click",t=>{if(t.preventDefault(),l&&u){const e=r.get(y),t=s.get(i);cityssm.confirmModal("Create Offence?",'<p class="has-text-centered">Are you sure you want to create the offence record below?</p><div class="columns my-4"><div class="column has-text-centered">'+cityssm.escapeHTML(t.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(pts.getLocationClass(t.locationClassKey).locationClass)+'</span></div><div class="column has-text-centered">'+cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(e.bylawDescription)+"</span></div></div>","Yes, Create Offence","info",()=>{g(y,i,!0,e=>{e.success?e.message&&cityssm.alertModal("Offence Added Successfully",e.message,"OK","warning"):cityssm.alertModal("Offence Not Added",e.message,"OK","danger")})})}else l||u?(()=>{let t=!1;const n=e=>{e.preventDefault();const s=e.currentTarget,n=s.getAttribute("data-bylaw-number"),a=s.getAttribute("data-location-key");g(n,a,!1,e=>{e.success&&(s.remove(),t=!0)})};cityssm.openHtmlModal("offence-addFromList",{onshow(e){let t="",n="";if(l){t="Select By-Laws";const e=s.get(i),a=pts.getLocationClass(e.locationClassKey);n=cityssm.escapeHTML(e.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(a.locationClass)+"</span>"}else{t="Select Locations";const e=r.get(y);n=cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+e.bylawDescription+"</span>"}e.getElementsByClassName("modal-card-title")[0].innerHTML=t,document.getElementById("addContainer--selected").innerHTML=n},onshown(){const t=document.createElement("div");t.className="panel";let a=0;l?r.forEach(s=>{const c=f(s.bylawNumber,i);if(e.has(c))return;a+=1;const o=document.createElement("a");o.className="panel-block",o.setAttribute("data-bylaw-number",s.bylawNumber),o.setAttribute("data-location-key",i),o.innerHTML=cityssm.escapeHTML(s.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(s.bylawDescription)+"</span>",o.addEventListener("click",n),t.appendChild(o)}):s.forEach(s=>{const c=f(y,s.locationKey);if(e.has(c))return;a+=1;const o=document.createElement("a");o.className="panel-block",o.setAttribute("data-bylaw-number",y),o.setAttribute("data-location-key",s.locationKey),o.innerHTML=cityssm.escapeHTML(s.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(pts.getLocationClass(s.locationClassKey).locationClass)+"</span>",o.addEventListener("click",n),t.appendChild(o)});const c=document.getElementById("addContainer--results");cityssm.clearElement(c),0===a?c.innerHTML='<div class="message is-info"><div class="message-body">There are no offence records available for creation.</div></div>':c.appendChild(t)},onremoved(){t&&cityssm.postJSON("/offences/doGetAllOffences",{},e=>{b(e),h()})}})})():cityssm.alertModal("How to Create a New Offence","To add an offence, use the main filters to select either a location, a by-law, or both.","OK","info")});const E=()=>{c.value="",cityssm.clearElement(o),i="",l=!1},w=()=>{let e;const t=t=>{t.preventDefault();const n=s.get(t.currentTarget.getAttribute("data-location-key"));l=!0,i=n.locationKey,c.value=n.locationName,e(),h()};cityssm.openHtmlModal("location-select",{onshow(){const e=document.createElement("div");e.className="panel mb-4",s.forEach(s=>{const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-location-key",s.locationKey),n.setAttribute("href","#"),n.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(s.locationName)+'</div><div class="level-right">'+cityssm.escapeHTML(pts.getLocationClass(s.locationClassKey).locationClass)+"</div></div>",n.addEventListener("click",t),e.appendChild(n)});const n=document.getElementById("container--parkingLocations");cityssm.clearElement(n),n.appendChild(e)},onshown(t,s){e=s}})};c.addEventListener("dblclick",w),document.getElementById("is-select-location-filter-button").addEventListener("click",w),document.getElementById("is-clear-location-filter-button").addEventListener("click",()=>{E(),h()}),l||E();const v=()=>{d.value="",cityssm.clearElement(m),y="",u=!1},L=()=>{let e;const t=t=>{t.preventDefault();const s=r.get(t.currentTarget.getAttribute("data-bylaw-number"));u=!0,y=s.bylawNumber,d.value=s.bylawNumber,m.innerText=s.bylawDescription,e(),h()};cityssm.openHtmlModal("bylaw-select",{onshow(){const e=document.createElement("div");e.className="panel mb-4",r.forEach(s=>{const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-bylaw-number",s.bylawNumber),n.setAttribute("href","#"),n.innerHTML=cityssm.escapeHTML(s.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(s.bylawDescription)+"</span>",n.addEventListener("click",t),e.appendChild(n)});const s=document.getElementById("container--parkingBylaws");cityssm.clearElement(s),s.appendChild(e)},onshown(t,s){e=s}})};d.addEventListener("dblclick",L),document.getElementById("is-select-bylaw-filter-button").addEventListener("click",L),document.getElementById("is-clear-bylaw-filter-button").addEventListener("click",()=>{v(),h()}),u||v(),n.addEventListener("change",h);for(const e of exports.locations)s.set(e.locationKey,e);delete exports.locations;for(const e of exports.bylaws)r.set(e.bylawNumber,e);delete exports.bylaws,b(exports.offences),delete exports.offences,pts.getDefaultConfigProperty("locationClasses",h)})();