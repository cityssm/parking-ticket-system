"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementById("ticket--ticketID").value,t=""===e,n=document.getElementById("container--form-message"),s=()=>{cityssm.enableNavBlocker(),n.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},c=document.querySelectorAll(".input, .select, .textarea");for(const e of c)e.addEventListener("change",s);document.getElementById("form--ticket").addEventListener("submit",e=>{e.preventDefault();const c=document.getElementById("ticket--ticketNumber").value;n.innerHTML='<span class="tag is-light is-info is-medium"><span>Saving ticket... </span> <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span></div>',cityssm.postJSON(t?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",e.currentTarget,e=>{e.success?(cityssm.disableNavBlocker(),n.innerHTML='<span class="tag is-light is-success is-medium"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span> <span>Saved Successfully</span></div>'):(s(),cityssm.alertModal("Ticket Not Saved",e.message,"OK","danger")),e.success&&t&&cityssm.openHtmlModal("ticket-createSuccess",{onshow(){document.getElementById("createSuccess--ticketNumber").innerText=c,document.getElementById("createSuccess--editTicketButton").setAttribute("href","/tickets/"+e.ticketID.toString()+"/edit"),document.getElementById("createSuccess--newTicketButton").setAttribute("href","/tickets/new/"+e.nextTicketNumber)}})})}),t||document.getElementById("is-delete-ticket-button").addEventListener("click",t=>{t.preventDefault(),cityssm.confirmModal("Delete Ticket?","Are you sure you want to delete this ticket record?","Yes, Delete Ticket","danger",()=>{cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:e},e=>{e.success&&(window.location.href="/tickets")})})}),pts.getDefaultConfigProperty("locationClasses",()=>{let e,t=[];const n=n=>{n.preventDefault(),document.getElementById("ticket--locationKey").value="",document.getElementById("ticket--locationName").value="",e(),t=[]},s=n=>{n.preventDefault();const s=t[parseInt(n.currentTarget.getAttribute("data-index"),10)];document.getElementById("ticket--locationKey").value=s.locationKey,document.getElementById("ticket--locationName").value=s.locationName,e(),t=[]},c=c=>{c.preventDefault(),cityssm.openHtmlModal("ticket-setLocation",{onshown(c,i){e=i,cityssm.postJSON("/offences/doGetAllLocations",{},e=>{t=e;const n=document.createElement("div");n.className="panel mb-4",t.forEach((e,t)=>{const c=pts.getLocationClass(e.locationClassKey),i=document.createElement("a");i.className="panel-block is-block",i.setAttribute("data-index",t.toString()),i.setAttribute("href","#"),i.addEventListener("click",s),i.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(e.locationName)+"</div>"+(c?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(c.locationClass)+"</span></div>":"")+"</div>",n.insertAdjacentElement("beforeend",i)});const c=document.getElementById("container--parkingLocations");cityssm.clearElement(c),c.insertAdjacentElement("beforeend",n)}),document.getElementById("is-clear-location-button").addEventListener("click",n)},onremoved(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",c),document.getElementById("ticket--locationName").addEventListener("dblclick",c)});{let e,t=[],n=[];const s=n=>{n.preventDefault(),document.getElementById("ticket--bylawNumber").value="";const s=document.getElementById("ticket--offenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),s.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),s.value="";const c=document.getElementById("ticket--discountOffenceAmount");c.classList.add("is-readonly"),c.setAttribute("readonly","readonly"),c.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),c.value="";const i=document.getElementById("ticket--discountDays");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),i.value="",document.getElementById("ticket--parkingOffence").value="",e(),t=[]},c=n=>{n.preventDefault();const s=t[parseInt(n.currentTarget.getAttribute("data-index"),10)];document.getElementById("ticket--bylawNumber").value=s.bylawNumber;const c=document.getElementById("ticket--offenceAmount");c.classList.add("is-readonly"),c.setAttribute("readonly","readonly"),c.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),c.value=s.offenceAmount.toFixed(2);const i=document.getElementById("ticket--discountOffenceAmount");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),i.value=s.discountOffenceAmount.toFixed(2);const l=document.getElementById("ticket--discountDays");l.classList.add("is-readonly"),l.setAttribute("readonly","readonly"),l.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),l.value=s.discountDays.toString(),document.getElementById("ticket--parkingOffence").value=s.bylawDescription,e(),t=[]},i=()=>{const e=document.getElementById("ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:e},e=>{t=e,n=[];const s=document.createElement("div");s.className="panel mb-4",t.forEach((e,t)=>{const i=document.createElement("a");i.className="panel-block is-block",i.setAttribute("data-index",t.toString()),i.setAttribute("href","#"),i.addEventListener("click",c),i.innerHTML='<div class="columns"><div class="column"><span class="has-text-weight-semibold">'+cityssm.escapeHTML(e.bylawNumber)+"</span><br /><small>"+cityssm.escapeHTML(e.bylawDescription)+'</small></div><div class="column is-narrow has-text-weight-semibold">$'+e.offenceAmount.toFixed(2)+"</div></div>",s.insertAdjacentElement("beforeend",i),n.push(i)});const i=document.getElementById("container--bylawNumbers");cityssm.clearElement(i),i.appendChild(s)})},l=e=>{const s=e.currentTarget.value.trim().toLowerCase().split(" ");t.forEach((e,t)=>{let c=!0;for(const t of s)if(!e.bylawNumber.toLowerCase().includes(t)&&!e.bylawDescription.toLowerCase().includes(t)){c=!1;break}c?n[t].classList.remove("is-hidden"):n[t].classList.add("is-hidden")})},o=t=>{t.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown(t,n){e=n,i();const c=document.getElementById("bylawLookup--searchStr");c.focus(),c.addEventListener("keyup",l),document.getElementById("is-clear-bylaw-button").addEventListener("click",s)},onremoved(){document.getElementById("is-bylaw-lookup-button").focus()}})};document.getElementById("is-bylaw-lookup-button").addEventListener("click",o),document.getElementById("ticket--bylawNumber").addEventListener("dblclick",o)}{const e=document.getElementById("ticket--licencePlateIsMissing");e.addEventListener("change",()=>{e.checked?(document.getElementById("ticket--licencePlateCountry").removeAttribute("required"),document.getElementById("ticket--licencePlateProvince").removeAttribute("required"),document.getElementById("ticket--licencePlateNumber").removeAttribute("required")):(document.getElementById("ticket--licencePlateCountry").setAttribute("required","required"),document.getElementById("ticket--licencePlateProvince").setAttribute("required","required"),document.getElementById("ticket--licencePlateNumber").setAttribute("required","required"))})}const i=()=>{const e=document.getElementById("datalist--licencePlateProvince");cityssm.clearElement(e);const t=document.getElementById("ticket--licencePlateCountry").value,n=pts.getLicencePlateCountryProperties(t);if(null==n?void 0:n.provinces){const t=Object.values(n.provinces);for(const n of t){const t=document.createElement("option");t.setAttribute("value",n.provinceShortName),e.appendChild(t)}}};document.getElementById("ticket--licencePlateCountry").addEventListener("change",i),pts.loadDefaultConfigProperties(i);const l=e=>{e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-unlock"),s=t.closest(".field").getElementsByTagName(n)[0];s.removeAttribute("readonly"),s.classList.remove("is-readonly"),s.focus(),t.setAttribute("disabled","disabled")},o=document.getElementsByClassName("is-unlock-field-button");for(const e of o)e.addEventListener("click",l)})();