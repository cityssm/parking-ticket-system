"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){const e=document.getElementById("ticket--ticketID").value,t=""===e;{const e=document.getElementById("container--form-message");let s=!1;const n=function(){cityssm.enableNavBlocker(),s=!0,e.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},i=document.querySelectorAll(".input, .select, .textarea");for(let e=0;e<i.length;e+=1)i[e].addEventListener("change",n);document.getElementById("form--ticket").addEventListener("submit",function(i){i.preventDefault();const a=document.getElementById("ticket--ticketNumber").value;e.innerHTML='<span class="tag is-light is-info is-medium"><span>Saving ticket... </span> <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span></div>',cityssm.postJSON(t?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",i.currentTarget,function(i){i.success?(cityssm.disableNavBlocker(),s=!1,e.innerHTML='<span class="tag is-light is-success is-medium"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span> <span>Saved Successfully</span></div>'):(n(),cityssm.alertModal("Ticket Not Saved",i.message,"OK","danger")),i.success&&t&&cityssm.openHtmlModal("ticket-createSuccess",{onshow:function(){document.getElementById("createSuccess--ticketNumber").innerText=a,document.getElementById("createSuccess--editTicketButton").setAttribute("href","/tickets/"+i.ticketID+"/edit"),document.getElementById("createSuccess--newTicketButton").setAttribute("href","/tickets/new/"+i.nextTicketNumber)}})})})}t||document.getElementById("is-delete-ticket-button").addEventListener("click",function(t){t.preventDefault(),cityssm.confirmModal("Delete Ticket?","Are you sure you want to delete this ticket record?","Yes, Delete Ticket","danger",function(){cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:e},function(e){e.success&&(window.location.href="/tickets")})})}),pts.getDefaultConfigProperty("locationClasses",function(e){let t;const s={};let n=[];for(let t=0;t<e.length;t+=1){const n=e[t];s[n.locationClassKey]=n}const i=function(e){e.preventDefault();const s=n[parseInt(e.currentTarget.getAttribute("data-index"))];document.getElementById("ticket--locationKey").value=s.locationKey,document.getElementById("ticket--locationName").value=s.locationName,t(),n=[]},a=function(e){e.preventDefault(),cityssm.openHtmlModal("location-select",{onshown:function(e,a){t=a,cityssm.postJSON("/offences/doGetAllLocations",{},function(e){n=e;const t=document.createElement("div");t.className="list is-hoverable has-margin-bottom-20";for(let e=0;e<n.length;e+=1){const a=n[e],c=s[a.locationClassKey],l=document.createElement("a");l.className="list-item",l.setAttribute("data-index",e.toString()),l.setAttribute("href","#"),l.addEventListener("click",i),l.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(a.locationName)+"</div>"+(c?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(c.locationClass)+"</span></div>":"")+"</div>",t.insertAdjacentElement("beforeend",l)}const a=document.getElementById("container--parkingLocations");cityssm.clearElement(a),a.insertAdjacentElement("beforeend",t)})},onremoved:function(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",a),document.getElementById("ticket--locationName").addEventListener("dblclick",a)});{let e,t=[],s=[];const n=function(s){s.preventDefault();const n=t[parseInt(s.currentTarget.getAttribute("data-index"))];document.getElementById("ticket--bylawNumber").value=n.bylawNumber;const i=document.getElementById("ticket--offenceAmount");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),i.value=n.offenceAmount.toFixed(2);const a=document.getElementById("ticket--discountOffenceAmount");a.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),a.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),a.value=n.discountOffenceAmount.toFixed(2);const c=document.getElementById("ticket--discountDays");c.classList.add("is-readonly"),c.setAttribute("readonly","readonly"),c.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),c.value=n.discountDays.toString(),document.getElementById("ticket--parkingOffence").value=n.bylawDescription,e(),t=[]},i=function(){const e=document.getElementById("ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:e},function(e){t=e;const i=document.createElement("div");i.className="list is-hoverable has-margin-bottom-20";for(let e=0;e<t.length;e+=1){const a=t[e],c=document.createElement("a");c.className="list-item",c.setAttribute("data-index",e.toString()),c.setAttribute("href","#"),c.addEventListener("click",n),c.innerHTML='<div class="columns"><div class="column"><span class="has-text-weight-semibold">'+cityssm.escapeHTML(a.bylawNumber)+"</span><br /><small>"+cityssm.escapeHTML(a.bylawDescription)+'</small></div><div class="column is-narrow has-text-weight-semibold">$'+a.offenceAmount.toFixed(2)+"</div></div>",i.insertAdjacentElement("beforeend",c),s.push(c)}const a=document.getElementById("container--bylawNumbers");cityssm.clearElement(a),a.appendChild(i)})},a=function(e){const n=e.currentTarget.value.trim().toLowerCase().split(" ");for(let e=0;e<t.length;e+=1){let i=!0;const a=t[e];for(let e=0;e<n.length;e+=1){const t=n[e];if(-1===a.bylawNumber.toLowerCase().indexOf(t)&&-1===a.bylawDescription.toLowerCase().indexOf(t)){i=!1;break}}i?s[e].classList.remove("is-hidden"):s[e].classList.add("is-hidden")}},c=function(t){t.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown:function(t,s){e=s,i();const n=document.getElementById("bylawLookup--searchStr");n.focus(),n.addEventListener("keyup",a)},onremoved:function(){document.getElementById("is-bylaw-lookup-button").focus()}})};document.getElementById("is-bylaw-lookup-button").addEventListener("click",c),document.getElementById("ticket--bylawNumber").addEventListener("dblclick",c)}{const e=document.getElementById("ticket--licencePlateIsMissing");e.addEventListener("change",function(){e.checked?(document.getElementById("ticket--licencePlateCountry").removeAttribute("required"),document.getElementById("ticket--licencePlateProvince").removeAttribute("required"),document.getElementById("ticket--licencePlateNumber").removeAttribute("required")):(document.getElementById("ticket--licencePlateCountry").setAttribute("required","required"),document.getElementById("ticket--licencePlateProvince").setAttribute("required","required"),document.getElementById("ticket--licencePlateNumber").setAttribute("required","required"))})}{const e=function(){const e=document.getElementById("datalist--licencePlateProvince");cityssm.clearElement(e);const t=pts.getLicencePlateCountryProperties(document.getElementById("ticket--licencePlateCountry").value);if(t&&t.provinces){const s=Object.values(t.provinces);for(let t=0;t<s.length;t+=1){const n=document.createElement("option");n.setAttribute("value",s[t].provinceShortName),e.appendChild(n)}}};document.getElementById("ticket--licencePlateCountry").addEventListener("change",e),pts.loadDefaultConfigProperties(e)}const s=function(e){const t=e.getElementsByClassName("panel-block");for(;t.length>0;)t[0].remove()};if(!t){const t=document.getElementById("is-remark-panel");let n=exports.ticketRemarks;delete exports.ticketRemarks;const i=function(t){const s=t.currentTarget.getAttribute("data-remark-index");cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this remark?","Yes, Delete","warning",function(){cityssm.postJSON("/tickets/doDeleteRemark",{ticketID:e,remarkIndex:s},function(e){e.success&&l()})})},a=function(t){let s;t.preventDefault();const i=parseInt(t.currentTarget.getAttribute("data-index")),a=n[i],c=function(e){e.preventDefault(),cityssm.postJSON("/tickets/doUpdateRemark",e.currentTarget,function(e){e.success&&(s(),l())})};cityssm.openHtmlModal("ticket-editRemark",{onshow:function(t){document.getElementById("editRemark--ticketID").value=e,document.getElementById("editRemark--remarkIndex").value=a.remarkIndex,document.getElementById("editRemark--remark").value=a.remark,document.getElementById("editRemark--remarkDateString").value=a.remarkDateString,document.getElementById("editRemark--remarkTimeString").value=a.remarkTimeString,t.getElementsByTagName("form")[0].addEventListener("submit",c)},onshown:function(e,t){s=t}})},c=function(){if(s(t),0!==n.length)for(let e=0;e<n.length;e+=1){const s=n[e],c=document.createElement("div");c.className="panel-block is-block",c.innerHTML='<div class="columns"><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(s.remark)+'</p><p class="is-size-7">'+(s.recordCreate_timeMillis===s.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+s.recordUpdate_userName+" - "+s.remarkDateString+" "+s.remarkTimeString+"</p></div>"+(s.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-tooltip="Edit Remark" data-index="'+e+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-tooltip="Delete Remark" data-remark-index="'+s.remarkIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div>",s.canUpdate&&(c.getElementsByClassName("is-edit-remark-button")[0].addEventListener("click",a),c.getElementsByClassName("is-delete-remark-button")[0].addEventListener("click",i)),t.appendChild(c)}else t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this ticket.</p></div></div>')},l=function(){s(t),t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading remarks...</p></div>'),cityssm.postJSON("/tickets/doGetRemarks",{ticketID:e},function(e){n=e,c()})};document.getElementById("is-add-remark-button").addEventListener("click",function(t){let s;t.preventDefault();const n=function(e){e.preventDefault(),cityssm.postJSON("/tickets/doAddRemark",e.currentTarget,function(e){e.success&&(s(),l())})};cityssm.openHtmlModal("ticket-addRemark",{onshow:function(t){document.getElementById("addRemark--ticketID").value=e,t.getElementsByTagName("form")[0].addEventListener("submit",n)},onshown:function(e,t){s=t}})}),c()}if(!t){const t=document.getElementById("is-status-panel");let n=exports.ticketStatusLog;delete exports.ticketStatusLog;const i=function(t){t.preventDefault(),cityssm.confirmModal("Mark Ticket as Resolved?","Once resolved, you will no longer be able to make changes to the ticket.","Yes, Resolve Ticket","info",function(){cityssm.postJSON("/tickets/doResolveTicket",{ticketID:e},function(t){t.success&&(window.location.href="/tickets/"+e)})})},a=function(t){const s=t.currentTarget.getAttribute("data-status-index");cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this status?","Yes, Delete","warning",function(){cityssm.postJSON("/tickets/doDeleteStatus",{ticketID:e,statusIndex:s},function(e){e.success&&o()})})},c=function(t){let s;t.preventDefault();const i=parseInt(t.currentTarget.getAttribute("data-index")),a=n[i],c=function(e){e.preventDefault(),cityssm.postJSON("/tickets/doUpdateStatus",e.currentTarget,function(e){e.success&&(s(),o())})},l=function(e){const t=pts.getTicketStatus(e.currentTarget.value),s=document.getElementById("editStatus--statusField");if(s.value="",t&&t.statusField){const e=s.closest(".field");e.getElementsByTagName("label")[0].innerText=t.statusField.fieldLabel,e.classList.remove("is-hidden")}else s.closest(".field").classList.add("is-hidden");const n=document.getElementById("editStatus--statusField2");if(n.value="",t&&t.statusField2){const e=n.closest(".field");e.getElementsByTagName("label")[0].innerText=t.statusField2.fieldLabel,e.classList.remove("is-hidden")}else s.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-editStatus",{onshow:function(t){document.getElementById("editStatus--ticketID").value=e,document.getElementById("editStatus--statusIndex").value=a.statusIndex,document.getElementById("editStatus--statusField").value=a.statusField,document.getElementById("editStatus--statusField2").value=a.statusField2,document.getElementById("editStatus--statusNote").value=a.statusNote;const s=document.getElementById("editStatus--statusDateString");s.value=a.statusDateString,s.setAttribute("max",cityssm.dateToString(new Date)),document.getElementById("editStatus--statusTimeString").value=a.statusTimeString,pts.getDefaultConfigProperty("parkingTicketStatuses",function(e){let t=!1;const s=document.getElementById("editStatus--statusKey");for(let n=0;n<e.length;n+=1){const i=e[n];if((i.isUserSettable||i.statusKey===a.statusKey)&&(s.insertAdjacentHTML("beforeend",'<option value="'+i.statusKey+'">'+i.status+"</option>"),i.statusKey===a.statusKey)){if(t=!0,i.statusField){const e=document.getElementById("editStatus--statusField").closest(".field");e.getElementsByTagName("label")[0].innerText=i.statusField.fieldLabel,e.classList.remove("is-hidden")}if(i.statusField2){const e=document.getElementById("editStatus--statusField2").closest(".field");e.getElementsByTagName("label")[0].innerText=i.statusField2.fieldLabel,e.classList.remove("is-hidden")}}}t||s.insertAdjacentHTML("beforeend",'<option value="'+a.statusKey+'">'+a.statusKey+"</option>"),s.value=a.statusKey,s.addEventListener("change",l)}),t.getElementsByTagName("form")[0].addEventListener("submit",c)},onshown:function(e,t){s=t}})},l=function(){if(s(t),0!==n.length)for(let e=0;e<n.length;e+=1){const s=n[e],l=pts.getTicketStatus(s.statusKey);if(0===e&&l&&l.isFinalStatus){const e=document.createElement("div");e.className="panel-block is-block",e.innerHTML='<div class="message is-info is-clearfix"><div class="message-body"><div class="columns"><div class="column"><strong>This ticket is able to be marked as resolved.</strong></div><div class="column is-narrow has-text-right align-self-flex-end"><button class="button is-info" type="button"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Resolve Ticket</span></button></div></div></div></div>',e.getElementsByTagName("button")[0].addEventListener("click",i),t.appendChild(e)}const o=document.createElement("div");o.className="panel-block is-block",o.innerHTML='<div class="columns"><div class="column"><div class="level has-margin-bottom-5"><div class="level-left"><strong>'+(l?l.status:s.statusKey)+'</strong></div><div class="level-right">'+s.statusDateString+"</div></div>"+(s.statusField&&""!==s.statusField?'<p class="is-size-7"><strong>'+(l&&l.statusField?l.statusField.fieldLabel:"")+":</strong> "+s.statusField+"</p>":"")+(s.statusField2&&""!==s.statusField2?'<p class="is-size-7"><strong>'+(l&&l.statusField2?l.statusField2.fieldLabel:"")+":</strong> "+s.statusField2+"</p>":"")+'<p class="has-newline-chars is-size-7">'+s.statusNote+"</p></div>"+(s.canUpdate&&0===e?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-status-button" data-tooltip="Edit Status" data-index="'+e+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-status-button" data-tooltip="Delete Status" data-status-index="'+s.statusIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div>",s.canUpdate&&0===e&&(o.getElementsByClassName("is-edit-status-button")[0].addEventListener("click",c),o.getElementsByClassName("is-delete-status-button")[0].addEventListener("click",a)),t.appendChild(o)}else t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no statuses associated with this ticket.</p></div></div>')},o=function(){s(t),t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading statuses...</p></div>'),cityssm.postJSON("/tickets/doGetStatuses",{ticketID:e},function(e){n=e,l()})};document.getElementById("is-add-status-button").addEventListener("click",function(t){let s;t.preventDefault();const n=function(t){t.preventDefault();const n=document.getElementById("addStatus--resolveTicket").checked;cityssm.postJSON("/tickets/doAddStatus",t.currentTarget,function(t){t.success&&(s(),n?window.location.href="/tickets/"+e:o())})},i=function(e){const t=pts.getTicketStatus(e.currentTarget.value),s=document.getElementById("addStatus--statusField");if(s.value="",t&&t.statusField){const e=s.closest(".field");e.getElementsByTagName("label")[0].innerText=t.statusField.fieldLabel,e.classList.remove("is-hidden")}else s.closest(".field").classList.add("is-hidden");const n=document.getElementById("addStatus--statusField2");if(n.value="",t&&t.statusField2){const e=n.closest(".field");e.getElementsByTagName("label")[0].innerText=t.statusField2.fieldLabel,e.classList.remove("is-hidden")}else n.closest(".field").classList.add("is-hidden");const i=document.getElementById("addStatus--resolveTicket");i.checked=!1,t&&t.isFinalStatus?i.closest(".field").classList.remove("is-hidden"):i.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-addStatus",{onshow:function(t){document.getElementById("addStatus--ticketID").value=e,pts.getDefaultConfigProperty("parkingTicketStatuses",function(e){const t=document.getElementById("addStatus--statusKey");for(let s=0;s<e.length;s+=1){const n=e[s];n.isUserSettable&&t.insertAdjacentHTML("beforeend",'<option value="'+n.statusKey+'">'+n.status+"</option>")}t.addEventListener("change",i)}),t.getElementsByTagName("form")[0].addEventListener("submit",n)},onshown:function(e,t){s=t}})}),document.getElementById("is-add-paid-status-button").addEventListener("click",function(t){let s;t.preventDefault();const n=function(t){t.preventDefault();const n=document.getElementById("addPaidStatus--resolveTicket").checked;cityssm.postJSON("/tickets/doAddStatus",t.currentTarget,function(t){t.success&&(s(),n?window.location.href="/tickets/"+e:o())})};cityssm.openHtmlModal("ticket-addStatusPaid",{onshow:function(t){document.getElementById("addPaidStatus--ticketID").value=e;const s=document.getElementById("addPaidStatus--statusField"),i=document.getElementById("ticket--offenceAmount").value;let a=document.getElementById("ticket--issueDateString").value,c=document.getElementById("ticket--discountDays").value;if(""===a||""===c)s.value=i;else{const e=cityssm.dateToString(new Date);cityssm.dateStringDifferenceInDays(a,e)<=parseInt(c)?s.value=document.getElementById("ticket--discountOffenceAmount").value:s.value=i}t.getElementsByTagName("form")[0].addEventListener("submit",n)},onshown:function(e,t){s=t}})}),pts.loadDefaultConfigProperties(l)}{const e=function(e){e.preventDefault();const t=e.currentTarget,s=t.getAttribute("data-unlock"),n=t.closest(".field").getElementsByTagName(s)[0];n.removeAttribute("readonly"),n.classList.remove("is-readonly"),n.focus(),t.setAttribute("disabled","disabled")},t=document.getElementsByClassName("is-unlock-field-button");for(let s=0;s<t.length;s+=1)t[s].addEventListener("click",e)}}();