"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-update"),t=-1,a=!0,s=!1,n=document.getElementById("available--issueDaysAgo"),i=document.getElementById("is-available-plates-container"),c=document.getElementById("available--licencePlateNumber"),l=[],o=[];function r(e){e.preventDefault();var a=e.currentTarget;a.setAttribute("disabled","disabled");var s=parseInt(a.getAttribute("data-index"),10),n=l[s],i=a.closest(".is-plate-container");cityssm.postJSON("/plates/doAddLicencePlateToLookupBatch",{batchID:t,licencePlateCountry:"CA",licencePlateProvince:"ON",licencePlateNumber:n.licencePlateNumber,ticketID:n.ticketIDMin},function(e){e.success?(i.remove(),l[s]=null,g(e.batch)):a.removeAttribute("disabled")})}function d(e){e.preventDefault();var a=e.currentTarget;a.setAttribute("disabled","disabled");var s=parseInt(a.getAttribute("data-index"),10),n=o[s],i=a.closest(".is-entry-container");cityssm.postJSON("/plates/doRemoveLicencePlateFromLookupBatch",{batchID:t,licencePlateCountry:"CA",licencePlateProvince:"ON",licencePlateNumber:n.licencePlateNumber},function(e){e.success?(i.remove(),b()):a.removeAttribute("disabled")})}function u(e){e.preventDefault();cityssm.confirmModal("Clear Batch?","Are you sure you want to remove all licence plates from the batch?","Yes, Clear the Batch","warning",function(){cityssm.postJSON("/plates/doClearLookupBatch",{batchID:t},function(e){e.success&&(g(e.batch),b())})})}function p(e){e.preventDefault();var a=function(){window.open("/plates-ontario/mtoExport/"+t),s=!0};s?a():cityssm.confirmModal("Download Batch?","<strong>You are about to download this batch for the first time.</strong><br />The date of this download will be tracked as part of the batch record.","OK, Download the File","warning",a)}function m(e,t){return e+'<a class="tag has-tooltip-bottom" data-tooltip="View Ticket (Opens in New Window)" href="/tickets/byTicketNumber/'+encodeURIComponent(t)+'" target="_blank">'+cityssm.escapeHTML(t)+"</a> "}function h(){cityssm.clearElement(i);var e=document.createElement("div");e.className="panel";for(var a=c.value.toLowerCase().trim().split(" "),s=[],n=0;n<l.length;n+=1){var o=l[n];if(o){for(var d=!0,u=o.licencePlateNumber.toLowerCase(),p=0;p<a.length;p+=1)if(-1===u.indexOf(a[p])){d=!1;break}if(d){s.push([o.licencePlateNumber,o.ticketIDMin]);var h=document.createElement("div");h.className="panel-block is-block is-plate-container",h.innerHTML='<div class="level is-marginless"><div class="level-left"><div class="licence-plate"><div class="licence-plate-number">'+cityssm.escapeHTML(o.licencePlateNumber)+'</div></div></div><div class="level-right"><button class="button is-small" data-index="'+n+'" data-tooltip="Add to Batch" type="button"><span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add</span></button></div></div><div class="level"><div class="level-left"><div class="tags">'+o.ticketNumbers.reduce(m,"")+'</div></div><div class="level-right is-size-7">'+o.issueDateMinString+(o.issueDateMin===o.issueDateMax?"":" to "+o.issueDateMaxString)+"</div></div>",h.getElementsByTagName("button")[0].addEventListener("click",r),e.appendChild(h)}}}if(s.length>0){var v=document.createElement("button");v.className="button is-fullwidth mb-3",v.innerHTML='<span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add '+s.length+" Licence Plate"+(1===s.length?"":"s")+"</span>",v.addEventListener("click",function(){cityssm.openHtmlModal("loading",{onshown:function(e,a){document.getElementById("is-loading-modal-message").innerText="Adding "+s.length+" Licence Plate"+(1===s.length?"":"s")+"...",cityssm.postJSON("/plates/doAddAllLicencePlatesToLookupBatch",{batchID:t,licencePlateCountry:"CA",licencePlateProvince:"ON",licencePlateNumbers:s},function(e){a(),e.success&&(g(e.batch),b())})}})}),i.appendChild(v),i.appendChild(e)}else i.innerHTML='<div class="message is-info"><div class="message-body">There are no licence plates that meet your search criteria.</div></div>'}function b(){a?i.innerHTML='<div class="message is-info"><div class="message-body">Licence Plates cannot be added to a locked batch.</div></div>':(i.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading licence plates...</p>',cityssm.postJSON("/plates-ontario/doGetPlatesAvailableForMTOLookup",{batchID:t,issueDaysAgo:n.value},function(e){l=e,h()}))}document.getElementById("is-more-available-filters-toggle").addEventListener("click",function(e){e.preventDefault(),document.getElementById("is-more-available-filters").classList.toggle("is-hidden")}),c.addEventListener("keyup",h),n.addEventListener("change",b);var v=document.getElementById("is-lock-batch-button"),f=document.getElementById("is-batch-entries-container");function g(n){if(t=n.batchID,o=n.batchEntries,a=!(null==n.lockDate),s=!(null==n.sentDate),e&&(a?v.setAttribute("disabled","disabled"):v.removeAttribute("disabled")),document.getElementById("batchSelector--batchID").innerText="Batch #"+n.batchID,document.getElementById("batchSelector--batchDetails").innerHTML='<span class="icon is-small"><i class="fas fa-calendar"></i></span><span>'+n.batchDateString+"</span>"+(a?' <span class="tag is-light"><span class="icon is-small"><i class="fas fa-lock" aria-hidden="true"></i></span> <span>'+n.lockDateString+"</span></span>":""),cityssm.clearElement(f),0!==o.length){cityssm.clearElement(f);var i=document.createElement("div");i.className="panel";for(var c=0;c<o.length;c+=1){var l=o[c],r=document.createElement("div");r.className="panel-block is-block is-entry-container",r.innerHTML='<div class="level"><div class="level-left"><div class="licence-plate"><div class="licence-plate-number">'+cityssm.escapeHTML(l.licencePlateNumber)+"</div></div></div>"+(a?"":'<div class="level-right"><button class="button is-small" data-index="'+c+'" type="button"><span class="icon is-small"><i class="fas fa-minus" aria-hidden="true"></i></span><span>Remove</span></button></div>')+"</div>",a||r.getElementsByTagName("button")[0].addEventListener("click",d),i.appendChild(r)}if(a){var m=document.createElement("button");m.className="button is-fullwidth mb-3",m.innerHTML='<span class="icon is-small"><i class="fas fa-download" aria-hidden="true"></i></span><span>Download File for MTO</span>',m.addEventListener("click",p),f.appendChild(m),f.insertAdjacentHTML("beforeend",'<a class="button is-fullwidth mb-3" href="https://www.apps.rus.mto.gov.on.ca/edtW/login/login.jsp" target="_blank" rel="noreferrer"><span class="icon is-small"><i class="fas fa-building" aria-hidden="true"></i></span><span>MTO ARIS Login</span></a>')}else{var h=document.createElement("button");h.className="button is-fullwidth mb-3",h.innerHTML='<span class="icon is-small"><i class="fas fa-broom" aria-hidden="true"></i></span><span>Clear Batch</span>',h.addEventListener("click",u),f.appendChild(h)}f.appendChild(i)}else f.innerHTML='<div class="message is-info"><p class="message-body">There are no licence plates included in the batch.</p></div>'}document.getElementById("is-select-batch-button").addEventListener("click",function(a){var s,n;a.preventDefault();var i=function(e){e.preventDefault(),t=parseInt(e.currentTarget.getAttribute("data-batch-id"),10),s(),cityssm.postJSON("/plates/doGetLookupBatch",{batchID:t},function(e){g(e),b()})};cityssm.openHtmlModal("mto-selectBatch",{onshow:function(t){if(n=t.getElementsByClassName("is-results-container")[0],cityssm.postJSON("/plates/doGetUnreceivedLicencePlateLookupBatches",{},function(e){if(0!==e.length){var t=document.createElement("div");t.className="panel";for(var a=0;a<e.length;a+=1){var s=e[a],c=document.createElement("a");c.className="panel-block is-block",c.setAttribute("href","#"),c.setAttribute("data-batch-id",s.batchID),c.innerHTML='<div class="columns"><div class="column is-narrow">#'+s.batchID+'</div><div class="column has-text-right">'+s.batchDateString+'<br /><div class="tags justify-flex-end">'+(s.lockDate?'<span class="tag"><span class="icon is-small"><i class="fas fa-lock" aria-hidden="true"></i></span><span>Locked</span></span>':"")+(s.sentDate?'<span class="tag"><span class="icon is-small"><i class="fas fa-share" aria-hidden="true"></i></span><span>Sent to MTO</span></span>':"")+"</div></div></div>",c.addEventListener("click",i),t.appendChild(c)}cityssm.clearElement(n),n.appendChild(t)}else n.innerHTML='<div class="message is-info"><p class="message-body">There are no unsent batches available.</p></div>'}),e){var a=t.getElementsByClassName("is-create-batch-button")[0];a.classList.remove("is-hidden"),a.addEventListener("click",function(){s(),cityssm.confirmModal("Create a New Batch?","Are you sure you want to create a new licence plate lookup batch?","Yes, Create a Batch","info",function(){cityssm.postJSON("/plates/doCreateLookupBatch",{},function(e){e.success&&(g(e.batch),b())})})})}},onshown:function(e,t){s=t}})}),e&&v.addEventListener("click",function(){if(!a){cityssm.confirmModal("Lock Batch?",'<strong>Are you sure you want to lock the batch?</strong><br />Once the batch is locked, no licence plates can be added or deleted from the batch. All tickets related to the licence plates in the batch will be updated with a "Pending Lookup" status.',"Yes, Lock the Batch","info",function(){cityssm.postJSON("/plates/doLockLookupBatch",{batchID:t},function(e){e.success&&g(e.batch)})})}}),exports.plateExportBatch&&(g(exports.plateExportBatch),delete exports.plateExportBatch,b())}();