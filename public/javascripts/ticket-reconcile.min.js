"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{pts.initializeToggleHiddenLinks(document.querySelector("main"));const e=e=>{e.preventDefault();const t=e.currentTarget;t.setAttribute("disabled","disabled");const s=t.dataset.batchId,a=t.dataset.logIndex;cityssm.postJSON("/tickets/doAcknowledgeLookupError",{batchID:s,logIndex:a},e=>{if(e.success){const e=t.closest("td");cityssm.clearElement(e),e.innerHTML='<span class="tag is-light is-warning"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Acknowledged</span></span>'}else t.removeAttribute("disabled")})},t=document.querySelectorAll(".is-acknowledge-error-button");for(const s of t)s.addEventListener("click",e);const s=e=>{e.preventDefault();const t=e.currentTarget,s=t.closest("td"),i=s.closest("tr");cityssm.confirmModal("Clear Status","Are you sure you want to undo this status?","Yes, Remove the Status","warning",()=>{cityssm.postJSON("/tickets/doDeleteStatus",{ticketID:i.getAttribute("data-ticket-id"),statusIndex:t.getAttribute("data-status-index")},e=>{e.success&&(cityssm.clearElement(s),s.classList.remove("has-width-200"),s.innerHTML='<button class="button is-success is-ownership-match-button" type="button"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></button> <button class="button is-danger is-ownership-error-button" type="button"><i class="fas fa-times" aria-hidden="true"></i><span class="sr-only">Error</span></button>',s.querySelector(".is-ownership-match-button").addEventListener("click",a),s.querySelector(".is-ownership-error-button").addEventListener("click",c))})})},a=e=>{e.preventDefault();const t=e.currentTarget,a=t.closest("td"),c=a.closest("tr"),i=()=>{t.setAttribute("disabled","disabled");const e=c.dataset.licencePlateCountry,i=c.dataset.licencePlateProvince,n=c.dataset.licencePlateNumber,r=c.dataset.ticketId,o=c.dataset.recordDate;cityssm.postJSON("/tickets/doReconcileAsMatch",{licencePlateCountry:e,licencePlateProvince:i,licencePlateNumber:n,ticketID:r,recordDate:o},e=>{e.success?(cityssm.clearElement(a),a.innerHTML='<div class="tags has-addons"><span class="tag is-light is-success"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+e.statusIndex.toString()+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',a.querySelector("a").addEventListener("click",s)):(t.removeAttribute("disabled"),cityssm.alertModal("Record Not Updated",e.message,"OK","danger"))})};if(c.hasAttribute("data-is-vehicle-make-match")&&c.hasAttribute("data-is-licence-plate-expiry-date-match"))i();else{const e=c.dataset.ticketVehicle,t=c.dataset.ticketExpiryDate,s=c.dataset.ownerVehicle,a=c.dataset.ownerExpiryDate;cityssm.confirmModal("Confirm Match",'<p class="has-text-centered">Are you sure the details on the parking ticket match the details on the ownership record?</p><div class="columns mt-1"><div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(e)+'</span><br /><span class="is-size-5">'+(""===t?"(Not Set)":cityssm.escapeHTML(t))+'</span></div><div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(s)+'</span><br /><span class="is-size-5">'+cityssm.escapeHTML(a)+"</span></div></div>","Yes, Confirm Match","warning",i)}},c=e=>{e.preventDefault();const t=e.currentTarget,a=t.closest("td"),c=a.closest("tr"),i=()=>{t.setAttribute("disabled","disabled");const e=c.dataset.licencePlateCountry,i=c.dataset.licencePlateProvince,n=c.dataset.licencePlateNumber,r=c.dataset.ticketId,o=c.dataset.recordDate;cityssm.postJSON("/tickets/doReconcileAsError",{licencePlateCountry:e,licencePlateProvince:i,licencePlateNumber:n,ticketID:r,recordDate:o},e=>{e.success?(cityssm.clearElement(a),a.innerHTML='<div class="tags has-addons"><span class="tag is-light is-danger"><span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span><span>Match Error</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+e.statusIndex.toString()+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',a.querySelector("a").addEventListener("click",s)):(t.removeAttribute("disabled"),cityssm.alertModal("Record Not Updated",e.message,"OK","danger"))})};if(c.hasAttribute("data-is-vehicle-make-match")||c.hasAttribute("data-is-licence-plate-expiry-date-match")){const e=c.getAttribute("data-ticket-vehicle"),t=c.getAttribute("data-ticket-expiry-date"),s=c.getAttribute("data-owner-vehicle"),a=c.getAttribute("data-owner-expiry-date");cityssm.confirmModal("Confirm Error",'<p class="has-text-centered">Are you sure you want to mark an error between the details on the parking ticket and the details on the ownership record?</p><div class="columns mt-1"><div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(e)+'</span><br /><span class="is-size-5">'+(""===t?"(Not Set)":cityssm.escapeHTML(t))+'</span></div><div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(s)+'</span><br /><span class="is-size-5">'+cityssm.escapeHTML(a)+"</span></div></div>","Yes, Confirm Error","warning",i)}else i()},i=document.querySelectorAll(".is-ownership-match-button");for(const e of i)e.addEventListener("click",a);const n=document.querySelectorAll(".is-ownership-error-button");for(const e of n)e.addEventListener("click",c);const r=document.querySelector("#is-quick-reconcile-matches-button");r&&r.addEventListener("click",e=>{let t;e.preventDefault();cityssm.confirmModal("Quick Reconcile Matches","Are you sure you want to mark all parking tickets with matching vehicle makes and plate expiry dates as matched?","Yes, Mark All Matches as Matched","info",()=>{cityssm.openHtmlModal("loading",{onshown(e,a){document.querySelector("#is-loading-modal-message").textContent="Reconciling matches...",t=a,cityssm.postJSON("/tickets/doQuickReconcileMatches",{},e=>{if(t(),e.success){cityssm.alertModal("Quick Reconcile Complete",1===e.statusRecords.length?"One record was successfully reconciled as a match.":e.statusRecords.length.toString()+" records were successfully reconciled as matches.","OK","success");for(const t of e.statusRecords){const e=document.querySelector("#is-options-cell--"+t.ticketID.toString());e&&(cityssm.clearElement(e),e.innerHTML='<div class="tags has-addons"><span class="tag is-light is-success"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+t.statusIndex.toString()+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',e.querySelector("a").addEventListener("click",s))}}})}})})})})();