"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("#ticket--ticketID").value,t=""===e,c=document.querySelector("#container--form-message"),o=()=>{cityssm.enableNavBlocker(),c.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},s=document.querySelectorAll(".input, .select, .textarea");for(const e of s)e.addEventListener("change",o);document.querySelector("#form--ticket").addEventListener("submit",e=>{e.preventDefault();const s=document.querySelector("#ticket--ticketNumber").value;c.innerHTML='<span class="tag is-light is-info is-medium"><span>Saving ticket... </span> <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span></div>',cityssm.postJSON(t?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",e.currentTarget,e=>{e.success?(cityssm.disableNavBlocker(),c.innerHTML='<span class="tag is-light is-success is-medium"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span> <span>Saved Successfully</span></div>'):(o(),cityssm.alertModal("Ticket Not Saved",e.message,"OK","danger")),e.success&&t&&cityssm.openHtmlModal("ticket-createSuccess",{onshow(){document.querySelector("#createSuccess--ticketNumber").textContent=s,document.querySelector("#createSuccess--editTicketButton").setAttribute("href","/tickets/"+e.ticketID.toString()+"/edit"),document.querySelector("#createSuccess--newTicketButton").setAttribute("href","/tickets/new/"+e.nextTicketNumber)}})})}),t||document.querySelector("#is-delete-ticket-button").addEventListener("click",t=>{t.preventDefault(),cityssm.confirmModal("Delete Ticket?","Are you sure you want to delete this ticket record?","Yes, Delete Ticket","danger",()=>{cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:e},e=>{e.success&&(window.location.href="/tickets")})})}),pts.getDefaultConfigProperty("locationClasses",()=>{let e,t=[];const c=c=>{c.preventDefault(),document.querySelector("#ticket--locationKey").value="",document.querySelector("#ticket--locationName").value="",e(),t=[]},o=c=>{c.preventDefault();const o=t[Number.parseInt(c.currentTarget.dataset.index,10)];document.querySelector("#ticket--locationKey").value=o.locationKey,document.querySelector("#ticket--locationName").value=o.locationName,e(),t=[]},s=s=>{s.preventDefault(),cityssm.openHtmlModal("ticket-setLocation",{onshown(s,n){e=n,cityssm.postJSON("/offences/doGetAllLocations",{},e=>{t=e;const c=document.createElement("div");c.className="panel mb-4";for(const[e,s]of t.entries()){const t=pts.getLocationClass(s.locationClassKey),n=document.createElement("a");n.className="panel-block is-block",n.dataset.index=e.toString(),n.setAttribute("href","#"),n.addEventListener("click",o),n.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(s.locationName)+"</div>"+(t&&t.locationClass?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(t.locationClass)+"</span></div>":"")+"</div>",c.append(n)}const s=document.querySelector("#container--parkingLocations");cityssm.clearElement(s),s.append(c)}),document.querySelector("#is-clear-location-button").addEventListener("click",c)},onremoved(){document.querySelector("#is-location-lookup-button").focus()}})};document.querySelector("#is-location-lookup-button").addEventListener("click",s),document.querySelector("#ticket--locationName").addEventListener("dblclick",s)});{let e,t=[],c=[];const o=c=>{c.preventDefault(),document.querySelector("#ticket--bylawNumber").value="";const o=document.querySelector("#ticket--offenceAmount");o.classList.add("is-readonly"),o.setAttribute("readonly","readonly"),o.closest(".field").querySelector(".is-unlock-field-button").removeAttribute("disabled"),o.value="";const s=document.querySelector("#ticket--discountOffenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),s.closest(".field").querySelector(".is-unlock-field-button").removeAttribute("disabled"),s.value="";const n=document.querySelector("#ticket--discountDays");n.classList.add("is-readonly"),n.setAttribute("readonly","readonly"),n.closest(".field").querySelector(".is-unlock-field-button").removeAttribute("disabled"),n.value="",document.querySelector("#ticket--parkingOffence").value="",e(),t=[]},s=c=>{c.preventDefault();const o=t[Number.parseInt(c.currentTarget.getAttribute("data-index"),10)];document.querySelector("#ticket--bylawNumber").value=o.bylawNumber;const s=document.querySelector("#ticket--offenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),s.closest(".field").querySelector(".is-unlock-field-button").removeAttribute("disabled"),s.value=o.offenceAmount.toFixed(2);const n=document.querySelector("#ticket--discountOffenceAmount");n.classList.add("is-readonly"),n.setAttribute("readonly","readonly"),n.closest(".field").querySelector(".is-unlock-field-button").removeAttribute("disabled"),n.value=o.discountOffenceAmount.toFixed(2);const i=document.querySelector("#ticket--discountDays");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").querySelector(".is-unlock-field-button").removeAttribute("disabled"),i.value=o.discountDays.toString(),document.querySelector("#ticket--parkingOffence").value=o.bylawDescription,e(),t=[]},n=()=>{const e=document.querySelector("#ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:e},e=>{t=e,c=[];const o=document.createElement("div");o.className="panel mb-4";for(const[e,n]of t.entries()){const t=document.createElement("a");t.className="panel-block is-block",t.dataset.index=e.toString(),t.setAttribute("href","#"),t.addEventListener("click",s),t.innerHTML='<div class="columns"><div class="column"><span class="has-text-weight-semibold">'+cityssm.escapeHTML(n.bylawNumber)+"</span><br /><small>"+cityssm.escapeHTML(n.bylawDescription)+'</small></div><div class="column is-narrow has-text-weight-semibold">$'+n.offenceAmount.toFixed(2)+"</div></div>",o.append(t),c.push(t)}const n=document.querySelector("#container--bylawNumbers");cityssm.clearElement(n),n.append(o)})},i=e=>{const o=e.currentTarget.value.trim().toLowerCase().split(" ");for(const[e,s]of t.entries()){let t=!0;for(const e of o)if(!s.bylawNumber.toLowerCase().includes(e)&&!s.bylawDescription.toLowerCase().includes(e)){t=!1;break}t?c[e].classList.remove("is-hidden"):c[e].classList.add("is-hidden")}},r=t=>{t.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown(t,c){e=c,n();const s=document.querySelector("#bylawLookup--searchStr");s.focus(),s.addEventListener("keyup",i),document.querySelector("#is-clear-bylaw-button").addEventListener("click",o)},onremoved(){document.querySelector("#is-bylaw-lookup-button").focus()}})};document.querySelector("#is-bylaw-lookup-button").addEventListener("click",r),document.querySelector("#ticket--bylawNumber").addEventListener("dblclick",r)}{const e=document.querySelector("#ticket--licencePlateIsMissing");e.addEventListener("change",()=>{e.checked?(document.querySelector("#ticket--licencePlateCountry").removeAttribute("required"),document.querySelector("#ticket--licencePlateProvince").removeAttribute("required"),document.querySelector("#ticket--licencePlateNumber").removeAttribute("required")):(document.querySelector("#ticket--licencePlateCountry").setAttribute("required","required"),document.querySelector("#ticket--licencePlateProvince").setAttribute("required","required"),document.querySelector("#ticket--licencePlateNumber").setAttribute("required","required"))})}const n=()=>{const e=document.querySelector("#datalist--licencePlateProvince");cityssm.clearElement(e);const t=document.querySelector("#ticket--licencePlateCountry").value,c=pts.getLicencePlateCountryProperties(t);if(null==c?void 0:c.provinces){const t=Object.values(c.provinces);for(const c of t){const t=document.createElement("option");t.setAttribute("value",c.provinceShortName),e.append(t)}}};document.querySelector("#ticket--licencePlateCountry").addEventListener("change",n),pts.loadDefaultConfigProperties(n);const i=e=>{e.preventDefault();const t=e.currentTarget,c=t.getAttribute("data-unlock"),o=t.closest(".field").querySelector(c);o.removeAttribute("readonly"),o.classList.remove("is-readonly"),o.focus(),t.setAttribute("disabled","disabled")},r=document.querySelectorAll(".is-unlock-field-button");for(const e of r)e.addEventListener("click",i)})();