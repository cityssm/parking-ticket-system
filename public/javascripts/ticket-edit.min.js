"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t,o,c,n;const i=document.querySelector("#ticket--ticketID").value,l=""===i,s=document.querySelector("#container--form-message");function r(){cityssm.enableNavBlocker(),s.innerHTML='<span class="tag is-light is-info is-medium">\n      <span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span>\n      <span>Unsaved Changes</span>\n      </span>'}const a=document.querySelectorAll(".input, .select, .textarea");for(const e of a)e.addEventListener("change",r);let u;null===(e=document.querySelector("#form--ticket"))||void 0===e||e.addEventListener("submit",e=>{e.preventDefault();const t=document.querySelector("#ticket--ticketNumber").value;s.innerHTML='<span class="tag is-light is-info is-medium">\n        <span>Saving ticket... </span>\n        <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span>\n        </span>',cityssm.postJSON(l?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",e.currentTarget,e=>{const o=e;o.success?(cityssm.disableNavBlocker(),s.innerHTML='<span class="tag is-light is-success is-medium">\n              <span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span>\n              <span>Saved Successfully</span>\n              </span>'):(r(),cityssm.alertModal("Ticket Not Saved",o.message,"OK","danger")),o.success&&l&&cityssm.openHtmlModal("ticket-createSuccess",{onshow(){var e,c;document.querySelector("#createSuccess--ticketNumber").textContent=t,null===(e=document.querySelector("#createSuccess--editTicketButton"))||void 0===e||e.setAttribute("href",`/tickets/${o.ticketID.toString()}/edit`),null===(c=document.querySelector("#createSuccess--newTicketButton"))||void 0===c||c.setAttribute("href",`/tickets/new/${o.nextTicketNumber}`)}})})}),l||null===(t=document.querySelector("#is-delete-ticket-button"))||void 0===t||t.addEventListener("click",e=>{e.preventDefault(),cityssm.confirmModal("Delete Ticket?","Are you sure you want to delete this ticket record?","Yes, Delete Ticket","danger",()=>{cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:i},e=>{e.success&&(window.location.href="/tickets")})})}),pts.getDefaultConfigProperty("locationClasses",()=>{var e,t;let o,c=[];function n(e){e.preventDefault(),document.querySelector("#ticket--locationKey").value="",document.querySelector("#ticket--locationName").value="",o(),c=[]}function i(e){var t;e.preventDefault();const n=c[Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10)];document.querySelector("#ticket--locationKey").value=n.locationKey,document.querySelector("#ticket--locationName").value=n.locationName,o(),c=[]}const l=e=>{e.preventDefault(),cityssm.openHtmlModal("ticket-setLocation",{onshown(e,t){var l;o=t,cityssm.postJSON("/offences/doGetAllLocations",{},e=>{c=e;const t=document.createElement("div");t.className="panel mb-4";for(const[e,o]of c.entries()){const c=pts.getLocationClass(o.locationClassKey),n=document.createElement("a");n.className="panel-block is-block",n.dataset.index=e.toString(),n.setAttribute("href","#"),n.addEventListener("click",i),n.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(o.locationName)+"</div>"+((null==c?void 0:c.locationClass)?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(c.locationClass)+"</span></div>":"")+"</div>",t.append(n)}const o=document.querySelector("#container--parkingLocations");cityssm.clearElement(o),o.append(t)}),null===(l=document.querySelector("#is-clear-location-button"))||void 0===l||l.addEventListener("click",n)},onremoved(){document.querySelector("#is-location-lookup-button").focus()}})};null===(e=document.querySelector("#is-location-lookup-button"))||void 0===e||e.addEventListener("click",l),null===(t=document.querySelector("#ticket--locationName"))||void 0===t||t.addEventListener("dblclick",l)});let d=[],m=[];function v(e){var t,o,c,n,i,l;e.preventDefault(),document.querySelector("#ticket--bylawNumber").value="";const s=document.querySelector("#ticket--offenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),null===(o=null===(t=s.closest(".field"))||void 0===t?void 0:t.querySelector(".is-unlock-field-button"))||void 0===o||o.removeAttribute("disabled"),s.value="";const r=document.querySelector("#ticket--discountOffenceAmount");r.classList.add("is-readonly"),r.setAttribute("readonly","readonly"),null===(n=null===(c=r.closest(".field"))||void 0===c?void 0:c.querySelector(".is-unlock-field-button"))||void 0===n||n.removeAttribute("disabled"),r.value="";const a=document.querySelector("#ticket--discountDays");a.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),null===(l=null===(i=a.closest(".field"))||void 0===i?void 0:i.querySelector(".is-unlock-field-button"))||void 0===l||l.removeAttribute("disabled"),a.value="",document.querySelector("#ticket--parkingOffence").value="",u(),d=[]}function y(e){var t,o,c,n,i,l,s;e.preventDefault();const r=d[Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10)];document.querySelector("#ticket--bylawNumber").value=r.bylawNumber;const a=document.querySelector("#ticket--offenceAmount");a.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),null===(c=null===(o=a.closest(".field"))||void 0===o?void 0:o.querySelector(".is-unlock-field-button"))||void 0===c||c.removeAttribute("disabled"),a.value=r.offenceAmount.toFixed(2);const m=document.querySelector("#ticket--discountOffenceAmount");m.classList.add("is-readonly"),m.setAttribute("readonly","readonly"),null===(i=null===(n=m.closest(".field"))||void 0===n?void 0:n.querySelector(".is-unlock-field-button"))||void 0===i||i.removeAttribute("disabled"),m.value=r.discountOffenceAmount.toFixed(2);const v=document.querySelector("#ticket--discountDays");v.classList.add("is-readonly"),v.setAttribute("readonly","readonly"),null===(s=null===(l=v.closest(".field"))||void 0===l?void 0:l.querySelector(".is-unlock-field-button"))||void 0===s||s.removeAttribute("disabled"),v.value=r.discountDays.toString(),document.querySelector("#ticket--parkingOffence").value=r.bylawDescription,u(),d=[]}function f(e){const t=e.currentTarget.value.trim().toLowerCase().split(" ");for(const[e,o]of d.entries()){let c=!0;for(const e of t)if(!o.bylawNumber.toLowerCase().includes(e)&&!o.bylawDescription.toLowerCase().includes(e)){c=!1;break}c?m[e].classList.remove("is-hidden"):m[e].classList.add("is-hidden")}}function b(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown(e,t){var o;u=t,function(){const e=document.querySelector("#ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:e},e=>{d=e,m=[];const t=document.createElement("div");t.className="panel mb-4";for(const[e,o]of d.entries()){const c=document.createElement("a");c.className="panel-block is-block",c.dataset.index=e.toString(),c.setAttribute("href","#"),c.addEventListener("click",y),c.innerHTML='<div class="columns"><div class="column"><span class="has-text-weight-semibold">'+cityssm.escapeHTML(o.bylawNumber)+"</span><br /><small>"+cityssm.escapeHTML(o.bylawDescription)+'</small></div><div class="column is-narrow has-text-weight-semibold">$'+o.offenceAmount.toFixed(2)+"</div></div>",t.append(c),m.push(c)}const o=document.querySelector("#container--bylawNumbers");cityssm.clearElement(o),o.append(t)})}();const c=document.querySelector("#bylawLookup--searchStr");c.focus(),c.addEventListener("keyup",f),null===(o=document.querySelector("#is-clear-bylaw-button"))||void 0===o||o.addEventListener("click",v)},onremoved(){document.querySelector("#is-bylaw-lookup-button").focus()}})}null===(o=document.querySelector("#is-bylaw-lookup-button"))||void 0===o||o.addEventListener("click",b),null===(c=document.querySelector("#ticket--bylawNumber"))||void 0===c||c.addEventListener("dblclick",b);{const e=document.querySelector("#ticket--licencePlateIsMissing");e.addEventListener("change",()=>{var t,o,c,n,i,l;e.checked?(null===(t=document.querySelector("#ticket--licencePlateCountry"))||void 0===t||t.removeAttribute("required"),null===(o=document.querySelector("#ticket--licencePlateProvince"))||void 0===o||o.removeAttribute("required"),null===(c=document.querySelector("#ticket--licencePlateNumber"))||void 0===c||c.removeAttribute("required")):(null===(n=document.querySelector("#ticket--licencePlateCountry"))||void 0===n||n.setAttribute("required","required"),null===(i=document.querySelector("#ticket--licencePlateProvince"))||void 0===i||i.setAttribute("required","required"),null===(l=document.querySelector("#ticket--licencePlateNumber"))||void 0===l||l.setAttribute("required","required"))})}const k=()=>{const e=document.querySelector("#datalist--licencePlateProvince");cityssm.clearElement(e);const t=document.querySelector("#ticket--licencePlateCountry").value,o=pts.getLicencePlateCountryProperties(t);if(null==o?void 0:o.provinces){const t=Object.values(o.provinces);for(const o of t){const t=document.createElement("option");t.setAttribute("value",o.provinceShortName),e.append(t)}}};null===(n=document.querySelector("#ticket--licencePlateCountry"))||void 0===n||n.addEventListener("change",k),pts.loadDefaultConfigProperties(k);const p=e=>{var t,o;e.preventDefault();const c=e.currentTarget,n=null!==(t=c.dataset.unlock)&&void 0!==t?t:"",i=null===(o=c.closest(".field"))||void 0===o?void 0:o.querySelector(n);i.removeAttribute("readonly"),i.classList.remove("is-readonly"),i.focus(),c.setAttribute("disabled","disabled")},S=document.querySelectorAll(".is-unlock-field-button");for(const e of S)e.addEventListener("click",p)})();