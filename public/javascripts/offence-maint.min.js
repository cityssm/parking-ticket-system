"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){const e=new Map,t=new Map,n=exports.accountNumberPattern;delete exports.accountNumberPattern;const s=new Map,a=document.getElementById("offenceFilter--limitResults"),c=document.getElementById("offenceResults"),o=document.getElementById("offenceFilter--location"),i=document.getElementById("offenceFilter--locationText");let l=!1,r="";const d=new Map,m=document.getElementById("offenceFilter--bylaw"),u=document.getElementById("offenceFilter--bylawText");let f=!1,y="";function b(e,t){return e+"::::"+t}function p(e){t.clear();for(let n=0;n<e.length;n+=1){const s=e[n],a=b(s.bylawNumber,s.locationKey);t.set(a,s)}}function g(a){a.preventDefault();const c=a.currentTarget,o=b(c.getAttribute("data-bylaw-number"),c.getAttribute("data-location-key")),i=t.get(o),l=s.get(i.locationKey),r=d.get(i.bylawNumber);let m;const u=function(){cityssm.postJSON("/admin/doDeleteOffence",{bylawNumber:i.bylawNumber,locationKey:i.locationKey},function(e){e.success&&(p(e.offences),m(),E())})},f=function(e){e.preventDefault(),cityssm.confirmModal("Remove Offence?","Are you sure you want to remove this offence?","Yes, Remove Offence","warning",u)},y=function(e){e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffence",e.currentTarget,function(e){e.success&&(p(e.offences),m(),E())})};cityssm.openHtmlModal("offence-edit",{onshow(){document.getElementById("offenceEdit--locationKey").value=i.locationKey,document.getElementById("offenceEdit--bylawNumber").value=i.bylawNumber,document.getElementById("offenceEdit--locationName").innerText=l.locationName,document.getElementById("offenceEdit--locationClass").innerText=e.has(l.locationClassKey)?e.get(l.locationClassKey).locationClass:l.locationClassKey,document.getElementById("offenceEdit--bylawNumberSpan").innerText=r.bylawNumber,document.getElementById("offenceEdit--bylawDescription").innerText=r.bylawDescription,document.getElementById("offenceEdit--parkingOffence").value=i.parkingOffence,document.getElementById("offenceEdit--offenceAmount").value=i.offenceAmount,document.getElementById("offenceEdit--discountOffenceAmount").value=i.discountOffenceAmount,document.getElementById("offenceEdit--discountDays").value=i.discountDays;const t=document.getElementById("offenceEdit--accountNumber");t.value=i.accountNumber,t.setAttribute("pattern",n)},onshown(e,t){m=t,document.getElementById("form--offenceEdit").addEventListener("submit",y),e.getElementsByClassName("is-delete-button")[0].addEventListener("click",f)}})}function h(e,t,n,s){cityssm.postJSON("/admin/doAddOffence",{bylawNumber:e,locationKey:t,returnOffences:n},function(e){e.success&&e.offences&&n&&(p(e.offences),E()),s&&s(e)})}function E(){const n=document.createElement("tbody");let o=0;const i=a.checked?parseInt(a.value,10):t.size;t.forEach(function(t){if(o>=i)return;if(l&&r!==t.locationKey||f&&y!==t.bylawNumber)return;const a=s.get(t.locationKey);if(!a)return;const c=d.get(t.bylawNumber);if(!c)return;if((o+=1)>i)return;const m=document.createElement("tr");m.innerHTML='<td class="has-border-right-width-2">'+cityssm.escapeHTML(a.locationName)+'<br /><span class="is-size-7">'+(e.has(a.locationClassKey)?e.get(a.locationClassKey).locationClass:a.locationClassKey)+'</span></td><td class="has-border-right-width-2"><strong>'+cityssm.escapeHTML(c.bylawNumber)+'</strong><br /><span class="is-size-7">'+cityssm.escapeHTML(c.bylawDescription)+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Set Rate">$'+t.offenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+t.accountNumber+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Discount Rate">$'+t.discountOffenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+t.discountDays+" day"+(1===t.discountDays?"":"s")+'</span></td><td class="has-border-right-width-2"><div class="is-size-7">'+cityssm.escapeHTML(t.parkingOffence)+'</div></td><td class="has-text-right"><button class="button is-small" data-bylaw-number="'+t.bylawNumber+'" data-location-key="'+t.locationKey+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button></td>',m.getElementsByTagName("button")[0].addEventListener("click",g),n.appendChild(m)}),cityssm.clearElement(c),0!==o?(c.innerHTML='<table class="table is-striped is-hoverable is-fullwidth"><thead><tr><th class="has-border-right-width-2">Location</th><th class="has-border-right-width-2">By-Law</th><th class="has-border-right-width-2" colspan="3">Offence</th><th class="has-width-50"></th></tr></thead></table>',c.getElementsByTagName("table")[0].appendChild(n),o>i&&c.insertAdjacentHTML("afterbegin",'<div class="message is-warning"><div class="message-body has-text-centered">Limit Reached</div></div>')):c.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no offences that match the given criteria.</p></div></div>'}function w(){o.value="",cityssm.clearElement(i),r="",l=!1}function v(){let t;const n=function(e){e.preventDefault();const n=s.get(e.currentTarget.getAttribute("data-location-key"));l=!0,r=n.locationKey,o.value=n.locationName,t(),E()};cityssm.openHtmlModal("location-select",{onshow(){const t=document.createElement("div");t.className="panel mb-4",s.forEach(function(s){const a=document.createElement("a");a.className="panel-block is-block",a.setAttribute("data-location-key",s.locationKey),a.setAttribute("href","#"),a.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(s.locationName)+'</div><div class="level-right">'+cityssm.escapeHTML(e.has(s.locationClassKey)?e.get(s.locationClassKey).locationClass:s.locationClassKey)+"</div></div>",a.addEventListener("click",n),t.appendChild(a)});const a=document.getElementById("container--parkingLocations");cityssm.clearElement(a),a.appendChild(t)},onshown(e,n){t=n}})}function N(){m.value="",cityssm.clearElement(u),y="",f=!1}function L(){let e;const t=function(t){t.preventDefault();const n=d.get(t.currentTarget.getAttribute("data-bylaw-number"));f=!0,y=n.bylawNumber,m.value=n.bylawNumber,u.innerText=n.bylawDescription,e(),E()};cityssm.openHtmlModal("bylaw-select",{onshow:function(){const e=document.createElement("div");e.className="panel mb-4",d.forEach(function(n){const s=document.createElement("a");s.className="panel-block is-block",s.setAttribute("data-bylaw-number",n.bylawNumber),s.setAttribute("href","#"),s.innerHTML=cityssm.escapeHTML(n.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(n.bylawDescription)+"</span>",s.addEventListener("click",t),e.appendChild(s)});const n=document.getElementById("container--parkingBylaws");cityssm.clearElement(n),n.appendChild(e)},onshown:function(t,n){e=n}})}document.getElementById("is-add-offence-button").addEventListener("click",function(n){if(n.preventDefault(),l&&f){const t=d.get(y),n=s.get(r);cityssm.confirmModal("Create Offence?",'<p class="has-text-centered">Are you sure you want to create the offence record below?</p><div class="columns my-4"><div class="column has-text-centered">'+cityssm.escapeHTML(n.locationName)+'<br /><span class="is-size-7">'+(e.has(n.locationClassKey)?e.get(n.locationClassKey).locationClass:n.locationClassKey)+'</span></div><div class="column has-text-centered">'+cityssm.escapeHTML(t.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(t.bylawDescription)+"</span></div></div>","Yes, Create Offence","info",function(){h(y,r,!0,function(e){e.success?e.message&&cityssm.alertModal("Offence Added Successfully",e.message,"OK","warning"):cityssm.alertModal("Offence Not Added",e.message,"OK","danger")})})}else l||f?function(){let n=!1;const a=function(e){e.preventDefault();const t=e.currentTarget;h(t.getAttribute("data-bylaw-number"),t.getAttribute("data-location-key"),!1,function(e){e.success&&(t.remove(),n=!0)})};cityssm.openHtmlModal("offence-addFromList",{onshow(t){let n="",a="";if(l){n="Select By-Laws";const t=s.get(r),c=e.get(t.locationClassKey);a=cityssm.escapeHTML(t.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(c?c.locationClass:t.locationClassKey)+"</span>"}else{n="Select Locations";const e=d.get(y);a=cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+e.bylawDescription+"</span>"}t.getElementsByClassName("modal-card-title")[0].innerHTML=n,document.getElementById("addContainer--selected").innerHTML=a},onshown(){const n=document.createElement("div");n.className="panel";let c=0;l?d.forEach(function(e){const s=b(e.bylawNumber,r);if(t.has(s))return;c+=1;const o=document.createElement("a");o.className="panel-block",o.setAttribute("data-bylaw-number",e.bylawNumber),o.setAttribute("data-location-key",r),o.innerHTML=cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(e.bylawDescription)+"</span>",o.addEventListener("click",a),n.appendChild(o)}):s.forEach(function(s){const o=b(y,s.locationKey);if(t.has(o))return;c+=1;const i=document.createElement("a");i.className="panel-block",i.setAttribute("data-bylaw-number",y),i.setAttribute("data-location-key",s.locationKey),i.innerHTML=cityssm.escapeHTML(s.locationName)+'<br /><span class="is-size-7">'+(e.has(s.locationClassKey)?cityssm.escapeHTML(e.get(s.locationClassKey).locationClass):s.locationClassKey)+"</span>",i.addEventListener("click",a),n.appendChild(i)});const o=document.getElementById("addContainer--results");cityssm.clearElement(o),0===c?o.innerHTML='<div class="message is-info"><div class="message-body">There are no offence records available for creation.</div></div>':o.appendChild(n)},onremoved(){n&&cityssm.postJSON("/offences/doGetAllOffences",{},function(e){p(e),E()})}})}():cityssm.alertModal("How to Create a New Offence","To add an offence, use the main filters to select either a location, a by-law, or both.","OK","info")}),o.addEventListener("dblclick",v),document.getElementById("is-select-location-filter-button").addEventListener("click",v),document.getElementById("is-clear-location-filter-button").addEventListener("click",function(){w(),E()}),l||w(),m.addEventListener("dblclick",L),document.getElementById("is-select-bylaw-filter-button").addEventListener("click",L),document.getElementById("is-clear-bylaw-filter-button").addEventListener("click",function(){N(),E()}),f||N(),a.addEventListener("change",E);for(let e=0;e<exports.locations.length;e+=1){const t=exports.locations[e];s.set(t.locationKey,t)}delete exports.locations;for(let e=0;e<exports.bylaws.length;e+=1){const t=exports.bylaws[e];d.set(t.bylawNumber,t)}delete exports.bylaws,p(exports.offences),delete exports.offences,pts.getDefaultConfigProperty("locationClasses",function(t){for(let n=0;n<t.length;n+=1){const s=t[n];e.set(s.locationClassKey,s)}E()})}();