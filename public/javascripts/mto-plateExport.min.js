(function(){function u(a){a.preventDefault();a=parseInt(a.currentTarget.getAttribute("data-index"));var c=d[a];d[a]=null;pts.postJSON("/plates/addLicencePlateToLookupBatch",{batchID:h,licencePlateCountry:"CA",licencePlateProvince:"ON",licencePlateNumber:c.licencePlateNumber},k)}function v(a,c){return a+'<a class="tag has-tooltip-bottom" data-tooltip="View Ticket (Opens in New Window)" href="/tickets/byTicketNumber/'+encodeURIComponent(c)+'" target="_blank">'+pts.escapeHTML(c)+"</a> "}function n(){pts.clearElement(l);
var a=document.createElement("div");a.className="panel";for(var c=p.value.toLowerCase().trim().split(" "),f=0;f<d.length;f+=1){var e=d[f];if(e){for(var b=!0,w=e.licencePlateNumber.toLowerCase(),m=0;m<c.length;m+=1)if(-1===w.indexOf(c[m])){b=!1;break}b&&(b=document.createElement("div"),b.className="panel-block is-block",b.innerHTML='<div class="level is-marginless">'+('<div class="level-left"><div class"licence-plate"><div class="licence-plate-number">'+pts.escapeHTML(e.licencePlateNumber)+"</div></div></div>")+
('<div class="level-right"><button class="button is-small" data-index="'+f+'" data-tooltip="Add to Batch" type="button"><span class="icon is-small"><i class="fas fa-plus" aria-hidden="true"></i></span><span>Add</span></button></div>')+'</div><div class="level"><div class="level-left"><div class="tags">'+e.ticketNumbers.reduce(v,"")+'</div></div><div class="level-right is-size-7">'+e.issueDateMinString+(e.issueDateMin===e.issueDateMax?"":" to "+e.issueDateMaxString)+"</div></div>",b.getElementsByTagName("button")[0].addEventListener("click",
u),a.appendChild(b))}}l.appendChild(a)}function q(){l.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading licence plates...</p>';pts.postJSON("/plates/mto_doGetPlatesAvailableForLookup",{issueDaysAgo:r.value},function(a){d=a;n()})}function k(a){h=a.batchID;document.getElementById("batchSelector--batchID").innerText="Batch #"+a.batchID;document.getElementById("batchSelector--batchDetails").innerHTML="Created "+
a.batchDateString;pts.clearElement(t);0===a.batchEntries.length&&(t.innerHTML='<div class="message is-info"><p class="message-body">There are no licence plates included in the batch.</p></div>')}var h=-1,r=document.getElementById("available--issueDaysAgo"),l=document.getElementById("is-available-plates-container"),p=document.getElementById("available--licencePlateNumber"),d=[];document.getElementById("is-more-available-filters-toggle").addEventListener("click",function(a){a.preventDefault();a=document.getElementById("is-more-available-filters");
a.classList.toggle("is-block");a.classList.toggle("is-hidden")});p.addEventListener("keyup",n);r.addEventListener("change",q);q();var t=document.getElementById("is-batch-entries-container");document.getElementById("is-select-batch-button").addEventListener("click",function(a){a.preventDefault();var c,f,e=function(a){a.preventDefault();h=parseInt(a.currentTarget.getAttribute("data-batch-id"));c();pts.postJSON("/plates/doGetLookupBatch",{batchID:h},k)},b=function(){pts.postJSON("/plates/doGetUnsentLicencePlateLookupBatches",
{},function(a){if(0===a.length)f.innerHTML='<div class="message is-info"><p class="message-body">There are no unsent batches available.</p></div>';else{var c=document.createElement("div");c.className="list is-hoverable";for(var b=0;b<a.length;b+=1){var d=a[b],g=document.createElement("a");g.className="list-item";g.setAttribute("href","#");g.setAttribute("data-batch-id",d.batchID);g.innerHTML='<div class="columns"><div class="column is-narrow">#'+d.batchID+'</div><div class="column has-text-right">'+
d.batchDateString+(d.lockDate?'<br /><span class="tag">Locked</span>':"")+"</div></div>";g.addEventListener("click",e);c.appendChild(g)}pts.clearElement(f);f.appendChild(c)}})};pts.openHtmlModal("mto-selectBatch",{onshow:function(a){f=a.getElementsByClassName("is-results-container")[0];b()},onshown:function(a,b){c=b}})});document.getElementById("is-create-batch-button").addEventListener("click",function(){pts.confirmModal("Create a New Batch?","Are you sure you want to create a new licence plate lookup batch?",
"Yes, Create a Batch","info",function(){pts.postJSON("/plates/doCreateLookupBatch",{},function(a){a.success&&k(a.batch)})})});pts.plateExportBatch&&(k(pts.plateExportBatch),delete pts.plateExportBatch)})();
