"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){const e=document.getElementById("ticket--ticketID").value,t=""===e;{const e=document.getElementById("container--form-message");let n=!1;const c=function(){cityssm.enableNavBlocker(),n=!0,e.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},s=document.querySelectorAll(".input, .select, .textarea");for(let e=0;e<s.length;e+=1)s[e].addEventListener("change",c);document.getElementById("form--ticket").addEventListener("submit",function(s){s.preventDefault();const i=document.getElementById("ticket--ticketNumber").value;e.innerHTML='<span class="tag is-light is-info is-medium"><span>Saving ticket... </span> <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span></div>',cityssm.postJSON(t?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",s.currentTarget,function(s){s.success?(cityssm.disableNavBlocker(),n=!1,e.innerHTML='<span class="tag is-light is-success is-medium"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span> <span>Saved Successfully</span></div>'):(c(),cityssm.alertModal("Ticket Not Saved",s.message,"OK","danger")),s.success&&t&&cityssm.openHtmlModal("ticket-createSuccess",{onshow:function(){document.getElementById("createSuccess--ticketNumber").innerText=i,document.getElementById("createSuccess--editTicketButton").setAttribute("href","/tickets/"+s.ticketID+"/edit"),document.getElementById("createSuccess--newTicketButton").setAttribute("href","/tickets/new/"+s.nextTicketNumber)}})})})}t||document.getElementById("is-delete-ticket-button").addEventListener("click",function(t){t.preventDefault(),cityssm.confirmModal("Delete Ticket?","Are you sure you want to delete this ticket record?","Yes, Delete Ticket","danger",function(){cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:e},function(e){e.success&&(window.location.href="/tickets")})})}),pts.getDefaultConfigProperty("locationClasses",function(e){let t;const n={};let c=[];for(let t=0;t<e.length;t+=1){const c=e[t];n[c.locationClassKey]=c}const s=function(e){e.preventDefault(),document.getElementById("ticket--locationKey").value="",document.getElementById("ticket--locationName").value="",t(),c=[]},i=function(e){e.preventDefault();const n=c[parseInt(e.currentTarget.getAttribute("data-index"),10)];document.getElementById("ticket--locationKey").value=n.locationKey,document.getElementById("ticket--locationName").value=n.locationName,t(),c=[]},o=function(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setLocation",{onshown:function(e,o){t=o,cityssm.postJSON("/offences/doGetAllLocations",{},function(e){c=e;const t=document.createElement("div");t.className="panel mb-4";for(let e=0;e<c.length;e+=1){const s=c[e],o=n[s.locationClassKey],l=document.createElement("a");l.className="panel-block is-block",l.setAttribute("data-index",e.toString()),l.setAttribute("href","#"),l.addEventListener("click",i),l.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(s.locationName)+"</div>"+(o?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(o.locationClass)+"</span></div>":"")+"</div>",t.insertAdjacentElement("beforeend",l)}const s=document.getElementById("container--parkingLocations");cityssm.clearElement(s),s.insertAdjacentElement("beforeend",t)}),document.getElementById("is-clear-location-button").addEventListener("click",s)},onremoved:function(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",o),document.getElementById("ticket--locationName").addEventListener("dblclick",o)});{let e,t=[],n=[];const c=function(n){n.preventDefault(),document.getElementById("ticket--bylawNumber").value="";const c=document.getElementById("ticket--offenceAmount");c.classList.add("is-readonly"),c.setAttribute("readonly","readonly"),c.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),c.value="";const s=document.getElementById("ticket--discountOffenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),s.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),s.value="";const i=document.getElementById("ticket--discountDays");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),i.value="",document.getElementById("ticket--parkingOffence").value="",e(),t=[]},s=function(n){n.preventDefault();const c=t[parseInt(n.currentTarget.getAttribute("data-index"),10)];document.getElementById("ticket--bylawNumber").value=c.bylawNumber;const s=document.getElementById("ticket--offenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),s.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),s.value=c.offenceAmount.toFixed(2);const i=document.getElementById("ticket--discountOffenceAmount");i.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),i.value=c.discountOffenceAmount.toFixed(2);const o=document.getElementById("ticket--discountDays");o.classList.add("is-readonly"),o.setAttribute("readonly","readonly"),o.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled"),o.value=c.discountDays.toString(),document.getElementById("ticket--parkingOffence").value=c.bylawDescription,e(),t=[]},i=function(){const e=document.getElementById("ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:e},function(e){t=e;const c=document.createElement("div");c.className="panel mb-4";for(let e=0;e<t.length;e+=1){const i=t[e],o=document.createElement("a");o.className="panel-block is-block",o.setAttribute("data-index",e.toString()),o.setAttribute("href","#"),o.addEventListener("click",s),o.innerHTML='<div class="columns"><div class="column"><span class="has-text-weight-semibold">'+cityssm.escapeHTML(i.bylawNumber)+"</span><br /><small>"+cityssm.escapeHTML(i.bylawDescription)+'</small></div><div class="column is-narrow has-text-weight-semibold">$'+i.offenceAmount.toFixed(2)+"</div></div>",c.insertAdjacentElement("beforeend",o),n.push(o)}const i=document.getElementById("container--bylawNumbers");cityssm.clearElement(i),i.appendChild(c)})},o=function(e){const c=e.currentTarget.value.trim().toLowerCase().split(" ");for(let e=0;e<t.length;e+=1){let s=!0;const i=t[e];for(let e=0;e<c.length;e+=1){const t=c[e];if(-1===i.bylawNumber.toLowerCase().indexOf(t)&&-1===i.bylawDescription.toLowerCase().indexOf(t)){s=!1;break}}s?n[e].classList.remove("is-hidden"):n[e].classList.add("is-hidden")}},l=function(t){t.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown:function(t,n){e=n,i();const s=document.getElementById("bylawLookup--searchStr");s.focus(),s.addEventListener("keyup",o),document.getElementById("is-clear-bylaw-button").addEventListener("click",c)},onremoved:function(){document.getElementById("is-bylaw-lookup-button").focus()}})};document.getElementById("is-bylaw-lookup-button").addEventListener("click",l),document.getElementById("ticket--bylawNumber").addEventListener("dblclick",l)}{const e=document.getElementById("ticket--licencePlateIsMissing");e.addEventListener("change",function(){e.checked?(document.getElementById("ticket--licencePlateCountry").removeAttribute("required"),document.getElementById("ticket--licencePlateProvince").removeAttribute("required"),document.getElementById("ticket--licencePlateNumber").removeAttribute("required")):(document.getElementById("ticket--licencePlateCountry").setAttribute("required","required"),document.getElementById("ticket--licencePlateProvince").setAttribute("required","required"),document.getElementById("ticket--licencePlateNumber").setAttribute("required","required"))})}{const e=function(){const e=document.getElementById("datalist--licencePlateProvince");cityssm.clearElement(e);const t=pts.getLicencePlateCountryProperties(document.getElementById("ticket--licencePlateCountry").value);if(t&&t.provinces){const n=Object.values(t.provinces);for(let t=0;t<n.length;t+=1){const c=document.createElement("option");c.setAttribute("value",n[t].provinceShortName),e.appendChild(c)}}};document.getElementById("ticket--licencePlateCountry").addEventListener("change",e),pts.loadDefaultConfigProperties(e)}{const e=function(e){e.preventDefault();const t=e.currentTarget,n=t.getAttribute("data-unlock"),c=t.closest(".field").getElementsByTagName(n)[0];c.removeAttribute("readonly"),c.classList.remove("is-readonly"),c.focus(),t.setAttribute("disabled","disabled")},t=document.getElementsByClassName("is-unlock-field-button");for(let n=0;n<t.length;n+=1)t[n].addEventListener("click",e)}}();