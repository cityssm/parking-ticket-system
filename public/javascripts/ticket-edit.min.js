"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t,o,n,c;const l=document.querySelector("#ticket--ticketId").value,i=""===l,s=document.querySelector("#container--form-message");function a(){cityssm.enableNavBlocker(),s.innerHTML='<span class="tag is-light is-info is-medium">\n      <span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span>\n      <span>Unsaved Changes</span>\n      </span>'}const r=document.querySelectorAll(".input, .select, .textarea");for(const e of r)e.addEventListener("change",a);function u(){cityssm.postJSON("/tickets/doDeleteTicket",{ticketId:l},e=>{e.success&&(window.location.href="/tickets")})}let d;null===(e=document.querySelector("#form--ticket"))||void 0===e||e.addEventListener("submit",e=>{e.preventDefault();const t=document.querySelector("#ticket--ticketNumber").value;s.innerHTML='<span class="tag is-light is-info is-medium">\n        <span>Saving ticket... </span>\n        <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span>\n        </span>',cityssm.postJSON(i?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",e.currentTarget,e=>{const o=e;o.success?(cityssm.disableNavBlocker(),s.innerHTML='<span class="tag is-light is-success is-medium">\n              <span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span>\n              <span>Saved Successfully</span>\n              </span>'):(a(),cityssm.alertModal("Ticket Not Saved",o.message,"OK","danger")),o.success&&i&&cityssm.openHtmlModal("ticket-createSuccess",{onshow(){var e,n;document.querySelector("#createSuccess--ticketNumber").textContent=t,null===(e=document.querySelector("#createSuccess--editTicketButton"))||void 0===e||e.setAttribute("href",`/tickets/${o.ticketId.toString()}/edit`),null===(n=document.querySelector("#createSuccess--newTicketButton"))||void 0===n||n.setAttribute("href",`/tickets/new/${o.nextTicketNumber}`)}})})}),null===(t=document.querySelector("#is-delete-ticket-button"))||void 0===t||t.addEventListener("click",e=>{e.preventDefault(),bulmaJS.confirm({title:"Delete Ticket",message:"Are you sure you want to delete this ticket record?",contextualColorName:"danger",okButton:{text:"Yes, Delete Ticket",callbackFunction:u}})}),pts.getDefaultConfigProperty("locationClasses",()=>{var e,t;let o,n,c=[];function l(e){e.preventDefault(),document.querySelector("#ticket--locationKey").value="",document.querySelector("#ticket--locationName").value="",o(),c=[]}function i(e){var t;e.preventDefault();const n=c[Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10)];document.querySelector("#ticket--locationKey").value=n.locationKey,document.querySelector("#ticket--locationName").value=n.locationName,o(),c=[]}function s(){const e=document.createElement("div");e.className="panel mb-4";const t=n.value.trim().toLowerCase().split(" ");e:for(const[o,n]of c.entries()){for(const e of t)if(!n.locationName.toLowerCase().includes(e))continue e;const c=pts.getLocationClass(n.locationClassKey),l=document.createElement("a");l.className="panel-block is-block",l.dataset.index=o.toString(),l.setAttribute("href","#"),l.addEventListener("click",i),l.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(n.locationName)+"</div>"+((null==c?void 0:c.locationClass)?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(c.locationClass)+"</span></div>":"")+"</div>",e.append(l)}const o=document.querySelector("#container--parkingLocations");cityssm.clearElement(o),o.append(e)}function a(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setLocation",{onshown(e,t){var i;bulmaJS.toggleHtmlClipped(),o=t,0===c.length?cityssm.postJSON("/offences/doGetAllLocations",{},e=>{c=e,s()}):s(),(n=e.querySelector("#filter--parkingLocations")).focus(),n.addEventListener("keyup",s),null===(i=e.querySelector("#is-clear-location-button"))||void 0===i||i.addEventListener("click",l)},onremoved(){document.querySelector("#is-location-lookup-button").focus(),bulmaJS.toggleHtmlClipped()}})}null===(e=document.querySelector("#is-location-lookup-button"))||void 0===e||e.addEventListener("click",a),null===(t=document.querySelector("#ticket--locationName"))||void 0===t||t.addEventListener("dblclick",a)});let m=[],v=[];function y(e){var t,o,n,c,l,i;e.preventDefault(),document.querySelector("#ticket--bylawNumber").value="";const s=document.querySelector("#ticket--offenceAmount");s.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),null===(o=null===(t=s.closest(".field"))||void 0===t?void 0:t.querySelector(".is-unlock-field-button"))||void 0===o||o.removeAttribute("disabled"),s.value="";const a=document.querySelector("#ticket--discountOffenceAmount");a.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),null===(c=null===(n=a.closest(".field"))||void 0===n?void 0:n.querySelector(".is-unlock-field-button"))||void 0===c||c.removeAttribute("disabled"),a.value="";const r=document.querySelector("#ticket--discountDays");r.classList.add("is-readonly"),r.setAttribute("readonly","readonly"),null===(i=null===(l=r.closest(".field"))||void 0===l?void 0:l.querySelector(".is-unlock-field-button"))||void 0===i||i.removeAttribute("disabled"),r.value="",document.querySelector("#ticket--parkingOffence").value="",d(),m=[]}function f(e){var t,o,n,c,l,i,s;e.preventDefault();const a=m[Number.parseInt(null!==(t=e.currentTarget.dataset.index)&&void 0!==t?t:"",10)];document.querySelector("#ticket--bylawNumber").value=a.bylawNumber;const r=document.querySelector("#ticket--offenceAmount");r.classList.add("is-readonly"),r.setAttribute("readonly","readonly"),null===(n=null===(o=r.closest(".field"))||void 0===o?void 0:o.querySelector(".is-unlock-field-button"))||void 0===n||n.removeAttribute("disabled"),r.value=a.offenceAmount.toFixed(2);const u=document.querySelector("#ticket--discountOffenceAmount");u.classList.add("is-readonly"),u.setAttribute("readonly","readonly"),null===(l=null===(c=u.closest(".field"))||void 0===c?void 0:c.querySelector(".is-unlock-field-button"))||void 0===l||l.removeAttribute("disabled"),u.value=a.discountOffenceAmount.toFixed(2);const v=document.querySelector("#ticket--discountDays");v.classList.add("is-readonly"),v.setAttribute("readonly","readonly"),null===(s=null===(i=v.closest(".field"))||void 0===i?void 0:i.querySelector(".is-unlock-field-button"))||void 0===s||s.removeAttribute("disabled"),v.value=a.discountDays.toString(),document.querySelector("#ticket--parkingOffence").value=a.bylawDescription,d(),m=[]}function p(e){const t=e.currentTarget.value.trim().toLowerCase().split(" ");for(const[e,o]of m.entries()){let n=!0;for(const e of t)if(!o.bylawNumber.toLowerCase().includes(e)&&!o.bylawDescription.toLowerCase().includes(e)){n=!1;break}n?v[e].classList.remove("is-hidden"):v[e].classList.add("is-hidden")}}function k(e){e.preventDefault(),cityssm.openHtmlModal("ticket-setBylawOffence",{onshown(e,t){var o;bulmaJS.toggleHtmlClipped(),d=t,function(){const e=document.querySelector("#ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:e},e=>{m=e,v=[];const t=document.createElement("div");t.className="panel mb-4";for(const[e,o]of m.entries()){const n=document.createElement("a");n.className="panel-block is-block",n.dataset.index=e.toString(),n.setAttribute("href","#"),n.addEventListener("click",f),n.innerHTML=`<div class="columns">\n            <div class="column">\n              <span class="has-text-weight-semibold">\n                ${cityssm.escapeHTML(o.bylawNumber)}\n              </span><br />\n              <small>\n                ${cityssm.escapeHTML(o.bylawDescription)}\n              </small>\n            </div>\n            <div class="column is-narrow has-text-weight-semibold">\n              $${o.offenceAmount.toFixed(2)}\n            </div></div>`,t.append(n),v.push(n)}const o=document.querySelector("#container--bylawNumbers");cityssm.clearElement(o),o.append(t)})}();const n=e.querySelector("#bylawLookup--searchStr");n.focus(),n.addEventListener("keyup",p),null===(o=e.querySelector("#is-clear-bylaw-button"))||void 0===o||o.addEventListener("click",y)},onremoved(){bulmaJS.toggleHtmlClipped(),document.querySelector("#is-bylaw-lookup-button").focus()}})}null===(o=document.querySelector("#is-bylaw-lookup-button"))||void 0===o||o.addEventListener("click",k),null===(n=document.querySelector("#ticket--bylawNumber"))||void 0===n||n.addEventListener("dblclick",k);{const e=document.querySelector("#ticket--licencePlateIsMissing"),t=["#ticket--licencePlateCountry","#ticket--licencePlateProvince","#ticket--licencePlateNumber"];e.addEventListener("change",()=>{for(const o of t)document.querySelector(o).required=!e.checked})}function b(){const e=document.querySelector("#datalist--licencePlateProvince");cityssm.clearElement(e);const t=document.querySelector("#ticket--licencePlateCountry").value,o=pts.getLicencePlateCountryProperties(t);if(null==o?void 0:o.provinces){const t=Object.values(o.provinces);for(const o of t){const t=document.createElement("option");t.setAttribute("value",o.provinceShortName),e.append(t)}}}function S(e){var t,o;e.preventDefault();const n=e.currentTarget,c=null!==(t=n.dataset.unlock)&&void 0!==t?t:"",l=null===(o=n.closest(".field"))||void 0===o?void 0:o.querySelector(c);l.removeAttribute("readonly"),l.classList.remove("is-readonly"),l.focus(),n.setAttribute("disabled","disabled")}null===(c=document.querySelector("#ticket--licencePlateCountry"))||void 0===c||c.addEventListener("change",b),pts.loadDefaultConfigProperties(b);const q=document.querySelectorAll(".is-unlock-field-button");for(const e of q)e.addEventListener("click",S)})();