"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=new Map,t=exports.accountNumberPattern;delete exports.accountNumberPattern;const s=new Map,a=document.querySelector("#offenceFilter--limitResults"),o=document.querySelector("#offenceResults"),c=document.querySelector("#offenceFilter--location"),n=document.querySelector("#offenceFilter--locationText");let l=!1,i="";const r=new Map,d=document.querySelector("#offenceFilter--bylaw"),u=document.querySelector("#offenceFilter--bylawText");let m=!1,f="";const y=(e,t)=>e+"::::"+t,b=t=>{e.clear();for(const s of t){const t=y(s.bylawNumber,s.locationKey);e.set(t,s)}},p=a=>{a.preventDefault();const o=a.currentTarget,c=y(o.dataset.bylawNumber,o.dataset.locationKey),n=e.get(c),l=s.get(n.locationKey),i=r.get(n.bylawNumber);let d;const u=()=>{cityssm.postJSON("/admin/doDeleteOffence",{bylawNumber:n.bylawNumber,locationKey:n.locationKey},e=>{e.success&&(b(e.offences),d(),w())})},m=e=>{e.preventDefault(),cityssm.confirmModal("Remove Offence?","Are you sure you want to remove this offence?","Yes, Remove Offence","warning",u)},f=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateOffence",e.currentTarget,e=>{e.success&&(b(e.offences),d(),w())})};cityssm.openHtmlModal("offence-edit",{onshow(){document.querySelector("#offenceEdit--locationKey").value=n.locationKey,document.querySelector("#offenceEdit--bylawNumber").value=n.bylawNumber,document.querySelector("#offenceEdit--locationName").textContent=l.locationName,document.querySelector("#offenceEdit--locationClass").textContent=pts.getLocationClass(l.locationClassKey).locationClass,document.querySelector("#offenceEdit--bylawNumberSpan").textContent=i.bylawNumber,document.querySelector("#offenceEdit--bylawDescription").textContent=i.bylawDescription,document.querySelector("#offenceEdit--parkingOffence").value=n.parkingOffence,document.querySelector("#offenceEdit--offenceAmount").value=n.offenceAmount.toFixed(2),document.querySelector("#offenceEdit--discountOffenceAmount").value=n.discountOffenceAmount.toFixed(2),document.querySelector("#offenceEdit--discountDays").value=n.discountDays.toString();const e=document.querySelector("#offenceEdit--accountNumber");e.value=n.accountNumber,e.setAttribute("pattern",t)},onshown(e,t){d=t,document.querySelector("#form--offenceEdit").addEventListener("submit",f),e.querySelector(".is-delete-button").addEventListener("click",m)}})},v=(e,t,s,a)=>{cityssm.postJSON("/admin/doAddOffence",{bylawNumber:e,locationKey:t,returnOffences:s},e=>{e.success&&e.offences&&s&&(b(e.offences),w()),a&&a(e)})},w=()=>{const t=document.createElement("tbody");let c=0;const n=a.checked?Number.parseInt(a.value,10):e.size;for(const a of e.values()){if(c>=n)continue;if(l&&i!==a.locationKey||m&&f!==a.bylawNumber)continue;const e=s.get(a.locationKey);if(!e)continue;const o=r.get(a.bylawNumber);if(!o)continue;if((c+=1)>n)continue;const d=document.createElement("tr");d.innerHTML='<td class="has-border-right-width-2">'+cityssm.escapeHTML(e.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(pts.getLocationClass(e.locationClassKey).locationClass)+'</span></td><td class="has-border-right-width-2"><strong>'+cityssm.escapeHTML(o.bylawNumber)+'</strong><br /><span class="is-size-7">'+cityssm.escapeHTML(o.bylawDescription)+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Set Rate">$'+a.offenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+a.accountNumber+'</span></td><td class="has-text-right has-tooltip-bottom" data-tooltip="Discount Rate">$'+a.discountOffenceAmount.toFixed(2)+'<br /><span class="is-size-7">'+a.discountDays.toString()+" day"+(1===a.discountDays?"":"s")+'</span></td><td class="has-border-right-width-2"><div class="is-size-7">'+cityssm.escapeHTML(a.parkingOffence)+'</div></td><td class="has-text-right"><button class="button is-small" data-bylaw-number="'+a.bylawNumber+'" data-location-key="'+a.locationKey+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button></td>',d.querySelector("button").addEventListener("click",p),t.append(d)}cityssm.clearElement(o),0!==c?(o.innerHTML='<table class="table is-striped is-hoverable is-fullwidth"><thead><tr><th class="has-border-right-width-2">Location</th><th class="has-border-right-width-2">By-Law</th><th class="has-border-right-width-2" colspan="3">Offence</th><th class="has-width-50"></th></tr></thead></table>',o.querySelector("table").append(t),c>n&&o.insertAdjacentHTML("afterbegin",'<div class="message is-warning"><div class="message-body has-text-centered">Limit Reached</div></div>')):o.innerHTML='<div class="message is-info"><div class="message-body"><p>There are no offences that match the given criteria.</p></div></div>'};document.querySelector("#is-add-offence-button").addEventListener("click",t=>{if(t.preventDefault(),l&&m){const e=r.get(f),t=s.get(i);bulmaJS.confirm({title:"Create Offence?",message:'<p class="has-text-centered">Are you sure you want to create the offence record below?</p><div class="columns my-4"><div class="column has-text-centered">'+cityssm.escapeHTML(t.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(pts.getLocationClass(t.locationClassKey).locationClass)+'</span></div><div class="column has-text-centered">'+cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(e.bylawDescription)+"</span></div></div>",messageIsHtml:!0,contextualColorName:"info",okButton:{text:"Yes, Create Offence",callbackFunction:()=>{v(f,i,!0,e=>{e.success?e.message&&bulmaJS.alert({title:"Offence Added Successfully",message:e.message,contextualColorName:"warning"}):bulmaJS.alert({title:"Offence Not Added",message:e.message,contextualColorName:"danger"})})}}})}else l||m?(()=>{let t=!1;const a=e=>{e.preventDefault();const s=e.currentTarget,a=s.dataset.bylawNumber,o=s.dataset.locationKey;v(a,o,!1,e=>{e.success&&(s.remove(),t=!0)})};cityssm.openHtmlModal("offence-addFromList",{onshow(e){let t="",a="";if(l){t="Select By-Laws";const e=s.get(i),o=pts.getLocationClass(e.locationClassKey);a=cityssm.escapeHTML(e.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(o.locationClass)+"</span>"}else{t="Select Locations";const e=r.get(f);a=cityssm.escapeHTML(e.bylawNumber)+'<br /><span class="is-size-7">'+e.bylawDescription+"</span>"}e.querySelector(".modal-card-title").innerHTML=t,document.querySelector("#addContainer--selected").innerHTML=a},onshown(){const t=document.createElement("div");t.className="panel";let o=0;if(l)for(const s of r.values()){const c=y(s.bylawNumber,i);if(e.has(c))continue;o+=1;const n=document.createElement("a");n.className="panel-block is-block",n.dataset.bylawNumber=s.bylawNumber,n.dataset.locationKey=i,n.innerHTML=cityssm.escapeHTML(s.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(s.bylawDescription)+"</span>",n.addEventListener("click",a),t.append(n)}else for(const c of s.values()){const s=y(f,c.locationKey);if(e.has(s))continue;o+=1;const n=document.createElement("a");n.className="panel-block is-block",n.dataset.bylawNumber=f,n.dataset.locationKey=c.locationKey,n.innerHTML=cityssm.escapeHTML(c.locationName)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(pts.getLocationClass(c.locationClassKey).locationClass)+"</span>",n.addEventListener("click",a),t.append(n)}const c=document.querySelector("#addContainer--results");cityssm.clearElement(c),0===o?c.innerHTML='<div class="message is-info"><div class="message-body">There are no offence records available for creation.</div></div>':c.append(t)},onremoved(){t&&cityssm.postJSON("/offences/doGetAllOffences",{},e=>{b(e),w()})}})})():bulmaJS.alert({title:"How to Create a New Offence",message:"To add an offence, use the main filters to select either a location, a by-law, or both.",contextualColorName:"warning"})});const h=()=>{c.value="",cityssm.clearElement(n),i="",l=!1},g=()=>{let e;const t=t=>{t.preventDefault();const a=s.get(t.currentTarget.dataset.locationKey);l=!0,i=a.locationKey,c.value=a.locationName,e(),w()};cityssm.openHtmlModal("location-select",{onshow(){const e=document.createElement("div");e.className="panel mb-4";for(const a of s.values()){const s=document.createElement("a");s.className="panel-block is-block",s.dataset.locationKey=a.locationKey,s.setAttribute("href","#"),s.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(a.locationName)+'</div><div class="level-right">'+cityssm.escapeHTML(pts.getLocationClass(a.locationClassKey).locationClass)+"</div></div>",s.addEventListener("click",t),e.append(s)}const a=document.querySelector("#container--parkingLocations");cityssm.clearElement(a),a.append(e)},onshown(t,s){e=s}})};c.addEventListener("dblclick",g),document.querySelector("#is-select-location-filter-button").addEventListener("click",g),document.querySelector("#is-clear-location-filter-button").addEventListener("click",()=>{h(),w()}),l||h();const N=()=>{d.value="",cityssm.clearElement(u),f="",m=!1},L=()=>{let e;const t=t=>{t.preventDefault();const s=r.get(t.currentTarget.dataset.bylawNumber);m=!0,f=s.bylawNumber,d.value=s.bylawNumber,u.textContent=s.bylawDescription,e(),w()};cityssm.openHtmlModal("bylaw-select",{onshow(){const e=document.createElement("div");e.className="panel mb-4";for(const s of r.values()){const a=document.createElement("a");a.className="panel-block is-block",a.dataset.bylawNumber=s.bylawNumber,a.setAttribute("href","#"),a.innerHTML=cityssm.escapeHTML(s.bylawNumber)+'<br /><span class="is-size-7">'+cityssm.escapeHTML(s.bylawDescription)+"</span>",a.addEventListener("click",t),e.append(a)}const s=document.querySelector("#container--parkingBylaws");cityssm.clearElement(s),s.append(e)},onshown(t,s){e=s}})};d.addEventListener("dblclick",L),document.querySelector("#is-select-bylaw-filter-button").addEventListener("click",L),document.querySelector("#is-clear-bylaw-filter-button").addEventListener("click",()=>{N(),w()}),m||N(),a.addEventListener("change",w);for(const e of exports.locations)s.set(e.locationKey,e);delete exports.locations;for(const e of exports.bylaws)r.set(e.bylawNumber,e);delete exports.bylaws,b(exports.offences),delete exports.offences,pts.getDefaultConfigProperty("locationClasses",w)})();