var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,g,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[g]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var g=0;return $jscomp.iteratorPrototype(function(){return g<b.length?{done:!1,value:b[g++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,g){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var f=0,k={next:function(){if(f<b.length){var h=f++;return{value:g(h,b[h]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};
$jscomp.polyfill=function(b,g,f,k){if(g){f=$jscomp.global;b=b.split(".");for(k=0;k<b.length-1;k++){var h=b[k];h in f||(f[h]={});f=f[h]}b=b[b.length-1];k=f[b];g=g(k);g!=k&&null!=g&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,f){return f})}},"es6","es3");
(function(){for(var b=document.getElementById("ticket--ticketID").value,g=""===b,f=document.getElementById("container--form-message"),k=function(a){cityssm.enableNavBlocker();f.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},h=document.querySelectorAll(".input, .select, .textarea"),n=0;n<h.length;n+=1)h[n].addEventListener("change",k);document.getElementById("form--ticket").addEventListener("submit",
function(a){a.preventDefault();var c=document.getElementById("ticket--ticketNumber").value;f.innerHTML='<span class="tag is-light is-info is-medium"><span>Saving ticket... </span> <span class="icon"><i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i></span></div>';cityssm.postJSON(g?"/tickets/doCreateTicket":"/tickets/doUpdateTicket",a.currentTarget,function(a){a.success?(cityssm.disableNavBlocker(),f.innerHTML='<span class="tag is-light is-success is-medium"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span> <span>Saved Successfully</span></div>'):
(k(),cityssm.alertModal("Ticket Not Saved",a.message,"OK","danger"));a.success&&g&&cityssm.openHtmlModal("ticket-createSuccess",{onshow:function(){document.getElementById("createSuccess--ticketNumber").innerText=c;document.getElementById("createSuccess--editTicketButton").setAttribute("href","/tickets/"+a.ticketID+"/edit");document.getElementById("createSuccess--newTicketButton").setAttribute("href","/tickets/new/"+a.nextTicketNumber)}})})});g||document.getElementById("is-delete-ticket-button").addEventListener("click",
function(a){a.preventDefault();cityssm.confirmModal("Delete Ticket?","Are you sure you want to delete this ticket record?","Yes, Delete Ticket","danger",function(){cityssm.postJSON("/tickets/doDeleteTicket",{ticketID:b},function(a){a.success&&(window.location.href="/tickets")})})});pts.getDefaultConfigProperty("locationClasses",function(a){for(var c,b={},d={},l=0;l<a.length;l+=1){var m=a[l];b[m.locationClassKey]=m}var f=function(a){a.preventDefault();a=d[parseInt(a.currentTarget.getAttribute("data-index"))];
document.getElementById("ticket--locationKey").value=a.locationKey;document.getElementById("ticket--locationName").value=a.locationName;c();d=[]},g=function(){cityssm.postJSON("/offences/doGetAllLocations",{},function(a){d=a;a=document.createElement("div");a.className="list is-hoverable has-margin-bottom-20";for(var c=0;c<d.length;c+=1){var e=d[c],l=b[e.locationClassKey],m=document.createElement("a");m.className="list-item";m.setAttribute("data-index",c);m.setAttribute("href","#");m.addEventListener("click",
f);m.innerHTML='<div class="level"><div class="level-left">'+cityssm.escapeHTML(e.locationName)+"</div>"+(l?'<div class="level-right"><span class="tag is-primary">'+cityssm.escapeHTML(l.locationClass)+"</span></div>":"")+"</div>";a.insertAdjacentElement("beforeend",m)}c=document.getElementById("container--parkingLocations");cityssm.clearElement(c);c.insertAdjacentElement("beforeend",a)})};a=function(a){a.preventDefault();cityssm.openHtmlModal("location-select",{onshown:function(a,b){c=b;g()},onremoved:function(){document.getElementById("is-location-lookup-button").focus()}})};
document.getElementById("is-location-lookup-button").addEventListener("click",a);document.getElementById("ticket--locationName").addEventListener("dblclick",a)});var z,q=[],C=function(a){a.preventDefault();a=q[parseInt(a.currentTarget.getAttribute("data-index"))];document.getElementById("ticket--bylawNumber").value=a.bylawNumber;var c=document.getElementById("ticket--offenceAmount");c.classList.add("is-readonly");c.setAttribute("readonly","readonly");c.closest(".field").getElementsByClassName("is-unlock-field-button")[0].removeAttribute("disabled");
c.value=a.offenceAmount;document.getElementById("ticket--parkingOffence").value=a.bylawDescription;z();q=[]},D=function(){var a=document.getElementById("ticket--locationKey").value;cityssm.postJSON("/offences/doGetOffencesByLocation",{locationKey:a},function(a){q=a;a=document.createElement("div");a.className="list is-hoverable has-margin-bottom-20";for(var c=0;c<q.length;c+=1){var b=q[c],l=document.createElement("a");l.className="list-item";l.setAttribute("data-index",c);l.setAttribute("href","#");
l.addEventListener("click",C);l.innerHTML='<div class="columns">'+('<div class="column">'+cityssm.escapeHTML(b.bylawNumber)+"<br /><small>"+cityssm.escapeHTML(b.bylawDescription)+"</small></div>")+('<div class="column is-narrow">$ '+b.offenceAmount.toFixed(2)+"</div>")+"</div>";a.insertAdjacentElement("beforeend",l)}c=document.getElementById("container--bylawNumbers");cityssm.clearElement(c);c.appendChild(a)})},h=function(a){a.preventDefault();cityssm.openHtmlModal("ticket-setBylawOffence",{onshown:function(a,
b){z=b;D();document.getElementById("bylawLookup--searchStr").focus()},onremoved:function(){document.getElementById("is-bylaw-lookup-button").focus()}})};document.getElementById("is-bylaw-lookup-button").addEventListener("click",h);document.getElementById("ticket--bylawNumber").addEventListener("dblclick",h);h=function(){var a=document.getElementById("datalist--licencePlateProvince");cityssm.clearElement(a);var c=pts.getLicencePlateCountryProperties(document.getElementById("ticket--licencePlateCountry").value);
if(c&&c.provinces)for(var c=Object.values(c.provinces),b=0;b<c.length;b+=1){var d=document.createElement("option");d.setAttribute("value",c[b].provinceShortName);a.appendChild(d)}};document.getElementById("ticket--licencePlateCountry").addEventListener("change",h);pts.loadDefaultConfigProperties(h);var v=function(a){for(a=a.getElementsByClassName("panel-block");0<a.length;)a[0].remove()};if(!g){var r=document.getElementById("is-remark-panel"),t=pts.ticketRemarksInit;delete pts.ticketRemarksInit;var w,
E=function(a){var c=a.currentTarget.getAttribute("data-remark-index");cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this remark?","Yes, Delete","warning",function(){cityssm.postJSON("/tickets/doDeleteRemark",{ticketID:b,remarkIndex:c},function(a){a.success&&w()})})},F=function(a){a.preventDefault();var c;a=parseInt(a.currentTarget.getAttribute("data-index"));var e=t[a],d=function(a){a.preventDefault();cityssm.postJSON("/tickets/doUpdateRemark",a.currentTarget,function(a){a.success&&
(c(),w())})};cityssm.openHtmlModal("ticket-editRemark",{onshow:function(a){document.getElementById("editRemark--ticketID").value=b;document.getElementById("editRemark--remarkIndex").value=e.remarkIndex;document.getElementById("editRemark--remark").value=e.remark;document.getElementById("editRemark--remarkDateString").value=e.remarkDateString;document.getElementById("editRemark--remarkTimeString").value=e.remarkTimeString;a.getElementsByTagName("form")[0].addEventListener("submit",d)},onshown:function(a,
b){c=b}})},A=function(){v(r);if(0===t.length)r.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this ticket.</p></div></div>');else for(var a=0;a<t.length;a+=1){var c=t[a],b=document.createElement("div");b.className="panel-block is-block";b.innerHTML='<div class="columns">'+('<div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(c.remark)+'</p><p class="is-size-7">'+(c.recordCreate_timeMillis===
c.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+c.recordUpdate_userName+" - "+c.remarkDateString+" "+c.remarkTimeString+"</p></div>")+(c.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons">'+('<button class="button is-small is-edit-remark-button" data-tooltip="Edit Remark" data-index="'+a+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button>')+('<button class="button is-small has-text-danger is-delete-remark-button" data-tooltip="Delete Remark" data-remark-index="'+
c.remarkIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button>')+"</div></div>":"")+"</div>";c.canUpdate&&(b.getElementsByClassName("is-edit-remark-button")[0].addEventListener("click",F),b.getElementsByClassName("is-delete-remark-button")[0].addEventListener("click",E));r.appendChild(b)}};w=function(){v(r);r.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading remarks...</p></div>');
cityssm.postJSON("/tickets/doGetRemarks",{ticketID:b},function(a){t=a;A()})};document.getElementById("is-add-remark-button").addEventListener("click",function(a){a.preventDefault();var c,e=function(a){a.preventDefault();cityssm.postJSON("/tickets/doAddRemark",a.currentTarget,function(a){a.success&&(c(),w())})};cityssm.openHtmlModal("ticket-addRemark",{onshow:function(a){document.getElementById("addRemark--ticketID").value=b;a.getElementsByTagName("form")[0].addEventListener("submit",e)},onshown:function(a,
b){c=b}})});A()}if(!g){var p=document.getElementById("is-status-panel"),u=pts.ticketStatusLogInit;delete pts.ticketStatusLogInit;var x,G=function(a){a.preventDefault();cityssm.confirmModal("Mark Ticket as Resolved?","Once resolved, you will no longer be able to make changes to the ticket.","Yes, Resolve Ticket","info",function(){cityssm.postJSON("/tickets/doResolveTicket",{ticketID:b},function(a){a.success&&(window.location.href="/tickets/"+b)})})},H=function(a){var c=a.currentTarget.getAttribute("data-status-index");
cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this status?","Yes, Delete","warning",function(){cityssm.postJSON("/tickets/doDeleteStatus",{ticketID:b,statusIndex:c},function(a){a.success&&x()})})},I=function(a){a.preventDefault();var c;a=parseInt(a.currentTarget.getAttribute("data-index"));var e=u[a],d=function(a){a.preventDefault();cityssm.postJSON("/tickets/doUpdateStatus",a.currentTarget,function(a){a.success&&(c(),x())})},l=function(a){a=pts.getTicketStatus(a.currentTarget.value);
var b=document.getElementById("editStatus--statusField");b.value="";a&&a.statusField?(b=b.closest(".field"),b.getElementsByTagName("label")[0].innerText=a.statusField.fieldLabel,b.classList.remove("is-hidden")):b.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-editStatus",{onshow:function(a){document.getElementById("editStatus--ticketID").value=b;document.getElementById("editStatus--statusIndex").value=e.statusIndex;document.getElementById("editStatus--statusField").value=
e.statusField;document.getElementById("editStatus--statusNote").value=e.statusNote;var c=document.getElementById("editStatus--statusDateString");c.value=e.statusDateString;c.setAttribute("max",cityssm.dateToString(new Date));document.getElementById("editStatus--statusTimeString").value=e.statusTimeString;pts.getDefaultConfigProperty("parkingTicketStatuses",function(a){for(var b=!1,c=document.getElementById("editStatus--statusKey"),m=0;m<a.length;m+=1){var d=a[m];if(d.isUserSettable||d.statusKey===
e.statusKey)if(c.insertAdjacentHTML("beforeend",'<option value="'+d.statusKey+'">'+d.status+"</option>"),d.statusKey===e.statusKey&&(b=!0,d.statusField)){var f=document.getElementById("editStatus--statusField").closest(".field");f.getElementsByTagName("label")[0].innerText=d.statusField.fieldLabel;f.classList.remove("is-hidden")}}b||c.insertAdjacentHTML("beforeend",'<option value="'+e.statusKey+'">'+e.statusKey+"</option>");c.value=e.statusKey;c.addEventListener("change",l)});a.getElementsByTagName("form")[0].addEventListener("submit",
d)},onshown:function(a,b){c=b}})},B=function(){v(p);if(0===u.length)p.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no statuses associated with this ticket.</p></div></div>');else for(var a=0;a<u.length;a+=1){var b=u[a],e=pts.getTicketStatus(b.statusKey);if(0===a&&e&&e.isFinalStatus){var d=document.createElement("div");d.className="panel-block is-block";d.innerHTML='<div class="message is-info is-clearfix"><div class="message-body"><div class="columns"><div class="column"><strong>This ticket is able to be marked as resolved.</strong></div><div class="column is-narrow has-text-right"><button class="button is-info" type="button"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Resolve Ticket</span></button></div></div></div></div>';
d.getElementsByTagName("button")[0].addEventListener("click",G);p.appendChild(d)}d=document.createElement("div");d.className="panel-block is-block";d.innerHTML='<div class="columns">'+('<div class="column">'+('<div class="level has-margin-bottom-5"><div class="level-left"><strong>'+(e?e.status:b.statusKey)+'</strong></div><div class="level-right">'+b.statusDateString+"</div></div>")+(""===b.statusField?"":'<p class="is-size-7"><strong>'+(e&&e.statusField?e.statusField.fieldLabel:"")+":</strong> "+
b.statusField+"</p>")+'<p class="has-newline-chars is-size-7">'+b.statusNote+"</p></div>")+(b.canUpdate&&0===a?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-status-button" data-tooltip="Edit Status" data-index="'+a+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-status-button" data-tooltip="Delete Status" data-status-index="'+
b.statusIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div>";b.canUpdate&&0===a&&(d.getElementsByClassName("is-edit-status-button")[0].addEventListener("click",I),d.getElementsByClassName("is-delete-status-button")[0].addEventListener("click",H));p.appendChild(d)}};x=function(){v(p);p.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading statuses...</p></div>');
cityssm.postJSON("/tickets/doGetStatuses",{ticketID:b},function(a){u=a;B()})};document.getElementById("is-add-status-button").addEventListener("click",function(a){a.preventDefault();var c,e=function(a){a.preventDefault();var d=document.getElementById("addStatus--resolveTicket").checked;cityssm.postJSON("/tickets/doAddStatus",a.currentTarget,function(a){a.success&&(c(),d?window.location.href="/tickets/"+b:x())})},d=function(a){a=pts.getTicketStatus(a.currentTarget.value);var b=document.getElementById("addStatus--statusField");
b.value="";a&&a.statusField?(b=b.closest(".field"),b.getElementsByTagName("label")[0].innerText=a.statusField.fieldLabel,b.classList.remove("is-hidden")):b.closest(".field").classList.add("is-hidden");b=document.getElementById("addStatus--resolveTicket");b.checked=!1;a&&a.isFinalStatus?b.closest(".field").classList.remove("is-hidden"):b.closest(".field").classList.add("is-hidden")};cityssm.openHtmlModal("ticket-addStatus",{onshow:function(a){document.getElementById("addStatus--ticketID").value=b;
pts.getDefaultConfigProperty("parkingTicketStatuses",function(a){for(var b=document.getElementById("addStatus--statusKey"),c=0;c<a.length;c+=1){var e=a[c];e.isUserSettable&&b.insertAdjacentHTML("beforeend",'<option value="'+e.statusKey+'">'+e.status+"</option>")}b.addEventListener("change",d)});a.getElementsByTagName("form")[0].addEventListener("submit",e)},onshown:function(a,b){c=b}})});pts.loadDefaultConfigProperties(B)}for(var h=function(a){a.preventDefault();a=a.currentTarget;var b=a.getAttribute("data-unlock"),
b=a.closest(".field").getElementsByTagName(b)[0];b.removeAttribute("readonly");b.classList.remove("is-readonly");b.focus();a.setAttribute("disabled","disabled")},n=document.getElementsByClassName("is-unlock-field-button"),y=0;y<n.length;y+=1)n[y].addEventListener("click",h)})();
