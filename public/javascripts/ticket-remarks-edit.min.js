"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){const e=document.getElementById("ticket--ticketID").value,t=document.getElementById("is-remark-panel");let a=exports.ticketRemarks;delete exports.ticketRemarks;const n=function(){const e=t.getElementsByClassName("panel-block");for(;e.length>0;)e[0].remove()},s=function(t){const a=t.currentTarget.getAttribute("data-remark-index");cityssm.confirmModal("Delete Remark?","Are you sure you want to delete this remark?","Yes, Delete","warning",function(){cityssm.postJSON("/tickets/doDeleteRemark",{ticketID:e,remarkIndex:a},function(e){e.success&&c()})})},i=function(t){let n;t.preventDefault();const s=parseInt(t.currentTarget.getAttribute("data-index"),10),i=a[s],r=function(e){e.preventDefault(),cityssm.postJSON("/tickets/doUpdateRemark",e.currentTarget,function(e){e.success&&(n(),c())})};cityssm.openHtmlModal("ticket-editRemark",{onshow:function(t){document.getElementById("editRemark--ticketID").value=e,document.getElementById("editRemark--remarkIndex").value=i.remarkIndex,document.getElementById("editRemark--remark").value=i.remark,document.getElementById("editRemark--remarkDateString").value=i.remarkDateString,document.getElementById("editRemark--remarkTimeString").value=i.remarkTimeString,t.getElementsByTagName("form")[0].addEventListener("submit",r)},onshown:function(e,t){n=t}})},r=function(){if(n(),0!==a.length)for(let e=0;e<a.length;e+=1){const n=a[e],r=document.createElement("div");r.className="panel-block is-block",r.innerHTML='<div class="columns"><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(n.remark)+'</p><p class="is-size-7">'+(n.recordCreate_timeMillis===n.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+n.recordUpdate_userName+" - "+n.remarkDateString+" "+n.remarkTimeString+"</p></div>"+(n.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-tooltip="Edit Remark" data-index="'+e+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-tooltip="Delete Remark" data-remark-index="'+n.remarkIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div>",n.canUpdate&&(r.getElementsByClassName("is-edit-remark-button")[0].addEventListener("click",i),r.getElementsByClassName("is-delete-remark-button")[0].addEventListener("click",s)),t.appendChild(r)}else t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this ticket.</p></div></div>')},c=function(){n(),t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><p class="has-text-centered has-text-grey-lighter"><i class="fas fa-2x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading remarks...</p></div>'),cityssm.postJSON("/tickets/doGetRemarks",{ticketID:e},function(e){a=e,r()})};document.getElementById("is-add-remark-button").addEventListener("click",function(t){let a;t.preventDefault();const n=function(e){e.preventDefault(),cityssm.postJSON("/tickets/doAddRemark",e.currentTarget,function(e){e.success&&(a(),c())})};cityssm.openHtmlModal("ticket-addRemark",{onshow:function(t){document.getElementById("addRemark--ticketID").value=e,t.getElementsByTagName("form")[0].addEventListener("submit",n)},onshown:function(e,t){a=t}})}),r()}();