(function(){function k(b){b.preventDefault();var g=b.currentTarget,c=g.closest("td"),a=c.closest("tr");pts.confirmModal("Clear Status","Are you sure you want to undo this status?","Yes, Remove the Status","warning",function(){pts.postJSON("/tickets/doDeleteStatus",{ticketID:a.getAttribute("data-ticket-id"),statusIndex:g.getAttribute("data-status-index")},function(a){a.success&&(pts.clearElement(c),c.classList.remove("has-width-200"),c.innerHTML='<button class="button is-success is-ownership-match-button" type="button"><span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></button> <button class="button is-danger is-ownership-error-button" type="button"><i class="fas fa-times" aria-hidden="true"></i><span class="sr-only">Error</span></button>',
c.getElementsByClassName("is-ownership-match-button")[0].addEventListener("click",f),c.getElementsByClassName("is-ownership-error-button")[0].addEventListener("click",h))})})}var f,h;f=function(b){b.preventDefault();var g=b.currentTarget,c=g.closest("td"),a=c.closest("tr");b=function(){g.setAttribute("disabled","disabled");var b=a.getAttribute("data-licence-plate-country"),d=a.getAttribute("data-licence-plate-province"),e=a.getAttribute("data-licence-plate-number"),f=a.getAttribute("data-ticket-id"),
h=a.getAttribute("data-record-date");pts.postJSON("/tickets/doReconcileAsMatch",{licencePlateCountry:b,licencePlateProvince:d,licencePlateNumber:e,ticketID:f,recordDate:h},function(a){a.success?(pts.clearElement(c),c.innerHTML='<div class="tags has-addons"><span class="tag is-light is-success"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+a.statusIndex+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',
c.getElementsByTagName("a")[0].addEventListener("click",k)):(g.removeAttribute("disabled"),pts.alertModal("Record Not Updated",a.message,"OK","danger"))})};if(a.hasAttribute("data-is-probable-match"))b();else{var d=a.getAttribute("data-ticket-vehicle"),e=a.getAttribute("data-owner-vehicle");pts.confirmModal("Confirm Match",'<p>Are you sure the details on the parking ticket match the details on the ownership record?</p><div class="columns has-margin-top-5">'+('<div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+
pts.escapeHTML(d)+"</span></div>")+('<div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+pts.escapeHTML(e)+"</span></div>")+"</div>","Yes, Confirm Match","warning",b)}};h=function(b){b.preventDefault();var d=b.currentTarget,c=d.closest("td"),a=c.closest("tr");b=function(){d.setAttribute("disabled","disabled");var b=a.getAttribute("data-licence-plate-country"),e=a.getAttribute("data-licence-plate-province"),f=a.getAttribute("data-licence-plate-number"),
g=a.getAttribute("data-ticket-id"),h=a.getAttribute("data-record-date");pts.postJSON("/tickets/doReconcileAsError",{licencePlateCountry:b,licencePlateProvince:e,licencePlateNumber:f,ticketID:g,recordDate:h},function(a){a.success?(pts.clearElement(c),c.innerHTML='<div class="tags has-addons"><span class="tag is-light is-danger"><span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span><span>Match Error</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+
a.statusIndex+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',c.getElementsByTagName("a")[0].addEventListener("click",k)):(d.removeAttribute("disabled"),pts.alertModal("Record Not Updated",a.message,"OK","danger"))})};if(a.hasAttribute("data-is-probable-match")){var e=a.getAttribute("data-ticket-vehicle"),f=a.getAttribute("data-owner-vehicle");pts.confirmModal("Confirm Error",'<p>Are you sure you want to mark an error between the details on the parking ticket and the details on the ownership record?</p><div class="columns has-margin-top-5">'+
('<div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+pts.escapeHTML(e)+"</span></div>")+('<div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+pts.escapeHTML(f)+"</span></div>")+"</div>","Yes, Confirm Error","warning",b)}else b()};for(var e=document.getElementsByClassName("is-ownership-match-button"),d=0;d<e.length;d+=1)e[d].addEventListener("click",f);e=document.getElementsByClassName("is-ownership-error-button");
for(d=0;d<e.length;d+=1)e[d].addEventListener("click",h);document.getElementById("is-quick-reconcile-matches-button").addEventListener("click",function(b){pts.confirmModal("Quick Reconcile Matches","Are you sure you want to mark all parking tickets with matching vehicle makes as matched?","Yes, Mark All Matches as Matched","info",function(){})})})();
