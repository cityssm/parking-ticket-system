"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{let e="";const t=document.querySelector("#locationFilter--locationClassKey"),o=document.querySelector("#locationFilter--locationName"),n=document.querySelector("#locationResults");let a=exports.locations;delete exports.locations;const s=t=>{t.preventDefault();const o=Number.parseInt(t.currentTarget,10),n=a[o];let s;const i=()=>{cityssm.postJSON("/admin/doDeleteLocation",{locationKey:n.locationKey},e=>{e.success&&(s(),a=e.locations,c())})},l=e=>{e.preventDefault(),cityssm.confirmModal("Delete Location",'Are you sure you want to remove "'+n.locationName+'" from the list of available options?',"Yes, Remove Location","danger",i)},r=e=>{e.preventDefault(),cityssm.postJSON("/admin/doUpdateLocation",e.currentTarget,e=>{e.success&&(s(),a=e.locations,c())})};cityssm.openHtmlModal("location-edit",{onshow(){document.querySelector("#editLocation--locationKey").value=n.locationKey;const t=document.querySelector("#editLocation--locationClassKey");t.innerHTML=e,t.querySelector("[value='"+n.locationClassKey+"']")||t.insertAdjacentHTML("beforeend",'<option value="'+cityssm.escapeHTML(n.locationClassKey)+'">'+cityssm.escapeHTML(n.locationClassKey)+"</option>"),t.value=n.locationClassKey,document.querySelector("#editLocation--locationName").value=n.locationName},onshown(e,t){var o,n;bulmaJS.toggleHtmlClipped(),s=t,null===(o=document.querySelector("#form--editLocation"))||void 0===o||o.addEventListener("submit",r),null===(n=e.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",l)},onhidden(){bulmaJS.toggleHtmlClipped()}})},c=()=>{let e=0;const c=t.value,i=o.value.trim().toLowerCase().split(" "),l=document.createElement("tbody");for(const[t,o]of a.entries()){if(""!==c&&c!==o.locationClassKey)continue;let n=!0;const a=o.locationName.toLowerCase();for(const e of i)if(!a.includes(e)){n=!1;break}if(!n)continue;e+=1;const r=pts.getLocationClass(o.locationClassKey).locationClass,d=document.createElement("tr");d.innerHTML='<td><a data-index="'+t.toString()+'" href="#">'+cityssm.escapeHTML(o.locationName)+"</a></td><td>"+cityssm.escapeHTML(r)+"</td>",d.querySelector("a").addEventListener("click",s),l.append(d)}cityssm.clearElement(n),0!==e?(n.innerHTML='<table class="table is-fixed is-striped is-hoverable is-fullwidth"><thead><tr><th>Location</th><th>Class</th></tr></thead></table>',n.querySelector("table").append(l)):n.innerHTML='<div class="message is-info"><div class="message-body">There are no locations that meet your search criteria.</div></div>'};t.addEventListener("change",c),o.addEventListener("keyup",c),pts.getDefaultConfigProperty("locationClasses",o=>{t.innerHTML='<option value="">(All Location Classes)</option>';for(const t of o)e+='<option value="'+t.locationClassKey+'">'+cityssm.escapeHTML(t.locationClass)+"</option>";t.insertAdjacentHTML("beforeend",e),c()}),document.querySelector("#is-add-location-button").addEventListener("click",t=>{let o;t.preventDefault();const n=e=>{e.preventDefault(),cityssm.postJSON("/admin/doAddLocation",e.currentTarget,e=>{e.success?(o(),a=e.locations,c()):cityssm.alertModal("Location Not Added",e.message,"OK","danger")})};cityssm.openHtmlModal("location-add",{onshown(t,a){o=a,document.querySelector("#addLocation--locationClassKey").insertAdjacentHTML("beforeend",e),document.querySelector("#form--addLocation").addEventListener("submit",n)}})})})();