"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{function e(e){e.preventDefault();const t=e.currentTarget;t.setAttribute("disabled","disabled");const s=t.dataset.batchId,a=t.dataset.logIndex;cityssm.postJSON("/tickets/doAcknowledgeLookupError",{batchId:s,logIndex:a},e=>{if(e.success){const e=t.closest("td");cityssm.clearElement(e),e.innerHTML='<span class="tag is-light is-warning">\n            <span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span>\n            <span>Acknowledged</span>\n            </span>'}else t.removeAttribute("disabled")})}pts.initializeToggleHiddenLinks(document.querySelector("main"));const t=document.querySelectorAll(".is-acknowledge-error-button");for(const s of t)s.addEventListener("click",e);function s(e){e.preventDefault();const t=e.currentTarget,s=t.closest("td"),n=s.closest("tr");cityssm.confirmModal("Clear Status","Are you sure you want to undo this status?","Yes, Remove the Status","warning",function(){cityssm.postJSON("/tickets/doDeleteStatus",{ticketId:n.dataset.ticketId,statusIndex:t.dataset.statusIndex},e=>{var t,n;e.success&&(cityssm.clearElement(s),s.classList.remove("has-width-200"),s.innerHTML='<button class="button is-success is-ownership-match-button" type="button">\n              <span class="icon"><i class="fas fa-check" aria-hidden="true"></i></span>\n              <span>Match</span>\n              </button>\n              <button class="button is-danger is-ownership-error-button" type="button">\n              <i class="fas fa-times" aria-hidden="true"></i>\n              <span class="sr-only">Error</span>\n              </button>',null===(t=s.querySelector(".is-ownership-match-button"))||void 0===t||t.addEventListener("click",a),null===(n=s.querySelector(".is-ownership-error-button"))||void 0===n||n.addEventListener("click",c))})})}function a(e){e.preventDefault();const t=e.currentTarget,a=t.closest("td"),c=a.closest("tr");function n(){t.setAttribute("disabled","disabled");const e=c.dataset.licencePlateCountry,n=c.dataset.licencePlateProvince,i=c.dataset.licencePlateNumber,r=c.dataset.ticketId,o=c.dataset.recordDate;cityssm.postJSON("/tickets/doReconcileAsMatch",{licencePlateCountry:e,licencePlateProvince:n,licencePlateNumber:i,ticketId:r,recordDate:o},e=>{var c,n;e.success?(cityssm.clearElement(a),a.innerHTML='<div class="tags has-addons"><span class="tag is-light is-success"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+e.statusIndex.toString()+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',null===(c=a.querySelector("a"))||void 0===c||c.addEventListener("click",s)):(t.removeAttribute("disabled"),cityssm.alertModal("Record Not Updated",null!==(n=e.message)&&void 0!==n?n:"","OK","danger"))})}if(c.hasAttribute("data-is-vehicle-make-match")&&c.hasAttribute("data-is-licence-plate-expiry-date-match"))n();else{const e=c.dataset.ticketVehicle,t=c.dataset.ticketExpiryDate,s=c.dataset.ownerVehicle,a=c.dataset.ownerExpiryDate;cityssm.confirmModal("Confirm Match",'<p class="has-text-centered">Are you sure the details on the parking ticket match the details on the ownership record?</p><div class="columns mt-1"><div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(e)+'</span><br /><span class="is-size-5">'+(""===t?"(Not Set)":cityssm.escapeHTML(t))+'</span></div><div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(s)+'</span><br /><span class="is-size-5">'+cityssm.escapeHTML(a)+"</span></div></div>","Yes, Confirm Match","warning",n)}}function c(e){var t,a,c,n;e.preventDefault();const i=e.currentTarget,r=i.closest("td"),o=r.closest("tr"),l=()=>{i.setAttribute("disabled","disabled");const e=o.dataset.licencePlateCountry,t=o.dataset.licencePlateProvince,a=o.dataset.licencePlateNumber,c=o.dataset.ticketId,n=o.dataset.recordDate;cityssm.postJSON("/tickets/doReconcileAsError",{licencePlateCountry:e,licencePlateProvince:t,licencePlateNumber:a,ticketId:c,recordDate:n},e=>{var t,a;e.success?(cityssm.clearElement(r),r.innerHTML='<div class="tags has-addons"><span class="tag is-light is-danger"><span class="icon is-small"><i class="fas fa-times" aria-hidden="true"></i></span><span>Match Error</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+e.statusIndex.toString()+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',null===(t=r.querySelector("a"))||void 0===t||t.addEventListener("click",s)):(i.removeAttribute("disabled"),cityssm.alertModal("Record Not Updated",null!==(a=e.message)&&void 0!==a?a:"","OK","danger"))})};if(o.hasAttribute("data-is-vehicle-make-match")||o.hasAttribute("data-is-licence-plate-expiry-date-match")){const e=null!==(t=o.dataset.ticketVehicle)&&void 0!==t?t:"",s=null!==(a=o.dataset.ticketExpiryDate)&&void 0!==a?a:"",i=null!==(c=o.dataset.ownerVehicle)&&void 0!==c?c:"",r=null!==(n=o.dataset.ownerExpiryDate)&&void 0!==n?n:"";cityssm.confirmModal("Confirm Error",'<p class="has-text-centered">Are you sure you want to mark an error between the details on the parking ticket and the details on the ownership record?</p><div class="columns mt-1"><div class="column has-text-centered"><strong>Parking Ticket</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(e)+'</span><br /><span class="is-size-5">'+(""===s?"(Not Set)":cityssm.escapeHTML(s))+'</span></div><div class="column has-text-centered"><strong>Ownership Record</strong><br /><span class="is-size-4">'+cityssm.escapeHTML(i)+'</span><br /><span class="is-size-5">'+cityssm.escapeHTML(r)+"</span></div></div>","Yes, Confirm Error","warning",l)}else l()}const n=document.querySelectorAll(".is-ownership-match-button");for(const e of n)e.addEventListener("click",a);const i=document.querySelectorAll(".is-ownership-error-button");for(const e of i)e.addEventListener("click",c);const r=document.querySelector("#is-quick-reconcile-matches-button");r&&r.addEventListener("click",e=>{let t;e.preventDefault();cityssm.confirmModal("Quick Reconcile Matches","Are you sure you want to mark all parking tickets with matching vehicle makes and plate expiry dates as matched?","Yes, Mark All Matches as Matched","info",()=>{cityssm.openHtmlModal("loading",{onshown(e,a){document.querySelector("#is-loading-modal-message").textContent="Reconciling matches...",t=a,cityssm.postJSON("/tickets/doQuickReconcileMatches",{},e=>{var a;if(t(),e.success){cityssm.alertModal("Quick Reconcile Complete",1===e.statusRecords.length?"One record was successfully reconciled as a match.":e.statusRecords.length.toString()+" records were successfully reconciled as matches.","OK","success");for(const t of e.statusRecords){const e=document.querySelector("#is-options-cell--"+t.ticketId.toString());e&&(cityssm.clearElement(e),e.innerHTML='<div class="tags has-addons"><span class="tag is-light is-success"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Match</span></span><a class="tag" data-tooltip="Remove Match" data-status-index="'+t.statusIndex.toString()+'" data-tooltip="Remove Match" href="#"><i class="far fa-trash-alt" aria-hidden="true"></i><span class="sr-only">Remove Match</span></a></div>',null===(a=e.querySelector("a"))||void 0===a||a.addEventListener("click",s))}}})}})})})})();